@(response: model.device.RegionOverview, province: String)

<script type="text/javascript">
        // for page Tab Trend
        function callAjaxTrending(){
            $.ajax({
                url: "/monthly/getTrend",
                cache: false,
                beforeSend: function () {
                    $('#divTabTrend').waitMe({
                        effect: 'roundBounce',
                        text: 'Please wait...',
                        bg: 'rgba(255,255,255,0.7)',
                        color: '#000',
                        textPos: 'vertical'
                    });
                },
                success: function (dta) {
                    if(dta != "Error"){
                        $('#isClickedTab4').val(1)
                        @if(province.equals("")){
                            // Connectivity By Month
                            var monthTrend3 = new Highcharts.Chart({
                                chart: {
                                    renderTo: 'month-trend3'
                                },
                                title: '',
                                xAxis: [{
                                    categories: dta.topConnect.categories
                                }],
                                legend: {
                                    enabled: true
                                },
                                colors: ['#1ABB9C', '#5A738E', '#d62855'],
                                tooltip: {
                                    shared: true
                                },
                                series: [{
                                    type: 'line',
                                    name:'Signin',
                                    data: dta.topConnect.signin
                                },
                                    {
                                        type: 'line',
                                        name:'Logoff',
                                        data: dta.topConnect.logoff
                                    }]
                            });
                            /* add regression line dynamically */
                            monthTrend3.addSeries({
                                type: 'line',
                                dashStyle: 'shortdash',
                                showInLegend: false,
                                enableMouseTracking: false,
                                marker: { enabled: false },
                                /* function returns data for trend-line */
                                data: (function() {
                                    return fitOneDimensionalData(dta.topConnect.dataAvg);
                                })()
                            });
                            // Outliers Of BRAS By Month
                            var monthTrend1 = new Highcharts.Chart({
                                chart: {
                                    renderTo: 'month-trend1'
                                },
                                title: '',
                                xAxis: [{
                                    categories: dta.topBras.categories
                                }],
                                legend: {
                                    enabled: false
                                },
                                colors: ['#1ABB9C', '#d62855'],
                                series: [{
                                    type: 'line',
                                    name:'No outliers',
                                    data: dta.topBras.data
                                }]
                            });
                            /* add regression line dynamically */
                            monthTrend1.addSeries({
                                type: 'line',
                                dashStyle: 'shortdash',
                                marker: { enabled: false },
                                enableMouseTracking: false,
                                /* function returns data for trend-line */
                                data: (function() {
                                    return fitOneDimensionalData(dta.topBras.data);
                                })()
                            });

                            // BRAS Error By Month
                            var monthTrend5 = new Highcharts.Chart({
                                chart: {
                                    renderTo: 'month-trend5'
                                },
                                title: '',
                                xAxis: [{
                                    categories: dta.topBrasErr.categories
                                }],
                                legend: {
                                    enabled: false
                                },
                                colors: ['#1ABB9C', '#d62855'],
                                series: [{
                                    type: 'line',
                                    name:'Total kibana',
                                    data: dta.topBrasErr.data
                                }]
                            });
                            /* add regression line dynamically */
                            monthTrend5.addSeries({
                                type: 'line',
                                dashStyle: 'shortdash',
                                marker: { enabled: false },
                                enableMouseTracking: false,
                                /* function returns data for trend-line */
                                data: (function() {
                                    return fitOneDimensionalData(dta.topBrasErr.data);
                                })()
                            });
                            // Service Monitoring By Month
                            var monthTrend6 = new Highcharts.Chart({
                                chart: {
                                    renderTo: 'month-trend6'
                                },
                                title: '',
                                xAxis: [{
                                    categories: dta.topService.categories
                                }],
                                legend: {
                                    enabled: false
                                },
                                colors: ['#1ABB9C', '#d62855'],
                                series: [{
                                    type: 'line',
                                    name:'Total opsview',
                                    data: dta.topService.data
                                }]
                            });
                            /* add regression line dynamically */
                            monthTrend6.addSeries({
                                type: 'line',
                                dashStyle: 'shortdash',
                                enableMouseTracking: false,
                                marker: { enabled: false },
                                /* function returns data for trend-line */
                                data: (function() {
                                    return fitOneDimensionalData(dta.topService.data);
                                })()
                            });
                            // sparkline Severity Of BRAS Error By Month
                            $('#tbSparkline1 tr').each(function (i, value) {
                                $(this).find('.maxValue').text(dta.servBrasErr.maxSparkline[i])
                            })
                            $("#tbAlert").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Alert count',
                                    data: parseDataSparkline(dta.servBrasErr.alert)
                                }]
                            });
                            $("#tbCrit").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Crit count',
                                    data: parseDataSparkline(dta.servBrasErr.crit)
                                }]
                            });
                            $("#tbEmerg").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Emerg count',
                                    data: parseDataSparkline(dta.servBrasErr.emerg)
                                }]
                            });
                            $("#tbErr").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Err count',
                                    data: parseDataSparkline(dta.servBrasErr.err)
                                }]
                            });
                            $("#tbNotie").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Notice count',
                                    data: parseDataSparkline(dta.servBrasErr.notice)
                                }]
                            });
                            $("#tbWarn").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Warning count',
                                    data: parseDataSparkline(dta.servBrasErr.warn)
                                }]
                            });

                            // sparkline Status Of Service Monitoring By Month
                            $('#tbSparkline2 tr').each(function (i, value) {
                                $(this).find('.maxValue').text(dta.servOpsview.maxSparkline[i])
                            })
                            $("#tbCritOps").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Crit opsview',
                                    data: parseDataSparkline(dta.servOpsview.crit)
                                }]
                            });
                            $("#tbOkOps").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Ok opsview',
                                    data: parseDataSparkline(dta.servOpsview.ok)
                                }]
                            });
                            $("#tbWarnOps").highcharts({
                                chart: {
                                    margin: [0, 0, 0, 0],
                                    style: {
                                        overflow: 'visible'
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                credits: {
                                    enabled: false
                                },
                                legend: {
                                    enabled: false
                                },
                                colors:['#115296'],
                                xAxis: {
                                    labels: {
                                        enabled: false
                                    },
                                    tickLength: 0
                                },
                                yAxis: {
                                    title: {
                                        text: null
                                    },
                                    maxPadding: 0,
                                    minPadding: 0,
                                    gridLineWidth: 0,
                                    ticks: false,
                                    endOnTick: false,
                                    labels: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    borderWidth: 1,
                                    shadow: false,
                                    useHTML: true,
                                    hideDelay: 0,
                                    padding: 5,
                                    positioner: function (w, h, point) {
                                        return {
                                            x: point.plotX - w / 2,
                                            y: point.plotY - h
                                        };
                                    }
                                },
                                plotOptions: {
                                    series: {
                                        enableMouseTracking: true,
                                        lineWidth: 1,
                                        shadow: false,
                                        states: {
                                            hover: {
                                                lineWidth: 1
                                            }
                                        },
                                        marker: {
                                            radius: 2
                                        }
                                    }
                                },
                                series: [{
                                    type: 'line',
                                    name: 'Warn opsview',
                                    data: parseDataSparkline(dta.servOpsview.warn)
                                }]
                            });
                            $("#tbUnknownOps").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'Unknown opsview',
                                data: parseDataSparkline(dta.servOpsview.unknown)
                            }]
                        });
                        }
                        // Outliers Of OLT By Mont
                        var monthTrend2 = new Highcharts.Chart({
                            chart: {
                                renderTo: 'month-trend2'
                            },
                            title: '',
                            xAxis: [{
                                categories: dta.topOlt.categories
                            }],
                            legend: {
                                enabled: false
                            },
                            colors: ['#1ABB9C', '#d62855'],
                            series: [{
                                type: 'line',
                                name:'Total outliers',
                                data: dta.topOlt.data
                            }]
                        });
                        /* add regression line dynamically */
                        monthTrend2.addSeries({
                            type: 'line',
                            dashStyle: 'shortdash',
                            marker: { enabled: false },
                            enableMouseTracking: false,
                            /* function returns data for trend-line */
                            data: (function() {
                                return fitOneDimensionalData(dta.topOlt.data);
                            })()
                        });
                        // Inf error By Month
                        var monthTrend4 = new Highcharts.Chart({
                            chart: {
                                renderTo: 'month-trend4'
                            },
                            title: '',
                            xAxis: [{
                                categories: dta.topInf.categories
                            }],
                            legend: {
                                enabled: false
                            },
                            colors: ['#1ABB9C', '#d62855'],
                            series: [{
                                type: 'line',
                                name:'Total inf',
                                data: dta.topInf.data
                            }]
                        });
                        /* add regression line dynamically */
                        monthTrend4.addSeries({
                            type: 'line',
                            dashStyle: 'shortdash',
                            marker: { enabled: false },
                            enableMouseTracking: false,
                            /* function returns data for trend-line */
                            data: (function() {
                                return fitOneDimensionalData(dta.topInf.data);
                            })()
                        });
                        // sparkline Detail Of INF Error By Month
                        $('#tbSparkline3 tr').each(function (i, value) {
                            $(this).find('.maxValue').text(dta.servInfError.maxSparkline[i])
                        })
                        $("#tbInfDown").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'Port Inf Down',
                                data: parseDataSparkline(dta.servInfError.infDown)
                            }]
                        });
                        $("#tbUserDown").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'Port PON Down',
                                data: parseDataSparkline(dta.servInfError.userDown)
                            }]
                        });
                        $("#tbSfError").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'SF Error',
                                data: parseDataSparkline(dta.servInfError.sf)
                            }]
                        });
                        $("#tbLofiErr").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'LOFI Error',
                                data: parseDataSparkline(dta.servInfError.lofi)
                            }]
                        });
                        $("#tbLost").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'Broken Lv2 Cable',
                                data: parseDataSparkline(dta.servInfError.lost)
                            }]
                        });
                        $("#tbRouge").highcharts({
                            chart: {
                                margin: [0, 0, 0, 0],
                                style: {
                                    overflow: 'visible'
                                }
                            },
                            title: {
                                text: ''
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            colors:['#115296'],
                            xAxis: {
                                labels: {
                                    enabled: false
                                },
                                tickLength: 0
                            },
                            yAxis: {
                                title: {
                                    text: null
                                },
                                maxPadding: 0,
                                minPadding: 0,
                                gridLineWidth: 0,
                                ticks: false,
                                endOnTick: false,
                                labels: {
                                    enabled: false
                                }
                            },
                            tooltip: {
                                borderWidth: 1,
                                shadow: false,
                                useHTML: true,
                                hideDelay: 0,
                                padding: 5,
                                positioner: function (w, h, point) {
                                    return {
                                        x: point.plotX - w / 2,
                                        y: point.plotY - h
                                    };
                                }
                            },
                            plotOptions: {
                                series: {
                                    enableMouseTracking: true,
                                    lineWidth: 1,
                                    shadow: false,
                                    states: {
                                        hover: {
                                            lineWidth: 1
                                        }
                                    },
                                    marker: {
                                        radius: 2
                                    }
                                }
                            },
                            series: [{
                                type: 'line',
                                name: 'Rogue ONT',
                                data: parseDataSparkline(dta.servInfError.rouge)
                            }]
                        });

                        function fitOneDimensionalData(source_data) {
                            var trend_source_data = [];
                            for(var i = source_data.length; i-->0;) {
                                trend_source_data[i] = [i, source_data[i]]
                            }
                            var regression_data = fitData(trend_source_data).data
                            var trend_line_data = [];
                            for(var i = regression_data.length; i-->0;) {
                                trend_line_data[i] = regression_data[i][1];
                            }
                            return trend_line_data;
                        }
                    }
                    else{
                        alert('Error when execute query. Please check again your system!')
                    }
                },
                complete: function () {
                    $('#divTabTrend').waitMe("hide");
                },
            });
        }

        function parseDataSparkline(dta){
            var rs = [], min = getMinMaxOf2DIndex(dta, 1).min, max= getMinMaxOf2DIndex(dta, 1).max
            for(var i=0;i<dta.length;i++){
                var color = '#115296', makerRadius = 2
                if(min == dta[i][1]) {
                    color = 'red'
                    makerRadius = 4
                }
                else if(max == dta[i][1]) {
                    makerRadius = 4
                    color = '#0b9027'
                }
                rs.push({
                    name: dta[i][0],
                    y: dta[i][1],
                    color: color,
                    marker: {
                        radius: makerRadius
                    }
                })
            }
            return rs
        }

        function getMinMaxOf2DIndex (arr, idx) {
            return {
                min: Math.min.apply(null, arr.map(function (e) { return e[idx]})),
                max: Math.max.apply(null, arr.map(function (e) { return e[idx]}))
            }
        }

        // for page Tab Compare
        function callAjaxCompare(month){
            $.ajax({
                url: "/monthly/getCompare?month="+month,
                cache: false,
                beforeSend: function () {
                    $('#divTabCpe').waitMe({
                        effect: 'roundBounce',
                        text: 'Please wait...',
                        bg: 'rgba(255,255,255,0.7)',
                        color: '#000',
                        textPos: 'vertical'
                    });
                },
                success: function (dta) {
                    if(dta != "Error"){
                        $('#monthPickerTop').removeClass('error')
                        var currMonth = dta.currMonth
                        $("#monthPickerTop").datepicker("update", currMonth)
                        $('#isClickedTab3').val(1)
                        if(dta.province == ""){
                            /* BOX SIGNIN */
                            $('#divSignin .signin').text(Number(dta.signin.currSignin).toLocaleString())
                            $('#divSignin .prevSignin').text(Number(dta.signin.prevSignin).toLocaleString())
                            var percSignin = (Number(dta.signin.percent) >=0)? '<h5 style="color: #11fd11"> <i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.signin.percent+' % </h5>' : '<h5 style="color: #f30606"> <i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.signin.percent+' % </h5>'
                            $('#divSignin .changeSig').html(percSignin)
                            $('#divSignin .titprevSign').text(dta.prevMonth)
                            /* BOX LOGOFF */
                            $('#divLogoff .logoff').text(Number(dta.logoff.currLogoff).toLocaleString())
                            $('#divLogoff .prevLog').text(Number(dta.logoff.prevLogoff).toLocaleString())
                            var percLogoff = (Number(dta.logoff.percent) >=0)? '<h5 style="color: #11fd11"> <i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.logoff.percent+' % </h5>' : '<h5 style="color: #f30606"> <i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.logoff.percent+' % </h5>'
                            $('#divLogoff .changeLog').html(percLogoff)
                            $('#divLogoff .titprevLog').text(dta.prevMonth)
                            /* BOX BRAS OUTLIER*/
                            $('.currBras').text(Number(dta.bras.currBras).toLocaleString())
                            $('.prevBras').text(Number(dta.bras.prevBras).toLocaleString())
                            var percBras = (Number(dta.bras.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.bras.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.bras.percent+' % </span>'
                            $('.changeBras').html(percBras)
                            $('.titprevBras').text('No Outlier '+dta.prevMonth)

                            $('.currAffect').text(Number(dta.affected.currAffect).toLocaleString())
                            $('.prevAffect').text(Number(dta.affected.prevAffect).toLocaleString())
                            var percAff = (Number(dta.affected.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.affected.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.affected.percent+' % </span>'
                            $('.changeAffect').html(percAff)
                            $('.titprevAffect').text('Affected Clients '+dta.prevMonth)
                            /* BOX Kibana & Opsview */
                            $('.currKiba').text(Number(dta.kibana.currKiba).toLocaleString())
                            $('.prevKiba').text(Number(dta.kibana.prevKiba).toLocaleString())
                            var percKiba = (Number(dta.kibana.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.kibana.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.kibana.percent+' % </span>'
                            $('.changeKiba').html(percKiba)

                            $('.currOps').text(Number(dta.opsview.currOps).toLocaleString())
                            $('.prevOps').text(Number(dta.opsview.prevOps).toLocaleString())
                            var percOps = (Number(dta.opsview.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.opsview.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.opsview.percent+' % </span>'
                            $('.changeOps').html(percOps)
                        }
                        /* BOX INF OUTLIER */
                        $('.currOutInf').text(Number(dta.outliInf.currOut).toLocaleString())
                        $('.prevOutInf').text(Number(dta.outliInf.prevOut).toLocaleString())
                        var percOut = (Number(dta.outliInf.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.outliInf.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.outliInf.percent+' % </span>'
                        $('.changeOutinf').html(percOut)
                        $('.titprevOutInf').text('No Inf Outlier '+dta.prevMonth)

                        $('.currClient').text(Number(dta.clientInf.currClient).toLocaleString())
                        $('.prevClient').text(Number(dta.clientInf.prevClient).toLocaleString())
                        var percClient = (Number(dta.clientInf.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.clientInf.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.clientInf.percent+' % </span>'
                        $('.changeClient').html(percClient)
                        $('.titpreClient').text('No Inf Clients '+dta.prevMonth)

                        $('.currInfCli').text(Number(dta.infDowncli.currInfCli).toLocaleString())
                        $('.prevInfCli').text(Number(dta.infDowncli.prevInfCli).toLocaleString())
                        var percInfCli = (Number(dta.infDowncli.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.infDowncli.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.infDowncli.percent+' % </span>'
                        $('.changeInfCli').html(percInfCli)
                        $('.titpreInfCli').text('Inf Down Clients '+dta.prevMonth)

                        $('.currInfOut').text(Number(dta.infDownout.currInfOut).toLocaleString())
                        $('.prevInfOut').text(Number(dta.infDownout.prevInfOut).toLocaleString())
                        var percInfOut = (Number(dta.infDownout.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.infDownout.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.infDownout.percent+' % </span>'
                        $('.changeInfOut').html(percInfOut)
                        $('.titprevInfOut').text('Inf Down Outlier '+dta.prevMonth)

                        $('.currUserClient').text(Number(dta.userDownCli.currUserCli).toLocaleString())
                        $('.prevUserCli').text(Number(dta.userDownCli.prevUserCli).toLocaleString())
                        var percUsercli = (Number(dta.userDownCli.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.userDownCli.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.userDownCli.percent+' % </span>'
                        $('.changeUserCli').html(percUsercli)
                        $('.titpreUserCli').text('User Down Clients '+dta.prevMonth)

                        $('.currUserOut').text(Number(dta.userDownout.currUserOut).toLocaleString())
                        $('.prevUserOut').text(Number(dta.userDownout.prevUserOut).toLocaleString())
                        var percUserout = (Number(dta.userDownout.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.userDownout.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.userDownout.percent+' % </span>'
                        $('.changeUserOut').html(percUserout)
                        $('.titprevUserOut').text('User Down Outlier '+dta.prevMonth)

                        $('.currSfClient').text(Number(dta.sfCli.currSfCli).toLocaleString())
                        $('.prevSfCli').text(Number(dta.sfCli.prevSfCli).toLocaleString())
                        var percSfcli = (Number(dta.sfCli.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.sfCli.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.sfCli.percent+' % </span>'
                        $('.changeSfCli').html(percSfcli)
                        $('.titpreSfcli').text('Sf Clients '+dta.prevMonth)

                        $('.currSfOut').text(Number(dta.sfOut.currSfOut).toLocaleString())
                        $('.prevSfOut').text(Number(dta.sfOut.prevSfOut).toLocaleString())
                        var percSfout = (Number(dta.sfOut.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.sfOut.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.sfOut.percent+' % </span>'
                        $('.changeSfOut').html(percSfout)
                        $('.titprevSfOut').text('Sf Outlier '+dta.prevMonth)

                        $('.currSignalClient').text(Number(dta.signalCli.currSigCli).toLocaleString())
                        $('.prevSigCli').text(Number(dta.signalCli.prevSigCli).toLocaleString())
                        var percSigcli = (Number(dta.signalCli.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.signalCli.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.signalCli.percent+' % </span>'
                        $('.changeSigCli').html(percSigcli)
                        $('.titpreSigCli').text('Lost Signal Clients '+dta.prevMonth)

                        $('.currSignalOut').text(Number(dta.signalOut.currSigOut).toLocaleString())
                        $('.prevSigOut').text(Number(dta.signalOut.prevSigOut).toLocaleString())
                        var percSigout = (Number(dta.signalOut.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.signalOut.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.signalOut.percent+' % </span>'
                        $('.changeSigOut').html(percSigout)
                        $('.titprevSigOut').text('Lost Signal Outlier '+dta.prevMonth)
                        /* BOX SUYHAO */
                        $('#divSuy .suyhao').text(Number(dta.suyhao.currSuyhao).toLocaleString())
                        $('#divSuy .prevSuy').text(Number(dta.suyhao.prevSuyhao).toLocaleString())
                        var percSuy = (Number(dta.suyhao.percent) >=0)? '<h5 style="color: #11fd11"> <i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.suyhao.percent+' % </h5>' : '<h5 style="color: #f30606"> <i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.suyhao.percent+' % </h5>'
                        $('#divSuy .changeSuy').html(percSuy)
                        $('#divSuy .titprevSuy').text(dta.prevMonth)
                        /* BOX NOT PASSED SUYHAO */
                        $('#divNotsuy .notSuy').text(Number(dta.notSuyhao.currNotsuyhao).toLocaleString())
                        $('#divNotsuy .prevNotsuy').text(Number(dta.notSuyhao.prevNotsuyhao).toLocaleString())
                        var percNotsuy = (Number(dta.notSuyhao.percent) >=0)? '<h5 style="color: #11fd11"> <i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.notSuyhao.percent+' % </h5>' : '<h5 style="color: #f30606"> <i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.notSuyhao.percent+' % </h5>'
                        $('#divNotsuy .changeNotsuy').html(percNotsuy)
                        $('#divNotsuy .titprevNotSuy').text(dta.prevMonth)
                        /* BOX Contract & Device */
                        $('.prevMonth').text(dta.prevMonth)
                        $('.currMonth').text(dta.currMonth)
                        $('.currCt').text(Number(dta.noContract.currNoct).toLocaleString())
                        $('.prevCt').text(Number(dta.noContract.prevNoct).toLocaleString())
                        var percCt = (Number(dta.noContract.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.noContract.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.noContract.percent+' % </span>'
                        $('.changeCt').html(percCt)

                        $('.currDev').text(Number(dta.noDevice.currNodev).toLocaleString())
                        $('.prevDev').text(Number(dta.noDevice.prevNodev).toLocaleString())
                        var percDev = (Number(dta.noDevice.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.noDevice.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.noDevice.percent+' % </span>'
                        $('.changeDev').html(percDev)
                        /* BOX Connections */
                        $('.currNotpoor').text(Number(dta.notPoor.currNotpoor).toLocaleString())
                        $('.prevNotpoor').text(Number(dta.notPoor.prevNotpoor).toLocaleString())
                        var percnotP = (Number(dta.notPoor.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.notPoor.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.notPoor.percent+' % </span>'
                        $('.changeNotpoor').html(percnotP)

                        $('.currPoor').text(Number(dta.poor.currPoor).toLocaleString())
                        $('.prevPoor').text(Number(dta.poor.prevPoor).toLocaleString())
                        var percConn = (Number(dta.poor.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.poor.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.poor.percent+' % </span>'
                        $('.changePoor').html(percConn)
                        /* BOX Inf Error */
                        $('#divInfErr .currTotal').text(Number(dta.totalInf.currTotal).toLocaleString())
                        $('#divInfErr .prevTotal').text(Number(dta.totalInf.prevTotal).toLocaleString())
                        var percInf = (Number(dta.totalInf.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.totalInf.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.totalInf.percent+' % </span>'
                        $('#divInfErr .changeTotal').html(percInf)

                        $('#divInfErr .currInfD').text(Number(dta.infDown.currInfD).toLocaleString())
                        $('#divInfErr .prevInfD').text(Number(dta.infDown.prevInfD).toLocaleString())
                        var percInfD = (Number(dta.infDown.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.infDown.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.infDown.percent+' % </span>'
                        $('#divInfErr .changeInf').html(percInfD)

                        $('#divInfErr .currUserD').text(Number(dta.userDown.currUserD).toLocaleString())
                        $('#divInfErr .prevUserD').text(Number(dta.userDown.prevUserD).toLocaleString())
                        var percUserD = (Number(dta.userDown.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.userDown.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.userDown.percent+' % </span>'
                        $('#divInfErr .changeDownU').html(percUserD)

                        $('#divInfErr .currSignal').text(Number(dta.signal.currSignal).toLocaleString())
                        $('#divInfErr .prevSignal').text(Number(dta.signal.prevSignal).toLocaleString())
                        var percSignal = (Number(dta.signal.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.signal.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.signal.percent+' % </span>'
                        $('#divInfErr .changeSignal').html(percSignal)

                        $('#divInfErr .currSf').text(Number(dta.sf.currSf).toLocaleString())
                        $('#divInfErr .prevSf').text(Number(dta.sf.prevSf).toLocaleString())
                        var percSf = (Number(dta.sf.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.sf.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.sf.percent+' % </span>'
                        $('#divInfErr .changeSf').html(percSf)

                        $('#divInfErr .currLofi').text(Number(dta.lofi.currLofi).toLocaleString())
                        $('#divInfErr .prevLofi').text(Number(dta.lofi.prevLofi).toLocaleString())
                        var percLofi = (Number(dta.lofi.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.lofi.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.lofi.percent+' % </span>'
                        $('#divInfErr .changeLofi').html(percLofi)

                        $('#divInfErr .currRouge').text(Number(dta.rouge.currRouge).toLocaleString())
                        $('#divInfErr .prevRouge').text(Number(dta.rouge.prevRouge).toLocaleString())
                        var percRouge = (Number(dta.rouge.percent) >=0)? '<span class="changeUp"><i class="fa fa-arrow-up" aria-hidden="true"></i> '+dta.rouge.percent+' % </span>' : '<span class="changeDown"><i class="fa fa-arrow-down" aria-hidden="true"></i> '+dta.rouge.percent+' % </span>'
                        $('#divInfErr .changeRouge').html(percRouge)
                    }
                    else{
                        $('#monthPickerTop').addClass('error')
                        alert('Have error. Please select other month !')
                    }
                },
                complete: function () {
                    $('#divTabCpe').waitMe("hide");
                },
            });
        }

        // for page TOP N
        function callAjaxTopN(month){
            var _typeError = $('#typeKibanaError').val()
            var _typeService = $('#typeServiceStatus').val()
            var _typeOLTpoor = $('#typeOLTpoor').val()
            var _typeInftoperr = $('#typeInftoperr').val()
            $.ajax({
                url: "/monthly/getTopN?month="+month+"&_typeError="+_typeError+"&_typeService="+_typeService+'&_typeOLTpoor='+_typeOLTpoor+'&_typeInftoperr='+_typeInftoperr,
                cache: false,
                beforeSend: function () {
                    $('#divTabTop').waitMe({
                        effect: 'roundBounce',
                        text: 'Please wait...',
                        bg: 'rgba(255,255,255,0.7)',
                        color: '#000',
                        textPos: 'vertical'
                    });
                },
                success: function (dta) {
                    if(dta != "Error"){
                        var monthStr = dta.month
                        $("#monthPickerTop").datepicker("update", monthStr)
                        $('#isClickedTab2').val(1)
                        // right click event
                        fntRightClick()
                        if(dta.province == "") {
                            // top 10 sigin
                            Highcharts.chart('bar-signin', {
                                chart: {
                                    type: 'bar'
                                },
                                title: {
                                    text: ''
                                },
                                xAxis: {
                                    type: 'category'
                                },
                                yAxis: {
                                    min: 0,
                                    title: {
                                        text: ''
                                    }
                                },
                                legend: {
                                    reversed: true,
                                    enabled: false
                                },
                                plotOptions: {
                                    series: {
                                        stacking: 'normal',
                                        point: {
                                            events: {
                                                contextmenu: function (e) {
                                                    if (e.target.point.name.indexOf('-') >= 0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        }
                                    }
                                },
                                tooltip: {
                                    headerFormat: '<span style = "font-size:11px">{series.name}</span><br>' + monthStr + '<br>',
                                    pointFormat: '<b>{point.name}: {point.y}</b><br/>Total signin clients: {point.k}'
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topSignin.dataProvince, dta.topSignin.dataClients),
                                    color: '#1ABB9C'
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topSignin.data, dta.topSignin.categories)
                                }
                            });
                            // top 10 Logoff
                            Highcharts.chart('bar-logoff', {
                                chart: {
                                    type: 'bar'
                                },
                                title: {
                                    text: ''
                                },
                                xAxis: {
                                    type: 'category'
                                },
                                yAxis: {
                                    min: 0,
                                    title: {
                                        text: ''
                                    }
                                },
                                tooltip: {
                                    headerFormat: '<span style = "font-size:11px">{series.name}</span><br>' + monthStr + '<br>',
                                    pointFormat: '<b>{point.name}: {point.y}</b><br/>Total logoff clients: {point.k}'
                                },
                                legend: {
                                    reversed: true,
                                    enabled: false
                                },
                                plotOptions: {
                                    series: {
                                        stacking: 'normal',
                                        point: {
                                            events: {
                                                contextmenu: function (e) {
                                                    if (e.target.point.name.indexOf('-') >= 0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        }
                                    }
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topLogoff.dataProvince, dta.topLogoff.dataClients),
                                    color: '#d9534f'
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topLogoff.data, dta.topLogoff.categories)
                                }
                            });
                            // top 10 bras outliers
                            Highcharts.chart('pie-bras', {
                                chart: {
                                    type: 'pie',
                                    options3d: {
                                        enabled: false,
                                        alpha: 45
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                plotOptions: {
                                    pie: {
                                        allowPointSelect: false,
                                        cursor: 'pointer',
                                        dataLabels: {
                                            enabled: true,
                                            format: '{point.name}: {point.percentage:.2f}%'
                                        },
                                        showInLegend: false
                                    },
                                    series: {
                                        point: {
                                            events: {
                                                contextmenu: function (e) {
                                                    if (e.target.point.name.indexOf('-') >= 0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        }
                                    }
                                },
                                colors: ['#9B59B6', '#3498DB', '#d9534f', '#f1b53d', '#1ABB9C', '#832d1d', '#09006d', '#cccccc', '#669999', '#e6e600'],
                                tooltip: {
                                    pointFormat: 'Total Bras Outliers: <b>{point.y} ({point.percentage:.2f}%)</b>'
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topBrasOut.dataProvince, dta.topBrasOut.dataClients)
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topBrasOut.data, dta.topBrasOut.categories)
                                }
                            });
                            // top 10 Kibana
                            Highcharts.chart('bar-kibana', {
                                chart: {
                                    type: 'bar'
                                },
                                title: {
                                    text: ''
                                },
                                xAxis: {
                                    type: 'category'
                                },
                                yAxis: {
                                    min: 0,
                                    title: {
                                        text: ''
                                    }
                                },
                                legend: {
                                    reversed: true
                                },
                                plotOptions: {
                                    series: {
                                        stacking: 'normal',
                                        point:{
                                            events: {
                                                contextmenu: function (e) {
                                                    if(e.target.point.name.indexOf('-') >=0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        },
                                        dataLabels: {
                                            enabled: true,
                                            align: 'top',
                                            color: '#FFFFFF',
                                            x: -10
                                        },
                                        pointPadding: 0.1,
                                        groupPadding: 0
                                    }
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topKibana.dataProvince, []),
                                    color: '#f1b53d'
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topKibana.data, dta.topKibana.categories)
                                }
                            });
                            // top 10 Opsview
                            Highcharts.chart('bar-opsview', {
                                chart: {
                                    type: 'bar'
                                },
                                title: {
                                    text: ''
                                },
                                xAxis: {
                                    type: 'category'
                                },
                                yAxis: {
                                    min: 0,
                                    title: {
                                        text: ''
                                    }
                                },
                                legend: {
                                    reversed: true
                                },
                                plotOptions: {
                                    series: {
                                        stacking: 'normal',
                                        point:{
                                            events: {
                                                contextmenu: function (e) {
                                                    if(e.target.point.name.indexOf('-') >=0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        },
                                        dataLabels: {
                                            enabled: true,
                                            align: 'top',
                                            color: '#FFFFFF',
                                            x: -10
                                        },
                                        pointPadding: 0.1,
                                        groupPadding: 0
                                    }
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topOpsview.dataProvince, []),
                                    color: '#73879C'
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topOpsview.data, dta.topOpsview.categories)
                                }
                            });
                            // top 10 Core Ticket
                            Highcharts.chart('pie-coreTicket', {
                                chart: {
                                    type: 'pie',
                                    options3d: {
                                        enabled: false,
                                        alpha: 45
                                    }
                                },
                                title: {
                                    text: ''
                                },
                                plotOptions: {
                                    pie: {
                                        allowPointSelect: false,
                                        cursor: 'pointer',
                                        dataLabels: {
                                            enabled: true,
                                            format: '{point.name}: {point.percentage:.2f}%'
                                        },
                                        showInLegend: false
                                    },
                                    series: {
                                        point: {
                                            events: {
                                                contextmenu: function (e) {
                                                    if (e.target.point.name.indexOf('-') >= 0)
                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                }
                                            }
                                        }
                                    }
                                },
                                colors: ['#9B59B6', '#3498DB', '#d9534f', '#f1b53d', '#1ABB9C', '#832d1d', '#09006d', '#cccccc', '#669999', '#e6e600'],
                                tooltip: {
                                    pointFormat: 'Total ticket: <b>{point.y} ({point.percentage:.2f}%)</b>'
                                },
                                series: [{
                                    name: 'Province',
                                    data: getJsonDrillParenthaveClients(dta.topCoreObj.dataProvince, dta.topCoreObj.dataClients)
                                }],
                                drilldown: {
                                    drillUpButton: {
                                        relativeTo: 'spacingBox',
                                        position: {
                                            y: 0,
                                            x: 0
                                        },
                                        theme: {
                                            fill: '#85d088',
                                            'stroke-width': 1,
                                            stroke: 'silver',
                                            r: 0,
                                            states: {
                                                hover: {
                                                    fill: '#85d088',
                                                }
                                            }
                                        }
                                    },
                                    series: getJsonDrillChildren(dta.topCoreObj.data, dta.topCoreObj.categories)
                                }
                            });
                        }
                        // top 10 Access Ticket
                        Highcharts.chart('pie-noneTicket', {
                            chart: {
                                type: 'pie',
                                options3d: {
                                    enabled: false,
                                    alpha: 45
                                }
                            },
                            title: {
                                text: ''
                            },
                            plotOptions: {
                                pie: {
                                    allowPointSelect: false,
                                    cursor: 'pointer',
                                    dataLabels: {
                                        enabled: true,
                                        format: '{point.name}: {point.percentage:.2f}%'
                                    },
                                    showInLegend: false
                                },
                                series: {
                                    point: {
                                        events: {
                                            contextmenu: function (e) {
                                                if (e.target.point.name.indexOf('-') >= 0)
                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                            }
                                        }
                                    }
                                }
                            },
                            colors: ['#9B59B6', '#3498DB', '#d9534f', '#f1b53d', '#1ABB9C', '#832d1d', '#09006d', '#cccccc', '#669999', '#e6e600'],
                            tooltip: {
                                pointFormat: 'Total ticket: <b>{point.y} ({point.percentage:.2f}%)</b>'
                            },
                            series: [{
                                name: 'Province',
                                data: getJsonDrillParenthaveClients(dta.topNoneCoreObj.dataProvince, dta.topNoneCoreObj.dataClients)
                            }],
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        y: 0,
                                        x: 0
                                    },
                                    theme: {
                                        fill: '#85d088',
                                        'stroke-width': 1,
                                        stroke: 'silver',
                                        r: 0,
                                        states: {
                                            hover: {
                                                fill: '#85d088',
                                            }
                                        }
                                    }
                                },
                                series: getJsonDrillChildren(dta.topNoneCoreObj.data, dta.topNoneCoreObj.categories)
                            }
                        });
                        // top 10 inf outliers
                        Highcharts.chart('pie-inf', {
                            chart: {
                                type: 'pie',
                                options3d: {
                                    enabled: false,
                                    alpha: 45
                                }
                            },
                            title: {
                                text: ''
                            },
                            plotOptions: {
                                pie: {
                                    allowPointSelect: false,
                                    cursor: 'pointer',
                                    dataLabels: {
                                        enabled: true,
                                        format: '{point.name}: {point.percentage:.2f}%'
                                    },
                                    showInLegend: false
                                },
                                series: {
                                    point:{
                                        events: {
                                            contextmenu: function (e) {
                                                if(e.target.point.name.indexOf('-') >=0)
                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                            }
                                        }
                                    }
                                }
                            },
                            colors : ['#9B59B6', '#3498DB', '#d9534f', '#f1b53d', '#1ABB9C', '#832d1d', '#09006d', '#cccccc', '#669999', '#e6e600'],
                            tooltip: {
                                pointFormat: 'Total Inf Outliers: <b>{point.y} ({point.percentage:.2f}%)</b>'
                            },
                            series: [{
                                name: 'Province',
                                data: getJsonDrillParenthaveClients(dta.topInfOut.dataProvince, dta.topInfOut.dataClients)
                            }],
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        y: 0,
                                        x: 0
                                    },
                                    theme: {
                                        fill: '#85d088',
                                        'stroke-width': 1,
                                        stroke: 'silver',
                                        r: 0,
                                        states: {
                                            hover: {
                                                fill: '#85d088',
                                            }
                                        }
                                    }
                                },
                                series: getJsonDrillChildren(dta.topInfOut.data,dta.topInfOut.categories)
                            }
                        });
                        // top 20 Inf
                        Highcharts.chart('bar-inf', {
                            chart: {
                                type: 'column'
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                type: 'category'
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: ''
                                }
                            },
                            tooltip : {
                                headerFormat: '<span style = "font-size:11px">{series.name}</span><br>',
                                pointFormat: '<span style = "color:{point.color}">{point.name}</span>: <b>{point.y}</b>'
                            },
                            legend: {
                                reversed: true,
                                enabled: false
                            },
                            plotOptions: {
                                series: {
                                    stacking: 'normal',
                                    point:{
                                        events: {
                                            contextmenu: function (e) {
                                                if(e.target.point.name.indexOf('-') >=0)
                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                            }
                                        }
                                    }
                                }
                            },
                            series: getDrildownForCol(dta.topInf.data, dta.topInf.cates),
                            drilldown:{
                                drillUpButton:{
                                    relativeTo: 'spacingBox',
                                    position:{
                                        align:"right",
                                        verticalAlign:"top",
                                        x:10,
                                        y:-10
                                    }
                                },
                                series: getDrillDown2LevelForCol(dta.topInf.data, dta.topInf.cates)
                            }
                        });
                        // top 10 Suyhao
                        Highcharts.chart('bar-suyhao', {
                            chart: {
                                type: 'bar'
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                type: 'category'
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: ''
                                }
                            },
                            legend: {
                                reversed: true,
                                enabled: false
                            },
                            tooltip: {
                                formatter: function () {
                                    return '<b>' + this.point.name +'</b><br>Total: ' +
                                            Highcharts.numberFormat(this.point.y,0) + '<br/> Total clients: '+ Highcharts.numberFormat(this.point.k,0);
                                }
                            },
                            plotOptions: {
                                series: {
                                    stacking: 'normal'
                                }
                            },
                            series: [{
                                name: 'Province',
                                data: getJsonDrillParenthaveClients(dta.topSuyhao.dataProvince, dta.topSuyhao.dataClients),
                                color: '#1ABB9C'
                            }],
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        y: 0,
                                        x: 0
                                    },
                                    theme: {
                                        fill: '#85d088',
                                        'stroke-width': 1,
                                        stroke: 'silver',
                                        r: 0,
                                        states: {
                                            hover: {
                                                fill: '#85d088',
                                            }
                                        }
                                    }
                                },
                                series: getJsonDrillChildren(dta.topSuyhao.data,dta.topSuyhao.categories)
                            }
                        });
                        // top 10 Poor conn
                        Highcharts.chart('bar-poor', {
                            chart: {
                                type: 'bar'
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                type: 'category'
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: ''
                                }
                            },
                            legend: {
                                reversed: true
                            },
                            plotOptions: {
                                series: {
                                    stacking: 'normal'
                                }
                            },
                            tooltip: {
                                formatter: function () {
                                    return '<b>' + this.point.name +'</b><br>Total: ' +
                                            Highcharts.numberFormat(this.point.y,0)
                                }
                            },
                            series: [{
                                name: 'Province',
                                data: getJsonDrillParenthaveClients(dta.topPoor.dataProvince, []),
                                color: '#9B59B6'
                            }],
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        y: 0,
                                        x: 0
                                    },
                                    theme: {
                                        fill: '#85d088',
                                        'stroke-width': 1,
                                        stroke: 'silver',
                                        r: 0,
                                        states: {
                                            hover: {
                                                fill: '#85d088',
                                            }
                                        }
                                    }
                                },
                                series: getJsonDrillChildren(dta.topPoor.data, dta.topPoor.categories)
                            }
                        });
                    }
                },
                complete: function () {
                    $('#divTabTop').waitMe("hide");
                },
            });
        }

        function getHeatmapBrasOutlier(data, key){
            var rs = []
            for(var i=0;i<key.length;i++){
                var sumVl = 0
                for(var k=0;k<data.length;k++){
                    if(data[k][0] == key[i]){
                        sumVl += data[k][1]
                    }
                }
                rs.push([0, i, sumVl])
            }
            return rs
        }

        //drilldown heat map Inf Outliers
        function callDrilldownOutlier(cates, _type, db){
            if(isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0 && cates.length>=10 && cates.indexOf(" ")<0) {
                console.log('do not drilldown host')
            }
            else {
                $.ajax({
                    url: "/monthly/ddOutlierByMonth?id=" + cates + "&fromMonth=" + $('#startMonth').val() + "&toMonth=" + $('#endMonth').val() + "&db=" + db,
                    cache: false,
                    success: function (dta) {
                        if (dta != "Error") {
                            if(dta.key != "empty" && dta.data.length > 0) {
                                if (db == "inf") {
                                    var vlMarTop1 = 40
                                    if (cates == "*") vlMarTop1 = 10
                                    Highcharts.chart('inf-outlier', {
                                        chart: {
                                            type: 'heatmap',
                                            marginTop: vlMarTop1,
                                            marginBottom: 60,
                                            plotBorderWidth: 1
                                        },

                                        title: {
                                            text: ''
                                        },
                                        xAxis: {
                                            categories: ["Outliers"]
                                        },

                                        yAxis: {
                                            categories: dta.key,
                                            title: null,
                                            labels: {
                                                style: {
                                                    'min-width': ($(window).width() <= 1280) ? '40px' : '125px'
                                                },
                                                useHTML: true
                                            }
                                        },

                                        legend: {
                                            align: 'center',
                                            verticalAlign: 'bottom',
                                            y: 20,
                                            x: 40
                                        },

                                        colorAxis: {
                                            min: 0,
                                            minColor: '#FFFFFF',
                                            maxColor: '#1194a9'
                                        },

                                        tooltip: {
                                            formatter: function () {
                                                return '<b>' + this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                        this.point.value + ' outliers</b> ';
                                            }
                                        },
                                        plotOptions: {
                                            series: {
                                                events: {
                                                    click: function (event) {
                                                        callDrilldownOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown', 'inf')
                                                    }
                                                },
                                                dataLabels: {
                                                    formatter: function () {
                                                        var nf = new Intl.NumberFormat();
                                                        return nf.format(this.point.value);
                                                    }
                                                },
                                                cursor: 'pointer'
                                            }
                                        },
                                        exporting: {
                                            buttons: [{
                                                text: 'Back to ' + dta.location,
                                                onclick: function (e) {
                                                    var id = "*"
                                                    var tit = "back"
                                                    if ($('#textInfOutlier').val() == "Back to province") {
                                                        tit = "drilldown"
                                                        id = $('#isRegionInfOutlier').val()
                                                        $('#textInfOutlier').val('Back to region')
                                                    }
                                                    if ($('#textInfOutlier').val() == "Back to bras") {
                                                        tit = "drilldown"
                                                        id = $('#isProvinceInfOutlier').val()
                                                        $('#textInfOutlier').val('Back to province')
                                                    }
                                                    callDrilldownOutlier(id, tit, 'inf')
                                                },
                                                theme: {
                                                    fill: '#1ABB9C',
                                                    'stroke-width': 1,
                                                    stroke: '#169F85',
                                                    color: '#fff',
                                                    states: {
                                                        hover: {
                                                            fill: '#1ABB9C'
                                                        }
                                                    }
                                                }
                                            }]
                                        },
                                        series: [{
                                            name: 'Outliers',
                                            borderWidth: 1,
                                            data: getHeatmapBrasOutlier(dta.data, dta.key),
                                            dataLabels: {
                                                enabled: true,
                                                color: '#000000'
                                            }
                                        }]

                                    });
                                    if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                        $('#isRegionInfOutlier').val(cates)
                                        $('#textInfOutlier').val("Back to region")
                                    }
                                    if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                        $('#isProvinceInfOutlier').val(cates)
                                        $('#textInfOutlier').val("Back to province")
                                    }
                                    else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                        $('#textInfOutlier').val("Back to bras")
                                    }
                                    // Apply for button back
                                    if (_type == 'drilldown') {
                                        $('#inf-outlier .highcharts-button').show()
                                        $('.highcharts-contextbutton').hide()
                                    }
                                    else {
                                        $('#inf-outlier .highcharts-button').hide()
                                    }
                                }
                                else {
                                    var vlMarTop = 40
                                    if (cates == "*") vlMarTop = 10
                                    Highcharts.chart('bras-outlier', {
                                        chart: {
                                            type: 'heatmap',
                                            marginTop: vlMarTop,
                                            marginBottom: 60,
                                            plotBorderWidth: 1
                                        },

                                        title: {
                                            text: ''
                                        },
                                        xAxis: {
                                            categories: ["Outliers"]
                                        },

                                        yAxis: {
                                            categories: dta.key,
                                            title: null,
                                            labels: {
                                                style: {
                                                    'min-width': ($(window).width() <= 1280) ? '20px' : '125px'
                                                },
                                                useHTML: true
                                            }
                                        },

                                        legend: {
                                            align: 'center',
                                            verticalAlign: 'bottom',
                                            y: 20,
                                            x: 40
                                        },

                                        colorAxis: {
                                            min: 0,
                                            minColor: '#FFFFFF',
                                            maxColor: '#1ABB9C'
                                        },

                                        tooltip: {
                                            formatter: function () {
                                                return '<b>' + this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                        this.point.value + ' outliers</b> ';
                                            }
                                        },
                                        plotOptions: {
                                            series: {
                                                events: {
                                                    click: function (event) {
                                                        callDrilldownOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown', 'bras')
                                                    }
                                                },
                                                dataLabels: {
                                                    formatter: function () {
                                                        var nf = new Intl.NumberFormat();
                                                        return nf.format(this.point.value);
                                                    }
                                                },
                                                cursor: 'pointer'
                                            }
                                        },
                                        exporting: {
                                            buttons: [{
                                                text: 'Back to ' + dta.location,
                                                onclick: function (e) {
                                                    var id = "*"
                                                    var tit = "back"
                                                    if ($('#textBrasOutlier').val() == "Back to province") {
                                                        tit = "drilldown"
                                                        id = $('#isRegionBrasOutlier').val()
                                                        $('#textBrasOutlier').val('Back to region')
                                                    }
                                                    if ($('#textBrasOutlier').val() == "Back to bras") {
                                                        tit = "drilldown"
                                                        id = $('#isProvinceBrasOutlier').val()
                                                        $('#textBrasOutlier').val('Back to province')
                                                    }
                                                    callDrilldownOutlier(id, tit, 'bras')
                                                },
                                                theme: {
                                                    fill: '#1ABB9C',
                                                    'stroke-width': 1,
                                                    stroke: '#169F85',
                                                    color: '#fff',
                                                    states: {
                                                        hover: {
                                                            fill: '#1ABB9C'
                                                        }
                                                    }
                                                }
                                            }]
                                        },
                                        series: [{
                                            name: 'Outliers',
                                            borderWidth: 1,
                                            data: getHeatmapBrasOutlier(dta.data, dta.key),
                                            dataLabels: {
                                                enabled: true,
                                                color: '#000000'
                                            }
                                        }]

                                    });
                                    if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                        $('#isRegionBrasOutlier').val(cates)
                                        $('#textBrasOutlier').val("Back to region")
                                    }
                                    if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                        $('#isProvinceBrasOutlier').val(cates)
                                        $('#textBrasOutlier').val("Back to province")
                                    }
                                    else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                        $('#textBrasOutlier').val("Back to bras")
                                    }
                                    // Apply for button back
                                    if (_type == 'drilldown') {
                                        $('#bras-outlier .highcharts-button').show()
                                        $('.highcharts-contextbutton').hide()
                                    }
                                    else {
                                        $('#bras-outlier .highcharts-button').hide()
                                    }
                                }
                                // right click yAxis
                                $('#' + db + '-outlier .highcharts-yaxis-labels span').mousedown(function (e) {
                                    if (e.which == 3 && e.target.innerHTML.indexOf('-') >= 0) {
                                        window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                    }
                                    return false;
                                });
                            }
                        }
                        else {
                            alert("Error when execute query. Please check again your system!")
                        }
                    }
                })
            }
        }

        function getSeries3LevelStackBar(dta,arrKey,arrMonth){
            var jsArray = []
            var colors = ['#d9534f', '#73879C', '#1ABB9C', '#f1b53d', '#E74C3C', '#73879C', '#832d1d', '#0000cc', '#09006d', '#cccccc', '#669999',
                '#f2ccff', '#e6e600', '#132639', '#99cc00', '#466d6d', '#ffc6b3', '#666633', '#ffff00'];
            for(var month=0;month< arrMonth.length;month++ ){
                var arrData = []
                for(var key=0;key<arrKey.length;key++ ) {
                    var sumVl =0
                    for (var i = 0; i < dta.length; i++) {
                        if (arrMonth[month] == dta[i][0] && arrKey[key] == dta[i][1]){
                            sumVl += dta[i][5]
                        }
                    }
                    arrData.push({
                        name: arrKey[key],
                        y: sumVl,
                        drilldown: arrKey[key]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                    })
                }
                var color = colors[month]
                jsArray.push({
                    name: arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                    data: arrData,
                    color: color
                })
            }
            return jsArray
        }

        function getDrillDown3LevelStack(dta, arrMonth, arrRegion){
            var jsArray = []
            for(var region=0;region< arrRegion.length;region++ ){
                for(var month=0;month< arrMonth.length;month++){
                    var rsProvince = [], rsBras = [], rsHost = []
                    // get array provinces and bras by month&region
                    var arr3Level = []
                    for (var i = 0; i < dta.length; i++) {
                        if (arrMonth[month] == dta[i][0] && arrRegion[region] == dta[i][1]) {
                            arr3Level.push({
                                province: dta[i][2],
                                bras: dta[i][3],
                                host: dta[i][4],
                                value: dta[i][5]
                            })
                        }
                    }
                    var resultProvinces = []
                    // level province
                    arr3Level.reduce(function (res, value) {
                        if (!res[value.province]) {
                            res[value.province] = {province: value.province, value: 0};
                            resultProvinces.push(res[value.province])
                        }
                        res[value.province].value += value.value;
                        return res;
                    }, {});
                    resultProvinces.forEach(function (item) {
                        var resultBras = []
                        // level bras
                        var arrBrasLevel = []
                        arrBrasLevel.push(arr3Level.filter(function (o) {
                            return o.province === item.province;
                        }));
                        arrBrasLevel[0].reduce(function (res, value) {
                            if (!res[value.bras]) {
                                res[value.bras] = {bras: value.bras, value: 0};
                                resultBras.push(res[value.bras])
                            }
                            res[value.bras].value += value.value;
                            return res;
                        }, {});
                        resultBras.forEach(function (itemBras) {
                            var resultHost = []
                            // level host
                            var arrHostLevel = []
                            arrHostLevel.push(arrBrasLevel[0].filter(function (o) {
                                return o.bras === itemBras.bras;
                            }));
                            arrHostLevel[0].reduce(function (res, value) {
                                if (!res[value.host]) {
                                    res[value.host] = {host: value.host, value: 0};
                                    resultHost.push(res[value.host])
                                }
                                res[value.host].value += value.value;
                                return res;
                            }, {});
                            resultHost.forEach(function (itemHost) {
                                rsHost.push({
                                    name: itemHost.host,
                                    y: itemHost.value
                                })
                            })
                            // set series bras& host
                            jsArray.push({
                                id: item.province + '-'+itemBras.bras + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                                name: itemBras.bras + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                                data: rsHost
                            })
                            rsHost = []
                            rsBras.push({
                                name: itemBras.bras,
                                y: itemBras.value,
                                drilldown: item.province + '-'+itemBras.bras + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-"))
                            })
                        })
                        // set series province& bras
                        jsArray.push({
                            id: item.province + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                            name: item.province + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                            data: rsBras
                        })
                        rsBras = []
                        rsProvince.push({
                            name: item.province,
                            y: item.value,
                            drilldown: item.province + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-"))
                        })
                    });
                    // set series region & province
                    jsArray.push({
                        id: arrRegion[region] + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                        name: arrRegion[region] + '-' + arrMonth[month].substring(0, arrMonth[month].lastIndexOf("-")),
                        data: rsProvince
                    })
                    rsProvince = []
                }

            }
            return jsArray
        }
</script>