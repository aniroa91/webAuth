@(response: model.device.RegionOverview, province: String)
@import play.api.libs.json.Json
@import services.domain.CommonService.getEndDate
@import services.domain.CommonService.getStartDate

<script type="text/javascript">
        $(document).ready(function(){
                $('[data-toggle="tooltip"]').tooltip();
                @if(response != null){
                // datepicker for tab TopN
                $('#monthPickerTop').datepicker({
                        autoclose: true,
                        minViewMode: 1,
                        endDate: '-1m',
                        format: 'yyyy-mm'
                }).on('changeDate', function (selected) {
                        var startDate = new Date(selected.date.valueOf());
                        var yr = startDate.getFullYear();
                        var month = startDate.getMonth() < 9 ? ('0' + Number(startDate.getMonth() + 1)) : (Number(startDate.getMonth() + 1));
                        var newDate = yr + '-' + month
                        if($('.tabControl .active').attr('name') == 'tabTop')
                           callAjaxTopN(newDate)
                        else if($('.tabControl .active').attr('name') == 'tabCompare')
                           callAjaxCompare(newDate)
                });
                // datepicker for tab Overview
                $('#startMonth').datepicker({
                        autoclose: true,
                        minViewMode: 1,
                        startDate: '@getStartDate(response.time.startMonth+"-01")',
                        endDate: '@getEndDate(response.time.endMonth+"-01")',
                        format: 'yyyy-mm'
                }).on('changeDate', function (selected) {
                        //get month choosed
                        var startDate = new Date(selected.date.valueOf());
                        var yr = startDate.getFullYear();
                        var month = startDate.getMonth() < 10 ? ('0' + Number(startDate.getMonth() + 1)) : (Number(startDate.getMonth() + 1));
                        var newDate = yr + '-' + month;
                        $("#endMonth").data('datepicker').setStartDate(newDate);
                });
                $('#endMonth').datepicker({
                        autoclose: true,
                        minViewMode: 1,
                        endDate: '@getEndDate(response.time.endMonth+"-01")',
                        startDate: '@getStartDate(response.time.startMonth+"-01")',
                        format: 'yyyy-mm'
                }).on('changeDate', function (selected) {
                        var startDate = new Date(selected.date.valueOf());
                        var yr = startDate.getFullYear();
                        var month = startDate.getMonth() < 10 ? ('0' + Number(startDate.getMonth() + 1)) : (Number(startDate.getMonth() + 1));
                        var newDate = yr + '-' + month;
                        $("#startMonth").data('datepicker').setEndDate(newDate);
                });
                }

                $(".tab-slider--body").hide();
                $(".tab-slider--body:first").show();

                /* TAB OVERVIEW*/
                // Click radio button choose Count Type Noc
                $('#frmNoccount input:radio').change(function(){
                        $('#frmNoccount .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeNocCount').val(id)
                        $.ajax({
                                url: "/monthly/region-countType?id=" + id.trim()+"&month="+$('#monthGroup').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                Highcharts.chart('region-nocCount', {

                                                        legend: {
                                                                enabled: true
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        yAxis: {
                                                                title: {
                                                                        text: 'Counts'
                                                                }
                                                        },
                                                        tooltip: {
                                                                formatter: function () {
                                                                        return 'Region: ' + this.point.name + '<br/>'+this.series.name + '<br/> '+$('#monthGroup').val()+'<br/>'
                                                                                +'<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0)+'</b>';
                                                                }
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        colors:['#f60'],
                                                        plotOptions: {
                                                                series: {
                                                                        point: {
                                                                                events: {
                                                                                        contextmenu: function (e) {
                                                                                                if($('#brasRighClick').val().indexOf('-') >=0)
                                                                                                        window.open("/fwdRequest?bras=" + $('#brasRighClick').val(), "_blank")
                                                                                        },
                                                                                        mouseOver: function () {
                                                                                                if(this.name.indexOf('-')>=0)
                                                                                                        $('#brasRighClick').val(this.name)
                                                                                        }
                                                                                }
                                                                        }
                                                                }
                                                        },
                                                        series: [{
                                                                name: id,
                                                                data: getDrillDownStackedAndLine( dta.dtaByRegion)
                                                        }],
                                                        drilldown:{
                                                                drillUpButton:{
                                                                        relativeTo: 'spacingBox',
                                                                        position:{
                                                                                align:"right",
                                                                                verticalAlign:"top",
                                                                                x:10,
                                                                                y:-10
                                                                        }
                                                                },
                                                                series: getDrillDownNotStacked2Level(dta.data,dta.arrRegion)
                                                        }
                                                });
                                        }
                                },
                        });
                })
                // Click radio button choose INF down error
                $('#frmInferror input:radio').change(function(){
                        $('#frmInferror .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeInfError').val(id)
                        $('#divallMonth a.month').removeClass('btn-success')
                        $('#divallMonth a.month').addClass('btnDefault')
                        $.ajax({
                                url: "/monthly/region-errorType?id=" + id.trim()+"&month="+$('#monthGroup').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                Highcharts.chart('region-infError', {
                                                        chart: {
                                                                type:  @province.equals("") ? 'areaspline' : 'bar'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        legend: {
                                                                enabled: true
                                                        },
                                                        yAxis: {
                                                                title: {
                                                                        text: ''
                                                                }
                                                        },
                                                        tooltip: {
                                                                formatter: function () {
                                                                        return 'Region: ' + this.point.name + '<br/>'+this.series.name + '<br/> '+$('#monthGroup').val()+'<br/>'
                                                                                +'<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0)+'</b>';
                                                                }
                                                        },
                                                        plotOptions: {
                                                                series: {
                                                                        point: {
                                                                                events: {
                                                                                        contextmenu: function (e) {
                                                                                                if($('#brasRighClick').val().indexOf('-') >=0)
                                                                                                        window.open("/fwdRequest?bras=" + $('#brasRighClick').val(), "_blank")
                                                                                        },
                                                                                        mouseOver: function () {
                                                                                                if(this.name.indexOf('-')>=0)
                                                                                                        $('#brasRighClick').val(this.name)
                                                                                        }
                                                                                }
                                                                        }
                                                                }
                                                        },
                                                        colors: ['#5A738E'],
                                                        series: [{
                                                                name: id,
                                                                data: getDrillDownStackedAndLine( dta.dtaByRegion)
                                                        }],
                                                        drilldown:{
                                                                drillUpButton:{
                                                                        relativeTo: 'spacingBox',
                                                                        position:{
                                                                                align:"right",
                                                                                verticalAlign:"top",
                                                                                x:10,
                                                                                y:-10
                                                                        }
                                                                },
                                                                series: getDrillDownNotStacked2Level(dta.data,dta.arrRegion)
                                                        }
                                                });
                                        }
                                },
                        });
                })

                /*TAB TOP N*/
                // Click kibana error types
                $('#frmKibanaError input:radio').change(function(){
                        $('#frmKibanaError .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeKibanaError').val(id)
                        $.ajax({
                                url: "/topN/region-errorKibana?id=" + id.trim()+"&month="+$('#month').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                // top 10 Kibana
                                                // right click event
                                                fntRightClick()
                                                Highcharts.chart('bar-kibana', {
                                                        chart: {
                                                                type: 'bar'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        yAxis: {
                                                                min: 0,
                                                                title: {
                                                                        text: ''
                                                                }
                                                        },
                                                        legend: {
                                                                reversed: true
                                                        },
                                                        plotOptions: {
                                                                series: {
                                                                        stacking: 'normal',
                                                                        dataLabels: {
                                                                                enabled: true,
                                                                                align: 'top',
                                                                                color: '#FFFFFF',
                                                                                x: -10
                                                                        },
                                                                        point:{
                                                                                events: {
                                                                                        contextmenu: function (e) {
                                                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                                                        }
                                                                                }
                                                                        },
                                                                        pointPadding: 0.1,
                                                                        groupPadding: 0
                                                                }
                                                        },
                                                        series: [{
                                                                name: 'Province',
                                                                data: getJsonDrillParenthaveClients(dta.dataProvince, []),
                                                                color: '#f1b53d'
                                                        }],
                                                        drilldown: {
                                                                drillUpButton: {
                                                                        relativeTo: 'spacingBox',
                                                                        position: {
                                                                                y: 0,
                                                                                x: 0
                                                                        },
                                                                        theme: {
                                                                                fill: '#85d088',
                                                                                'stroke-width': 1,
                                                                                stroke: 'silver',
                                                                                r: 0,
                                                                                states: {
                                                                                        hover: {
                                                                                                fill: '#85d088',
                                                                                        }
                                                                                }
                                                                        }
                                                                },
                                                                series: getJsonDrillChildren(dta.data, dta.categories)
                                                        }
                                                });
                                        }
                                },
                        });
                })
                // Click Opsview status
                $('#frmServiceStatus input:radio').change(function(){
                        $('#frmServiceStatus .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeServiceStatus').val(id)
                        $.ajax({
                                url: "/topN/region-serviceStatus?id=" + id.trim()+"&month="+$('#month').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                // top 10 Opsview
                                                // right click event
                                                fntRightClick()
                                                Highcharts.chart('bar-opsview', {
                                                        chart: {
                                                                type: 'bar'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        yAxis: {
                                                                min: 0,
                                                                title: {
                                                                        text: ''
                                                                }
                                                        },
                                                        legend: {
                                                                reversed: true
                                                        },
                                                        plotOptions: {
                                                                series: {
                                                                        stacking: 'normal',
                                                                        dataLabels: {
                                                                                enabled: true,
                                                                                align: 'top',
                                                                                color: '#FFFFFF',
                                                                                x: -10
                                                                        },
                                                                        point:{
                                                                                events: {
                                                                                        contextmenu: function (e) {
                                                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                                                        }
                                                                                }
                                                                        },
                                                                        pointPadding: 0.1,
                                                                        groupPadding: 0
                                                                }
                                                        },
                                                        series: [{
                                                                name: 'Province',
                                                                data: getJsonDrillParenthaveClients(dta.dataProvince, []),
                                                                color: '#73879C'
                                                        }],
                                                        drilldown: {
                                                                drillUpButton: {
                                                                        relativeTo: 'spacingBox',
                                                                        position: {
                                                                                y: 0,
                                                                                x: 0
                                                                        },
                                                                        theme: {
                                                                                fill: '#85d088',
                                                                                'stroke-width': 1,
                                                                                stroke: 'silver',
                                                                                r: 0,
                                                                                states: {
                                                                                        hover: {
                                                                                                fill: '#85d088',
                                                                                        }
                                                                                }
                                                                        }
                                                                },
                                                                series: getJsonDrillChildren(dta.data, dta.categories)
                                                        }
                                                });
                                        }
                                }
                        });
                })
                // Click OLT poor connections
                $('#frmOLTpoor input:radio').change(function(){
                        $('#frmOLTpoor .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeOLTpoor').val(id)
                        $.ajax({
                                url: "/topN/region-OltPoorconn?id=" + id.trim()+"&month="+$('#month').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                // top 10 Poor conn
                                                Highcharts.chart('bar-poor', {
                                                        chart: {
                                                                type: 'bar'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        yAxis: {
                                                                min: 0,
                                                                title: {
                                                                        text: ''
                                                                }
                                                        },
                                                        legend: {
                                                                reversed: true
                                                        },
                                                        plotOptions: {
                                                                series: {
                                                                        stacking: 'normal'
                                                                }
                                                        },
                                                        tooltip: {
                                                                formatter: function () {
                                                                        return '<b>' + this.point.name +'</b><br>Total: ' +
                                                                                Highcharts.numberFormat(this.point.y,0)
                                                                }
                                                        },
                                                        series: [{
                                                                name: 'Province',
                                                                data: getJsonDrillParenthaveClients(dta.dataProvince, []),
                                                                color: '#9B59B6'
                                                        }],
                                                        drilldown: {
                                                                drillUpButton: {
                                                                        relativeTo: 'spacingBox',
                                                                        position: {
                                                                                y: 0,
                                                                                x: 0
                                                                        },
                                                                        theme: {
                                                                                fill: '#85d088',
                                                                                'stroke-width': 1,
                                                                                stroke: 'silver',
                                                                                r: 0,
                                                                                states: {
                                                                                        hover: {
                                                                                                fill: '#85d088',
                                                                                        }
                                                                                }
                                                                        }
                                                                },
                                                                series: getJsonDrillChildren(dta.data, dta.categories)
                                                        }
                                                });
                                        }
                                },
                        });
                })
                // Click Inf errors
                $('#frmInfToperr input:radio').change(function(){
                        $('#frmInfToperr .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeInftoperr').val(id)
                        $.ajax({
                                url: "/topN/region-InfTopErr?id=" + id.trim()+"&month="+$('#month').val(),
                                cache: false,
                                success: function (dta) {
                                        if(dta != "Error"){
                                                // top 10 Inf
                                                // right click event
                                                fntRightClick()
                                                Highcharts.chart('bar-inf', {
                                                        chart: {
                                                                type: 'column'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        xAxis: {
                                                                type: 'category'
                                                        },
                                                        yAxis: {
                                                                min: 0,
                                                                title: {
                                                                        text: ''
                                                                }
                                                        },
                                                        tooltip : {
                                                                headerFormat: '<span style = "font-size:11px">{series.name}</span><br>',
                                                                pointFormat: '<span style = "color:{point.color}">{point.name}</span>: <b>{point.y}</b>'
                                                        },
                                                        legend: {
                                                                reversed: true
                                                        },
                                                        plotOptions: {
                                                                series: {
                                                                        stacking: 'normal',
                                                                        point:{
                                                                                events: {
                                                                                        contextmenu: function (e) {
                                                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                                                        }
                                                                                }
                                                                        }
                                                                }
                                                        },
                                                        series: getDrildownForCol(dta.data, dta.cates),
                                                        drilldown:{
                                                                drillUpButton:{
                                                                        relativeTo: 'spacingBox',
                                                                        position:{
                                                                                align:"right",
                                                                                verticalAlign:"top",
                                                                                x:10,
                                                                                y:-10
                                                                        }
                                                                },
                                                                series: getDrillDown2LevelForCol(dta.data, dta.cates)
                                                        }
                                                });
                                        }
                                },
                        });
                })

                @if(response != null){
                fntRightClick()
                @if(province.equals("")){
                        // Bar Logoff and Signin
                        var categoriesSigLog = ["Vung 1", "Vung 2", "Vung 3", "Vung 4", "Vung 5", "Vung 6", "Vung 7"]
                        Highcharts.chart('region-siglog-bar', {
                                chart: {
                                        type: 'bar'
                                },
                                title: {
                                        text: ''
                                },
                                subtitle: {
                                        text: ''
                                },
                                xAxis: [{
                                        categories: categoriesSigLog,
                                        reversed: false,
                                }, { // mirror axis on right side
                                        opposite: true,
                                        reversed: false,
                                        categories: categoriesSigLog,
                                        linkedTo: 0,
                                }],
                                yAxis: {
                                        title: {
                                                text: null
                                        },
                                        labels: {
                                                formatter: function () {
                                                        return Math.abs(this.value);
                                                }
                                        },
                                },

                                plotOptions: {
                                        series: {
                                                events: {
                                                        click: function (event) {
                                                                callDrilldownSigLog(event.point.category)
                                                        }
                                                },
                                                cursor: 'pointer',
                                                stacking: 'normal'
                                        }
                                },

                                tooltip: {
                                        formatter: function () {
                                                return '<b>' + this.series.name + '</b><br/><b>Region: ' + this.point.category + '</b><br/>'
                                                        + '<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b><br/>Total clients: ' + Highcharts.numberFormat(Math.abs(this.point.k), 0);
                                        }
                                },

                                series: getSigLogByRegionStacked(@Html(Json.stringify(Json.toJson(response.sigLogRegion.signin))), @Html(Json.stringify(Json.toJson(response.sigLogRegion.logoff))), @Html(Json.stringify(Json.toJson(response.sigLogRegion.signin_clients))), @Html(Json.stringify(Json.toJson(response.sigLogRegion.logoff_clients))), 0)
                        });
                        // Ticket at Core Group
                        Highcharts.chart('ticket-core', {
                                chart: {
                                        type: 'bar'
                                },
                                title: {
                                        text: ''
                                },
                                xAxis: {
                                        type:'category'
                                },
                                yAxis: {
                                        min: 0,
                                        title: {
                                                text: ''
                                        }
                                },
                                legend: {
                                        reversed: true
                                },
                                plotOptions: {
                                        series: {
                                                stacking: 'normal',
                                                point:{
                                                        events:{
                                                                contextmenu: function (e) {
                                                                        if(e.target.point.name.indexOf('-') >=0)
                                                                                window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                                }
                                                        }
                                                }
                                        }
                                },
                                series: getSeries3LevelStackBar(@Html(Json.stringify(Json.toJson(response.ticketIssue._1))),@Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._2).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._1).toSeq.distinct.sortWith(_>_))))),
                                drilldown:{
                                        drillUpButton:{
                                                relativeTo: 'spacingBox',
                                                position:{
                                                        align:"right",
                                                        verticalAlign:"top",
                                                        x:10,
                                                        y:-10
                                                }
                                        },
                                        series: getDrillDown3LevelStack(@Html(Json.stringify(Json.toJson(response.ticketIssue._1))),@Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._1).toSeq.distinct.sortWith(_>_)))),
                                                @Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._2).toSeq.distinct.sorted))))
                                }
                        });
                        // Total Opsview by Region
                        Highcharts.chart('region-opsview', {
                                chart: {
                                        type: 'bar'
                                },
                                title: {
                                        text: ''
                                },
                                xAxis: {
                                        type:'category'
                                },
                                yAxis: {
                                        min: 0,
                                        title: {
                                                text: ''
                                        }
                                },
                                legend: {
                                        reversed: true
                                },
                                plotOptions: {
                                        series: {
                                                stacking: 'normal',
                                                point:{
                                                        events:{
                                                                contextmenu: function (e) {
                                                                        if(e.target.point.name.indexOf('-') >=0)
                                                                                window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                                }
                                                        }
                                                }
                                        }
                                },
                                series: getDrildownStackBar(@Html(Json.stringify(Json.toJson(response.opsviews))),@Html(Json.stringify(Json.toJson(response.opsviews.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.opsviews.map(x=> x._1).toSeq.distinct))),0),
                                drilldown:{
                                        drillUpButton:{
                                                relativeTo: 'spacingBox',
                                                position:{
                                                        align:"right",
                                                        verticalAlign:"top",
                                                        x:10,
                                                        y:-10
                                                }
                                        },
                                        series: getDrillDown2Level(@Html(Json.stringify(Json.toJson(response.opsviews))),@Html(Json.stringify(Json.toJson(response.opsviews.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.opsviews.map(x=> x._1).toSeq.distinct))),'normal')
                                }
                        });
                        // Total Opsview by Region
                        Highcharts.chart('region-kibana', {
                        chart: {
                                type: 'bar'
                        },
                        title: {
                                text: ''
                        },
                        xAxis: {
                                type:'category'
                        },
                        yAxis: {
                                min: 0,
                                title: {
                                        text: ''
                                }
                        },
                        legend: {
                                reversed: true
                        },
                        plotOptions: {
                                series: {
                                        stacking: 'normal',
                                        point:{
                                                events: {
                                                        contextmenu: function (e) {
                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                        }
                                                }
                                        }
                                }
                        },
                        series: getDrildownStackBar(@Html(Json.stringify(Json.toJson(response.kibana))),@Html(Json.stringify(Json.toJson(response.kibana.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.kibana.map(x=> x._1).toSeq.distinct))),1),
                        drilldown:{
                                drillUpButton:{
                                        relativeTo: 'spacingBox',
                                        position:{
                                                align:"right",
                                                verticalAlign:"top",
                                                x:10,
                                                y:-10
                                        }
                                },
                                series: getDrillDown2Level(@Html(Json.stringify(Json.toJson(response.kibana))),@Html(Json.stringify(Json.toJson(response.kibana.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.kibana.map(x=> x._1).toSeq.distinct))),'normal')}
                });
                }
                // Ticket at Access Group
                Highcharts.chart('ticket-noneCore', {
                        chart: {
                                type: 'bar'
                        },
                        title: {
                                text: ''
                        },
                        xAxis: {
                                type:'category'
                        },
                        yAxis: {
                                min: 0,
                                title: {
                                        text: ''
                                }
                        },
                        legend: {
                                reversed: true
                        },
                        plotOptions: {
                                series: {
                                        stacking: 'normal',
                                        point:{
                                                events:{
                                                        contextmenu: function (e) {
                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                        window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                        }
                                                }
                                        }
                                }
                        },
                        series: getSeries3LevelStackBar(@Html(Json.stringify(Json.toJson(response.ticketIssue._2))),@Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._2).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._1).toSeq.distinct.sortWith(_>_))))),
                        drilldown:{
                                drillUpButton:{
                                        relativeTo: 'spacingBox',
                                        position:{
                                                align:"right",
                                                verticalAlign:"top",
                                                x:10,
                                                y:-10
                                        }
                                },
                                series: getDrillDown3LevelStack(@Html(Json.stringify(Json.toJson(response.ticketIssue._2))),@Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._1).toSeq.distinct.sortWith(_>_)))),
                                        @Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._2).toSeq.distinct.sorted))))
                        }
                });
                // Suyhao not passed
                Highcharts.chart('region-suyhao', {
                        chart: {
                                type:  @province.equals("") ? 'area' : 'bar'
                        },
                        xAxis: {
                                type:'category'
                        },

                        plotOptions: {
                                series: {
                                        stacking: 'normal'
                                }
                        },
                        title:{
                                text: ''
                        },
                        /*tooltip: {
                            shared: true
                        },*/

                        tooltip: {
                                formatter: function () {
                                        return '<b>' + this.series.name + '</b><br/><b>' + this.point.name + '</b><br/>'
                                                +'<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0)+'</b><br/>Total clients: '+Highcharts.numberFormat(Math.abs(this.point.k), 0);
                                }
                        },
                        series: getDrildownStackBarForsuyhao(@Html(Json.stringify(Json.toJson(response.suyhao))),@Html(Json.stringify(Json.toJson(response.suyhao.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.suyhao.map(x=> x._1).toSeq.distinct.sorted)))),
                        drilldown:{
                                drillUpButton:{
                                        relativeTo: 'spacingBox',
                                        position:{
                                                align:"right",
                                                verticalAlign:"top",
                                                x:10,
                                                y:-10
                                        }
                                },
                                series: getDrillDown2LevelForSuyhao(@Html(Json.stringify(Json.toJson(response.suyhao))),@Html(Json.stringify(Json.toJson(response.suyhao.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.suyhao.map(x=> x._1).toSeq.distinct.sorted))))}
                });
                // Total Contract Device by Region
                Highcharts.chart('region-contract', {
                        chart: {
                                type: 'bar'
                        },
                        title: {
                                text: ''
                        },
                        xAxis: {
                                type:'category'
                        },
                        yAxis: {
                                min: 0,
                                title: {
                                        text: ''
                                }
                        },
                        tooltip: {
                                formatter: function() {
                                        return  '<b>'+this.point.name+' - '+this.series.name+'</b><br/><b>No contract: ' + this.point.y + '</b><br/>'+this.point.z+'<br/>'+this.point.k;
                                }
                        },
                        legend: {
                                reversed: true
                        },
                        plotOptions: {
                                series: {
                                        stacking: 'normal'
                                }
                        },
                        series: getDrildownContractDevice(@Html(Json.stringify(Json.toJson(response.contracts))),@Html(Json.stringify(Json.toJson(response.contracts.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.contracts.map(x=> x._1).toSeq.distinct)))),
                        drilldown:{
                                drillUpButton:{
                                        relativeTo: 'spacingBox',
                                        position:{
                                                align:"right",
                                                verticalAlign:"top",
                                                x:10,
                                                y:-10
                                        }
                                },
                                series: getDrillDown2Level(@Html(Json.stringify(Json.toJson(response.contracts))),@Html(Json.stringify(Json.toJson(response.contracts.map(x=> x._3).toSeq.distinct.sorted))),@Html(Json.stringify(Json.toJson(response.contracts.map(x=> x._1).toSeq.distinct))),'contract')}
                });
                }
        });

        $(".controls li").click(function() {
                var active = 0
                if($(this).hasClass('active')){
                        active = 1
                }
                $(".tab-slider--body").hide()
                var activeTab = $(this).attr("name")
                $("#"+activeTab).fadeIn();
                $('.controls .nav li').removeClass('active')
                // for tab TOP N
                if($(this).attr("name") == "tabTop"){
                        $('#divTopN').show();
                        $('#monthTab1').hide()
                        $(this).addClass("active")
                        if(active == 0 && ($('#isClickedTab2').val()== 0 || $('#monthTop').val() != $('#monthCp').val()))
                                callAjaxTopN($('#month').val())
                }
                // for tab Overview
                else if($(this).attr("name") == "tabOverview"){
                        $('#monthTab1').show()
                        $('#divTopN').hide()
                        $(this).addClass("active")
                }
                // for tab Compare
                else if($(this).attr("name") == "tabCompare"){
                        $('#divTopN').show();
                        $('#monthTab1').hide()
                        $(this).addClass("active")
                        if(active == 0 && ($('#isClickedTab3').val()== 0 || $('#monthTop').val() != $('#monthCp').val()))
                                callAjaxCompare($('#month').val())
                }
                // tab Trend
                else {
                        $('#divTopN').hide();
                        $('#monthTab1').hide()
                        $(this).addClass("active")
                        if(active == 0 && $('#isClickedTab4').val()==0)
                                callAjaxTrending()
                }
        });

        function getTopNByRegion(){
                //$('#month').val("")
                if($('.tabControl .active').attr('name') == 'tabCompare')
                        callAjaxCompare("")
                else if($('.tabControl .active').attr('name') == 'tabTop')
                        callAjaxTopN("")
        }

        function getSigLogByRegionStacked(sigIn,logOff,signinClients,logoffClients,cates){
                var jsArray = []
                var colors = [
                        '#E74C3C',
                        '#0000cc',
                        '#9B59B6',
                        '#f1b53d',
                        '#73879C',
                        '#1ABB9C',
                        '#832d1d',
                        '#09006d',
                        '#cccccc',
                        '#669999',
                        '#f2ccff',
                        '#e6e600',
                        '#132639',
                        '#99cc00',
                        '#466d6d',
                        '#ffc6b3',
                        '#666633',
                        '#ffff00'];
                for(var i=0;i< sigIn.length;i++){
                        jsArray.push({
                                name: ' Signin <br/>'+sigIn[i][0],
                                color: colors[i],
                                data: addParamClients(sigIn[i][1],signinClients[i][1],cates)
                        })
                }
                for(var i=0;i< logOff.length;i++){
                        jsArray.push({
                                name: ' Logoff<br/>'+logOff[i][0],
                                color: colors[i],
                                data: addParamClients(logOff[i][1],logoffClients[i][1],cates)
                        })
                }
                return jsArray
        }

        function addParamClients(dta,clients,cates){
                var rs = []
                if(cates == 0){
                        for(var k=0;k<dta.length;k++){
                                rs.push({
                                        y: dta[k],
                                        k: clients[k]
                                })
                        }
                }
                else{
                        for(var i=0;i<cates.length;i++){
                                var isCate = 0
                                for(var k=0;k<dta.length;k++){
                                        if(dta[k][0] == cates[i]){
                                                rs.push({
                                                        y: dta[k][1],
                                                        k: clients[k][1]
                                                })
                                                isCate += 1
                                                break
                                        }
                                }
                                if(isCate ==0){
                                        rs.push({
                                                y: 0,
                                                k: 0
                                        })
                                }
                        }
                }
                return rs
        }

        function groupRegionByMonth(el,_type){
                var newDate = $('#monthGroup').val()
                if(_type == 1) newDate = $(el).text()
                $('#divallMonth a.month').removeClass('btn-success')
                $('#divallMonth a.month').addClass('btnDefault')
                $(el).removeClass('btnDefault')
                $(el).addClass('btn-success')
                $.ajax({
                        url: "/monthly/groupRegionByMonth?month=" + newDate+"&_typeNoc="+$('#typeNocCount').val()+"&_typeError="+$('#typeInfError').val(),
                        cache: false,
                        success: function (dta) {
                                if(dta != "Error"){
                                    @if(province.equals("")){
                                        // Noc Count alert By Region
                                        Highcharts.chart('region-nocCount', {

                                                legend: {
                                                        enabled: true
                                                },
                                                title: {
                                                        text: ''
                                                },
                                                yAxis: {
                                                        title: {
                                                                text: 'Counts'
                                                        }
                                                },
                                                xAxis: {
                                                        type: 'category'
                                                },
                                                colors: ['#f60'],
                                                tooltip: {
                                                        formatter: function () {
                                                                return 'Region: ' + this.point.name + '<br/>' + this.series.name + '<br/>Month: ' + newDate + '<br/>'
                                                                        + '<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b>';
                                                        }
                                                },
                                                plotOptions: {
                                                        series: {
                                                                point: {
                                                                        events: {
                                                                                contextmenu: function (e) {
                                                                                        if ($('#brasRighClick').val().indexOf('-') >= 0)
                                                                                                window.open("/fwdRequest?bras=" + $('#brasRighClick').val(), "_blank")
                                                                                },
                                                                                mouseOver: function () {
                                                                                        if (this.name.indexOf('-') >= 0)
                                                                                                $('#brasRighClick').val(this.name)
                                                                                }
                                                                        }
                                                                }
                                                        }
                                                },
                                                series: [{
                                                        name: $('#typeNocCount').val(),
                                                        data: getDrillDownStackedAndLine(dta.nocCountObj.dataSeries)
                                                }],
                                                drilldown: {
                                                        drillUpButton: {
                                                                relativeTo: 'spacingBox',
                                                                position: {
                                                                        align: "right",
                                                                        verticalAlign: "top",
                                                                        x: 10,
                                                                        y: -10
                                                                }
                                                        },
                                                        series: getDrillDownNotStacked2Level(dta.nocCountObj.data, dta.nocCountObj.categories)
                                                }
                                        });
                                        // Heatmap Opsview Types
                                        Highcharts.chart('region-opsview-heatmap', {
                                                chart: {
                                                        type: 'heatmap',
                                                        marginTop: 40,
                                                        marginBottom: 80,
                                                        plotBorderWidth: 1
                                                },

                                                title: {
                                                        text: ''
                                                },

                                                xAxis: {
                                                        categories: dta.heatmapOpsview.categories
                                                },

                                                yAxis: {
                                                        categories: ['ok_opsview','warn_opsview','unknown_opsview','crit_opsview'],
                                                        title: null
                                                },

                                                colorAxis: {
                                                        min: 0,
                                                        minColor: '#FFFFFF',
                                                        maxColor: '#1ABB9C'
                                                },

                                                legend: {
                                                        align: 'right',
                                                        layout: 'vertical',
                                                        margin: 0,
                                                        verticalAlign: 'top',
                                                        y: 25,
                                                        symbolHeight: 280
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return this.series.xAxis.categories[this.point.x] +' & '+ this.series.yAxis.categories[this.point.y] + ' & month '+newDate+' has <br><b>' +
                                                                        this.point.value + '</b> ';
                                                        }
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownNoticeByStatus(event.point.series.xAxis.categories[event.point.x])
                                                                        }
                                                                },
                                                                dataLabels:{
                                                                        formatter:function(){
                                                                                var nf = new Intl.NumberFormat();
                                                                                return nf.format(this.point.value);
                                                                        }
                                                                },
                                                                cursor: 'pointer'
                                                        }
                                                },

                                                series: [{
                                                        name: 'Opsview types',
                                                        borderWidth: 1,
                                                        data: getDataHeatMap(dta.heatmapOpsview.data),
                                                        dataLabels: {
                                                                enabled: true,
                                                                color: '#000000'
                                                        }
                                                }]

                                        });
                                    }
                                        // Inf down error by Region
                                        Highcharts.chart('region-infError', {
                                                chart: {
                                                        type:  @province.equals("") ? 'areaspline' : 'bar'
                                                },
                                                title: {
                                                        text: ''
                                                },
                                                xAxis: {
                                                        type: 'category'
                                                },
                                                legend: {
                                                        enabled: true
                                                },
                                                yAxis: {
                                                        title: {
                                                                text: ''
                                                        }
                                                },
                                                tooltip: {
                                                        formatter: function () {
                                                                return 'Region: ' + this.point.name + '<br/>' + this.series.name + '<br/>Month: ' + newDate + '<br/>'
                                                                        + '<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b>';
                                                        }
                                                },
                                                plotOptions: {
                                                        series: {
                                                                point: {
                                                                        events: {
                                                                                contextmenu: function (e) {
                                                                                        if ($('#brasRighClick').val().indexOf('-') >= 0)
                                                                                                window.open("/fwdRequest?bras=" + $('#brasRighClick').val(), "_blank")
                                                                                },
                                                                                mouseOver: function () {
                                                                                        if (this.name.indexOf('-') >= 0)
                                                                                                $('#brasRighClick').val(this.name)
                                                                                }
                                                                        }
                                                                }
                                                        }
                                                },
                                                colors: ['#5A738E'],
                                                series: [{
                                                        name: $('#typeInfError').val(),
                                                        data: getDrillDownStackedAndLine(dta.infTypeObj.dataSeries)
                                                }],
                                                drilldown: {
                                                        drillUpButton: {
                                                                relativeTo: 'spacingBox',
                                                                position: {
                                                                        align: "right",
                                                                        verticalAlign: "top",
                                                                        x: 10,
                                                                        y: -10
                                                                }
                                                        },
                                                        series: getDrillDownNotStacked2Level(dta.infTypeObj.data, dta.infTypeObj.categories)
                                                }
                                        });
                                }
                        },
                });
        }

        function getDataHeatMap(data){
                var jsonArr = [];
                for (var i =0 ; i < data.length; i++) {
                        var arrOpsview = data[i][1].split('_')
                        for(var j=0;j<arrOpsview.length;j++)
                                jsonArr.push([i,j,Number(arrOpsview[j])]);
                }
                return jsonArr
        }

        function backInfTotal() {
                var id = ""
                if($('#backInfTotal').text() == "Back to bras"){
                        $('#backInfTotal').show()
                        $('#backInfTotal').text('Back to province')
                        id = "Province:"+$('#isProvince').val()
                }
                else if($('#backInfTotal').text() == "Back to province"){
                        $('#backInfTotal').show()
                        $('#backInfTotal').text('Back to region')
                        id = "Region:"+$('#isRegion').val()
                }
                else {
                        $('#backInfTotal').hide()
                        id = "*"
                }
                $.ajax({
                        url: "/monthly/drillUpTotalInf?id="+id+"&month="+$('#monthGroup').val(),
                        cache: false,
                        success: function (dta) {
                                if (dta != "Error") {
                                        Highcharts.chart('region-inf', {
                                                chart: {
                                                        type: 'heatmap',
                                                        marginTop: 40,
                                                        marginBottom: 70,
                                                        plotBorderWidth: 1
                                                },

                                                title: {
                                                        text: ''
                                                },

                                                xAxis: {
                                                        categories: dta.categories
                                                },

                                                yAxis: {
                                                        categories:  dta.month,
                                                        title: null
                                                },

                                                colorAxis: {
                                                        min: 0,
                                                        minColor: '#FFFFFF',
                                                        maxColor: '#E74C3C'
                                                },

                                                legend: {
                                                        align: 'right',
                                                        layout: 'vertical',
                                                        margin: 0,
                                                        verticalAlign: 'top',
                                                        y: 25,
                                                        symbolHeight: 280
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownTotalInf(event.point.series.xAxis.categories[event.point.x])
                                                                        }
                                                                },
                                                                dataLabels:{
                                                                        formatter:function(){
                                                                                var nf = new Intl.NumberFormat();
                                                                                return nf.format(this.point.value);
                                                                        }
                                                                },
                                                                cursor: 'pointer'
                                                        }
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return '<b>' + this.series.xAxis.categories[this.point.x] +' & '+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                                        this.point.value + '</b> ';
                                                        }
                                                },

                                                series: [{
                                                        name: 'total inf',
                                                        borderWidth: 1,
                                                        data: getDataHeatMapForDrilldownInferror(dta.data,dta.categories,dta.month),
                                                        dataLabels: {
                                                                enabled: true,
                                                                color: '#000000'
                                                        }
                                                }]

                                        });
                                        // right click yAxis
                                        $('#region-inf .highcharts-xaxis-labels text').mousedown(function(e) {
                                                if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                                        window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                                }
                                                return false;
                                        });
                                }
                        }
                })
        }

        function backNoticeStatus() {
                var id = ""
                if($('#backNoticeStt').text() == "Back to province"){
                        $('#backNoticeStt').show()
                        $('#backNoticeStt').text('Back to region')
                        id = "Region:"+$('#isRegionStt').val()
                }
                else {
                        $('#backNoticeStt').hide()
                        id = "*"
                }
                $.ajax({
                        url: "/monthly/dUpNoticeByStatus?id="+id+"&month="+$('#monthGroup').val(),
                        cache: false,
                        success: function (dta) {
                                if (dta != "Error") {
                                        // Heatmap Opsview Types
                                        Highcharts.chart('region-opsview-heatmap', {
                                                chart: {
                                                        type: 'heatmap',
                                                        marginTop: 40,
                                                        marginBottom: 80,
                                                        plotBorderWidth: 1
                                                },

                                                title: {
                                                        text: ''
                                                },

                                                xAxis: {
                                                        categories: dta.categories
                                                },

                                                yAxis: {
                                                        categories: ['ok_opsview','warn_opsview','unknown_opsview','crit_opsview'],
                                                        title: null
                                                },

                                                colorAxis: {
                                                        min: 0,
                                                        minColor: '#FFFFFF',
                                                        maxColor: '#1ABB9C'
                                                },

                                                legend: {
                                                        align: 'right',
                                                        layout: 'vertical',
                                                        margin: 0,
                                                        verticalAlign: 'top',
                                                        y: 25,
                                                        symbolHeight: 280
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return '<b>' + this.series.xAxis.categories[this.point.x] +' & '+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                                        this.point.value + '</b> ';
                                                        }
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownNoticeByStatus(event.point.series.xAxis.categories[event.point.x])
                                                                        }
                                                                },
                                                                dataLabels:{
                                                                        formatter:function(){
                                                                                var nf = new Intl.NumberFormat();
                                                                                return nf.format(this.point.value);
                                                                        }
                                                                },
                                                                cursor: 'pointer'
                                                        }
                                                },

                                                series: [{
                                                        name: 'Opsview types',
                                                        borderWidth: 1,
                                                        data: getDataHeatMap(dta.data),
                                                        dataLabels: {
                                                                enabled: true,
                                                                color: '#000000'
                                                        }
                                                }]

                                        });
                                }
                        }
                })
        }

        function callDrilldownNoticeByStatus(id){
                $.ajax({
                        url: "/monthly/ddownNoticeByStatus?id=" + id+"&month="+$('#monthGroup').val(),
                        cache: false,
                        success: function (dta) {
                                if(dta != "Error"){
                                        // Apply for button back
                                        $('#regionNoticeStt').val(id)
                                        if(!isNaN(id.substring(id.indexOf(" ")+1))){
                                                $('#backNoticeStt').text("Back to region")
                                                $('#isRegionStt').val(id)
                                        }
                                        else if(isNaN(id.substring(id.indexOf(" ")+1)) && id.indexOf("-")<0){
                                                $('#backNoticeStt').text("Back to province")
                                                $('#isProvinceStt').val(id)
                                        }
                                        $('#backNoticeStt').show()
                                        // Heatmap Opsview Types
                                        Highcharts.chart('region-opsview-heatmap', {
                                                chart: {
                                                        type: 'heatmap',
                                                        marginTop: 40,
                                                        marginBottom: 80,
                                                        plotBorderWidth: 1
                                                },

                                                title: {
                                                        text: ''
                                                },

                                                xAxis: {
                                                        categories: dta.categories
                                                },

                                                yAxis: {
                                                        categories: ['ok_opsview','warn_opsview','unknown_opsview','crit_opsview'],
                                                        title: null
                                                },

                                                colorAxis: {
                                                        min: 0,
                                                        minColor: '#FFFFFF',
                                                        maxColor: '#1ABB9C'
                                                },

                                                legend: {
                                                        align: 'right',
                                                        layout: 'vertical',
                                                        margin: 0,
                                                        verticalAlign: 'top',
                                                        y: 25,
                                                        symbolHeight: 280
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return '<b>' + this.series.xAxis.categories[this.point.x] +' & '+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                                        this.point.value + '</b> ';
                                                        }
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownNoticeByStatus(event.point.series.xAxis.categories[event.point.x])
                                                                        }
                                                                },
                                                                dataLabels:{
                                                                        formatter:function(){
                                                                                var nf = new Intl.NumberFormat();
                                                                                return nf.format(this.point.value);
                                                                        }
                                                                },
                                                                cursor: 'pointer'
                                                        }
                                                },

                                                series: [{
                                                        name: 'Opsview types',
                                                        borderWidth: 1,
                                                        data: getDataHeatMap(dta.data),
                                                        dataLabels: {
                                                                enabled: true,
                                                                color: '#000000'
                                                        }
                                                }]

                                        });
                                        // right click yAxis
                                        $('#region-opsview-heatmap .highcharts-xaxis-labels text').mousedown(function(e) {
                                                if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                                        window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                                }
                                                return false;
                                        });
                                }
                        }
                })
        }

        function callDrilldownTotalInf(id){
                $.ajax({
                        url: "/monthly/drilldownTotalInf?id=" + id+"&month="+$('#monthGroup').val(),
                        cache: false,
                        success: function (dta) {
                                if(dta != "Error"){
                                        // Apply for button back
                                        $('#regionInf').val(id)
                                        if(!isNaN(id.substring(id.indexOf(" ")+1))){
                                                $('#backInfTotal').text("Back to region")
                                                $('#isRegion').val(id)
                                        }
                                        else if(isNaN(id.substring(id.indexOf(" ")+1)) && id.indexOf("-")<0){
                                                $('#backInfTotal').text("Back to province")
                                                $('#isProvince').val(id)
                                        }
                                        else if(isNaN(id.substring(id.indexOf(" ")+1)) && id.indexOf("-")>=0){
                                                $('#backInfTotal').text("Back to bras")
                                        }
                                        $('#backInfTotal').show()

                                        Highcharts.chart('region-inf', {
                                                chart: {
                                                        type: 'heatmap',
                                                        marginTop: 40,
                                                        marginBottom: 70,
                                                        plotBorderWidth: 1
                                                },

                                                title: {
                                                        text: ''
                                                },

                                                xAxis: {
                                                        categories: dta.categories
                                                },

                                                yAxis: {
                                                        categories:  dta.month,
                                                        title: null
                                                },

                                                colorAxis: {
                                                        min: 0,
                                                        minColor: '#FFFFFF',
                                                        maxColor: '#E74C3C'
                                                },

                                                legend: {
                                                        align: 'right',
                                                        layout: 'vertical',
                                                        margin: 0,
                                                        verticalAlign: 'top',
                                                        y: 25,
                                                        symbolHeight: 280
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownTotalInf(event.point.series.xAxis.categories[event.point.x])
                                                                        }
                                                                },
                                                                dataLabels:{
                                                                        formatter:function(){
                                                                                var nf = new Intl.NumberFormat();
                                                                                return nf.format(this.point.value);
                                                                        }
                                                                },
                                                                cursor: 'pointer'
                                                        }
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return '<b>' + this.series.xAxis.categories[this.point.x] +' & '+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                                        this.point.value + '</b> ';
                                                        }
                                                },

                                                series: [{
                                                        name: 'total inf',
                                                        borderWidth: 1,
                                                        data: getDataHeatMapForDrilldownInferror(dta.data,dta.categories,dta.month),
                                                        dataLabels: {
                                                                enabled: true,
                                                                color: '#000000'
                                                        }
                                                }]

                                        });
                                        // right click yAxis
                                        $('#region-inf .highcharts-xaxis-labels text').mousedown(function(e) {
                                                if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                                        window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                                }
                                                return false;
                                        });
                                }
                        }
                })
        }

        function backSigLogmonth() {
                var id = ""
                if($('#backSigLog').text() == "Back to bras"){
                        $('#backSigLog').show()
                        $('#backSigLog').text('Back to province')
                        id = "Province:"+$('#isProvinceSigLog').val()
                }
                else if($('#backSigLog').text() == "Back to province"){
                        $('#backSigLog').show()
                        $('#backSigLog').text('Back to region')
                        id = "Region:"+$('#isRegionSigLog').val()
                }
                else {
                        $('#backSigLog').hide()
                        id = "*"
                }
                $.ajax({
                        url: "/monthly/dUpSigLogmonth?id="+id+"&month="+$('#monthGroup').val(),
                        cache: false,
                        success: function (dta) {
                                if (dta != "Error") {
                                        Highcharts.chart('region-siglog-bar', {
                                                chart: {
                                                        type: 'bar'
                                                },
                                                title: {
                                                        text: ''
                                                },
                                                subtitle: {
                                                        text: ''
                                                },
                                                xAxis: [{
                                                        categories: dta.categories[0],
                                                        reversed: false,
                                                }, { // mirror axis on right side
                                                        opposite: true,
                                                        reversed: false,
                                                        categories: dta.categories[0],
                                                        linkedTo: 0,
                                                }],
                                                yAxis: {
                                                        title: {
                                                                text: null
                                                        },
                                                        labels: {
                                                                formatter: function () {
                                                                        return Math.abs(this.value);
                                                                }
                                                        },
                                                },

                                                plotOptions: {
                                                        series: {
                                                                events: {
                                                                        click: function (event) {
                                                                                callDrilldownSigLog(event.point.category)
                                                                        }
                                                                },
                                                                cursor: 'pointer',
                                                                stacking: 'normal'
                                                        }
                                                },

                                                tooltip: {
                                                        formatter: function () {
                                                                return '<b>' + this.series.name + '</b><br/><b>' + this.point.category + '</b><br/>'
                                                                        +'<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0)+'</b><br/>Total clients: ' + Highcharts.numberFormat(Math.abs(this.point.k), 0);
                                                        }
                                                },

                                                series: getSigLogByRegionStacked(dta.signin,dta.logoff,dta.signin_clients,dta.logoff_clients,dta.categories[0])

                                        });
                                        // right click yAxis
                                        $('#region-siglog-bar .highcharts-xaxis-labels text').mousedown(function(e) {
                                                if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                                        window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                                }
                                                return false;
                                        });
                                }
                        }
                })
        }

        function callDrilldownSigLog(id){
                if(isNaN(id.substring(id.indexOf(" ") + 1)) && id.indexOf("-") < 0 && id.length>=10 && id.indexOf(" ")<0) {
                        console.log('do not drilldown host')
                }
                else {
                        $.ajax({
                                url: "/monthly/ddownSigLogMonth?id=" + id + "&month=" + $('#monthGroup').val(),
                                cache: false,
                                success: function (dta) {
                                        if (dta != "Error") {
                                                // Apply for button back
                                                $('#regionSigLog').val(id)
                                                if (!isNaN(id.substring(id.indexOf(" ") + 1))) {
                                                        $('#backSigLog').text("Back to region")
                                                        $('#isRegionSigLog').val(id)
                                                }
                                                else if (isNaN(id.substring(id.indexOf(" ") + 1)) && id.indexOf("-") < 0) {
                                                        $('#backSigLog').text("Back to province")
                                                        $('#isProvinceSigLog').val(id)
                                                }
                                                else if (isNaN(id.substring(id.indexOf(" ") + 1)) && id.indexOf("-") >= 0) {
                                                        $('#backSigLog').text("Back to bras")
                                                }
                                                $('#backSigLog').show()
                                                Highcharts.chart('region-siglog-bar', {
                                                        chart: {
                                                                type: 'bar'
                                                        },
                                                        title: {
                                                                text: ''
                                                        },
                                                        subtitle: {
                                                                text: ''
                                                        },
                                                        xAxis: [{
                                                                categories: dta.categories[0],
                                                                reversed: false,
                                                        }, { // mirror axis on right side
                                                                opposite: true,
                                                                reversed: false,
                                                                categories: dta.categories[0],
                                                                linkedTo: 0,
                                                        }],
                                                        yAxis: {
                                                                title: {
                                                                        text: null
                                                                },
                                                                labels: {
                                                                        formatter: function () {
                                                                                return Math.abs(this.value);
                                                                        }
                                                                },
                                                        },

                                                        plotOptions: {
                                                                series: {
                                                                        events: {
                                                                                click: function (event) {
                                                                                        callDrilldownSigLog(event.point.category)
                                                                                }
                                                                        },
                                                                        cursor: 'pointer',
                                                                        stacking: 'normal'
                                                                }
                                                        },

                                                        tooltip: {
                                                                formatter: function () {
                                                                        return '<b>' + this.series.name + '</b><br/><b>' + this.point.category + '</b><br/>'
                                                                                + '<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b><br/>Total clients: ' + Highcharts.numberFormat(Math.abs(this.point.k), 0);
                                                                }
                                                        },

                                                        series: getSigLogByRegionStacked(dta.signin, dta.logoff, dta.signin_clients, dta.logoff_clients, dta.categories[0])

                                                });
                                                // right click yAxis
                                                $('#region-siglog-bar .highcharts-xaxis-labels text').mousedown(function (e) {
                                                        if (e.which == 3 && e.target.innerHTML.indexOf('-') >= 0) {
                                                                window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                                        }
                                                        return false;
                                                });
                                        }
                                }
                        })
                }
        }

        function getDataHeatMapForDrilldownInferror(dta,arrRegion,arrMonth){
                var jsonArr = [];
                for (var key =0 ; key < arrRegion.length; key++) {
                        for(var month=0;month<arrMonth.length;month++)
                                for(var i=0;i<dta.length;i++)
                                        if(dta[i][0] == arrMonth[month] && dta[i][1] == arrRegion[key])
                                                jsonArr.push([key,month,Number(dta[i][2])])
                }
                return jsonArr
        }

        function getDrillDownNotStacked2Level(dta,arrRegion){
                var jsArray = []
                for(var region=0;region<arrRegion.length;region++){
                        // get array provinces and bras by month&region
                        var arrProvinceBras = [], dtaRegion = []
                        for(var i=0;i< dta.length;i++){
                                if (arrRegion[region] == dta[i][0]){
                                        arrProvinceBras.push({
                                                province:dta[i][1],
                                                bras: dta[i][2],
                                                value:dta[i][3]
                                        })
                                }
                        }
                        // set array data by province
                        var nameOld = arrProvinceBras[0].province, sumOld= Number(arrProvinceBras[0].value), isMoreProv =0,dtaProvince = []
                        for(var k=1;k<arrProvinceBras.length;k++){
                                if(k== (arrProvinceBras.length-1) || nameOld != arrProvinceBras[k].province){
                                        if(k== (arrProvinceBras.length-1)) sumOld += arrProvinceBras[k].value
                                        dtaRegion.push({
                                                name: nameOld,
                                                y: sumOld,
                                                drilldown:nameOld
                                        })
                                        // set series province& bras
                                        jsArray.push({
                                                id: nameOld,
                                                name: nameOld,
                                                data: dtaProvince
                                        })
                                        dtaProvince = []
                                        nameOld = arrProvinceBras[k].province
                                        sumOld = arrProvinceBras[k].value
                                        isMoreProv =1
                                }
                                else{
                                        sumOld += Number(arrProvinceBras[k].value)
                                }
                                dtaProvince.push([arrProvinceBras[k].bras,Number(arrProvinceBras[k].value)])
                        }
                        if(isMoreProv ==0){
                                dtaRegion.push({
                                        name: nameOld,
                                        y: Number(sumOld),
                                        drilldown:nameOld
                                })
                                // set series province& bras
                                jsArray.push({
                                        id: nameOld,
                                        name: nameOld,
                                        data: dtaProvince
                                })
                        }

                        // set series regions& province
                        jsArray.push({
                                id: arrRegion[region],
                                name: arrRegion[region],
                                data: dtaRegion
                        })
                }
                return jsArray
        }

        function getDrillDownStackedAndLine(dta){
                var rs = []
                for(var i=0;i<dta.length;i++){
                        rs.push({
                                name:dta[i][0],
                                y:dta[i][1],
                                drilldown:dta[i][0]
                        })
                }
                return rs
        }

        function getDrillDown2LevelForSuyhao(dta,arrRegion,arrMonth){
                var jsArray = []
                for(var region=0;region< arrRegion.length;region++ ){
                        for(var month=0;month< arrMonth.length;month++){
                                // get array provinces and bras by month&region
                                var arrProvinceBras = [], dtaRegion = []
                                for(var i=0;i< dta.length;i++){
                                        if (arrMonth[month] == dta[i][0] && arrRegion[region] == dta[i][2]){
                                                arrProvinceBras.push({
                                                        province:dta[i][1],
                                                        bras: dta[i][4],
                                                        value:dta[i][3],
                                                        clients: dta[i][5]
                                                })
                                        }
                                }
                                // set array data by province
                                var nameOld = arrProvinceBras[0].province, sumOld= 0,sumClientsSuyhao=0,
                                        isMoreProv =0,dtaProvince = []
                                for(var k=0;k<arrProvinceBras.length;k++){
                                        if(k==(arrProvinceBras.length -1) || nameOld != arrProvinceBras[k].province){
                                                if(k==(arrProvinceBras.length -1)) sumOld += arrProvinceBras[k].value
                                                dtaRegion.push({
                                                        name: nameOld,
                                                        y: sumOld,
                                                        k: sumClientsSuyhao,
                                                        drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                                })
                                                // set series province& bras
                                                //console.log(sortObjectsArray(dtaProvince,'y').slice(0,10))
                                                //var top10Prov = sortObjectsArray(dtaProvince,'name').slice(0,10)
                                                var top10Prov  = getTop10HostbyProvince(dtaProvince,dta,nameOld,arrMonth.length)
                                                jsArray.push({
                                                        id: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                        name: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                        data: top10Prov
                                                })
                                                dtaProvince = []
                                                nameOld = arrProvinceBras[k].province
                                                sumOld = arrProvinceBras[k].value
                                                sumClientsSuyhao = arrProvinceBras[k].clients
                                                isMoreProv =1
                                        }
                                        else{
                                                sumOld += Number(arrProvinceBras[k].value)
                                                sumClientsSuyhao += Number(arrProvinceBras[k].clients)
                                        }
                                        dtaProvince.push({
                                                name: arrProvinceBras[k].bras,
                                                y:Number(arrProvinceBras[k].value),
                                                k:Number(arrProvinceBras[k].clients)
                                        })
                                }
                                if(isMoreProv ==0){
                                        dtaRegion.push({
                                                name: nameOld,
                                                y: Number(sumOld),
                                                k: Number(sumClientsSuyhao),
                                                drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                        })
                                        // set series province& bras
                                        jsArray.push({
                                                id: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                name: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                data: sortObjectsArray(dtaProvince,'name').slice(0,9)
                                        })
                                }

                                // set series regions& province
                                jsArray.push({
                                        id: arrRegion[region]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                        name: arrRegion[region]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                        data: dtaRegion
                                })
                        }

                }
                return jsArray
        }

        function getDrillDown2Level(dta,arrRegion,arrMonth,_type){
                var jsArray = []
                for(var region=0;region< arrRegion.length;region++ ){
                        for(var month=0;month< arrMonth.length;month++){
                                // get array provinces and bras by month&region
                                var arrProvinceBras = [], dtaRegion = []
                                for(var i=0;i< dta.length;i++){
                                        if (arrMonth[month] == dta[i][0] && arrRegion[region] == dta[i][2]){
                                                if(_type=='normal'){
                                                        arrProvinceBras.push({
                                                                province:dta[i][1],
                                                                bras: dta[i][4],
                                                                value:dta[i][3]
                                                        })
                                                }
                                                else{
                                                        arrProvinceBras.push({
                                                                province:dta[i][1],
                                                                bras: dta[i][3],
                                                                value:dta[i][4],
                                                                noDevice:dta[i][5],
                                                                poorconn:dta[i][6],
                                                        })
                                                }
                                        }
                                }
                                // set array data by province
                                var nameOld = arrProvinceBras[0].province, sumOld= 0,
                                        isMoreProv =0,dtaProvince = [],sumPoorconn =0,
                                        sumNodevice =0
                                for(var k=0;k<arrProvinceBras.length;k++){
                                        if(k==(arrProvinceBras.length -1) || nameOld != arrProvinceBras[k].province){
                                                if(k==(arrProvinceBras.length -1)) sumOld += arrProvinceBras[k].value
                                                if(_type == 'normal')
                                                        dtaRegion.push({
                                                                name: nameOld,
                                                                y: sumOld,
                                                                drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                                        })
                                                else
                                                        dtaRegion.push({
                                                                name: nameOld,
                                                                y: sumOld,
                                                                z: 'No device: '+sumNodevice,
                                                                k: 'Poor conn: '+sumPoorconn,
                                                                drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                                        })
                                                // set series province& bras
                                                //console.log(sortObjectsArray(dtaProvince,'y').slice(0,10))
                                                var top10Prov = sortObjectsArray(dtaProvince,'name').slice(0,9)
                                                jsArray.push({
                                                        id: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                        name: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                        data: top10Prov
                                                })
                                                dtaProvince = []
                                                nameOld = arrProvinceBras[k].province
                                                sumOld = arrProvinceBras[k].value
                                                sumNodevice = 0
                                                sumPoorconn = 0
                                                isMoreProv =1
                                        }
                                        else{
                                                sumOld += Number(arrProvinceBras[k].value)
                                                sumNodevice += Number(arrProvinceBras[k].noDevice)
                                                sumPoorconn += Number(arrProvinceBras[k].poorconn)
                                        }
                                        dtaProvince.push({
                                                name: arrProvinceBras[k].bras,
                                                y:Number(arrProvinceBras[k].value),
                                                z:'No device: '+Number(arrProvinceBras[k].noDevice),
                                                k:'Poor conn: '+Number(arrProvinceBras[k].poorconn)
                                        })
                                }
                                if(isMoreProv ==0){
                                        if(_type == 'normal')
                                                dtaRegion.push({
                                                        name: nameOld,
                                                        y: Number(sumOld),
                                                        drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                                })
                                        else
                                                dtaRegion.push({
                                                        name: nameOld,
                                                        y: Number(sumOld),
                                                        z: 'No device: '+sumNodevice,
                                                        k: 'Poor conn: '+sumPoorconn,
                                                        drilldown:nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                                })
                                        // set series province& bras
                                        jsArray.push({
                                                id: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                name: nameOld+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                                data: sortObjectsArray(dtaProvince,'name').slice(0,9)
                                        })
                                }

                                // set series regions& province
                                jsArray.push({
                                        id: arrRegion[region]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                        name: arrRegion[region]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                        data: dtaRegion
                                })
                        }

                }
                return jsArray
        }

        function getTop10HostbyProvince(arrProvince,dta,province,sizeMonth){
                var rs =[], rsProvince = [], host = []
                for(var i=0;i<dta.length;i++){
                        if(province == dta[i][1]) host.push(dta[i][4])
                }
                var arrCounts = countTimesArr(host)
                for(var i=0;i< arrCounts.length;i++){
                        if(sizeMonth == arrCounts[i][1])
                                rsProvince.push(arrCounts[i][0])
                }
                //console.log(rsProvince.slice(0,10))
                for(var k=0;k<rsProvince.slice(rsProvince.length-10,rsProvince.length).length;k++){
                        for(var j=0;j< arrProvince.length;j++){
                                if(rsProvince.slice(0,10)[k] == arrProvince[j].name)
                                        rs.push({
                                                name: arrProvince[j].name,
                                                y:Number(arrProvince[j].y),
                                                k:Number(arrProvince[j].k)
                                        })
                        }
                }
                return rs
        }

        function countTimesArr(arr) {
                var a = [], b = [], prev,rs = [];
                arr.sort();
                for ( var i = 0; i < arr.length; i++ ) {
                        if ( arr[i] !== prev ) {
                                a.push(arr[i]);
                                b.push(1);
                        } else {
                                b[b.length-1]++;
                        }
                        prev = arr[i];
                }
                // set results
                for(var i=0;i<a.length;i++){
                        rs.push([a[i],b[i]])
                }

                return rs;
        }

        // order by array objects
        function sortObjectsArray(objectsArray, sortKey) {
                // Quick Sort:
                var retVal;

                if (1 < objectsArray.length)
                {
                        var pivotIndex = Math.floor((objectsArray.length - 1) / 2);  // middle index
                        var pivotItem = objectsArray[pivotIndex];                    // value in the middle index
                        var less = [], more = [];

                        objectsArray.splice(pivotIndex, 1);                          // remove the item in the pivot position
                        objectsArray.forEach(function(value, index, array)
                        {
                                value[sortKey] >= pivotItem[sortKey] ?                   // compare the 'sortKey' proiperty
                                        less.push(value) :
                                        more.push(value) ;
                        });

                        retVal = sortObjectsArray(less, sortKey).concat([pivotItem], sortObjectsArray(more, sortKey));
                }
                else
                {
                        retVal = objectsArray;
                }

                return retVal;
        }

        function getJsonDrillParenthaveClients(dta,dataClients){
                var rs = []
                for(var i=0;i<dta.length;i++){
                        rs.push({
                                name: dta[i][0],
                                y: dta[i][1],
                                k: (dataClients.length == 0)? 0: dataClients[i][1],
                                drilldown: dta[i][0]
                        })
                }
                return rs
        }

        function getJsonDrillParent(dta){
                var rs = []
                for(var i=0;i<dta.length;i++){
                        rs.push({
                                name: dta[i][0],
                                y: dta[i][1],
                                drilldown: dta[i][0]
                        })
                }
                return rs
        }

        function getJsonDrillChildren(dta,arrKey){
                var rs = []
                for(var i=0;i<arrKey.length;i++){
                        var arrDta = []
                        for(var j=0;j<dta.length;j++){
                                if(arrKey[i] == dta[j][0]){
                                        arrDta.push({
                                                name: dta[j][1],
                                                y: dta[j][2],
                                                k :dta[j][3]
                                        })
                                }
                        }
                        rs.push({
                                id: arrKey[i],
                                name:'Bras of province: '+arrKey[i],
                                data: arrDta
                        })
                }
                return rs
        }

        function getDrildownStackBarForsuyhao(dta,arrKey,arrMonth){
                var jsArray = []
                var colors = ['#9B59B6', '#3498DB', '#d9534f', '#f1b53d', '#E74C3C', '#73879C', '#1ABB9C', '#832d1d', '#0000cc', '#09006d', '#cccccc', '#669999', '#f2ccff', '#e6e600', '#132639', '#99cc00', '#466d6d', '#ffc6b3', '#666633', '#ffff00'];
                for(var month=0;month< arrMonth.length;month++ ){
                        var arrData = []
                        for(var key=0;key<arrKey.length;key++ ) {
                                var sumVl =0
                                var sumClients = 0
                                for (var i = 0; i < dta.length; i++) {
                                        if (arrMonth[month] == dta[i][0] && arrKey[key] == dta[i][2]){
                                                sumVl += dta[i][3]
                                                sumClients += dta[i][5]
                                        }
                                }
                                arrData.push({
                                        name: arrKey[key],
                                        y: sumVl,
                                        k: sumClients,
                                        drilldown: arrKey[key]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                })
                        }
                        var color = colors[month]
                        jsArray.push({
                                name: arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                data: arrData,
                                color: color
                        })
                }
                return jsArray
        }

        function getDrildownStackBar(dta,arrKey,arrMonth,_type){
                var jsArray = []
                var colors0 = [
                        '#d9534f',
                        '#73879C',
                        '#1ABB9C',
                        '#f1b53d',
                        '#E74C3C',
                        '#73879C',
                        '#832d1d',
                        '#0000cc',
                        '#09006d',
                        '#cccccc',
                        '#669999',
                        '#f2ccff',
                        '#e6e600',
                        '#132639',
                        '#99cc00',
                        '#466d6d',
                        '#ffc6b3',
                        '#666633',
                        '#ffff00'];
                var colors1 = [
                        '#d9534f',
                        '#f1b53d',
                        '#73879C',
                        '#ffff00',
                        '#1ABB9C',
                        '#E74C3C',
                        '#832d1d',
                        '#e6e600',
                        '#09006d',
                        '#cccccc',
                        '#669999',
                        '#f2ccff',
                        '#0000cc',
                        '#132639',
                        '#99cc00',
                        '#466d6d',
                        '#ffc6b3',
                        '#666633',
                        '#ffff00'];
                for(var month=0;month< arrMonth.length;month++ ){
                        var arrData = []
                        for(var key=0;key<arrKey.length;key++ ) {
                                var sumVl =0
                                for (var i = 0; i < dta.length; i++) {
                                        if (arrMonth[month] == dta[i][0] && arrKey[key] == dta[i][2]){
                                                sumVl += dta[i][3]
                                        }
                                }
                                arrData.push({
                                        name: arrKey[key],
                                        y: sumVl,
                                        drilldown: arrKey[key]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                })
                        }
                        var color = colors0[month]
                        if(_type == 1) color = colors1[month]
                        jsArray.push({
                                name: arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                data: arrData,
                                color: color
                        })
                }
                return jsArray
        }

        function getDrildownContractDevice(dta,arrKey,arrMonth){
                var jsArray = []
                var colors = ['#3276b1','#f2473c','#ff9600']
                for(var month=0;month< arrMonth.length;month++ ){
                        var arrData = []
                        for(var key=0;key<arrKey.length;key++ ) {
                                var sumVl =0, sumNodevice =0 , sumPoorconn = 0
                                for (var i = 0; i < dta.length; i++) {
                                        if (arrMonth[month] == dta[i][0] && arrKey[key] == dta[i][2]){
                                                sumVl += dta[i][4]
                                                sumNodevice += dta[i][5]
                                                sumPoorconn += dta[i][6]
                                        }
                                }
                                arrData.push({
                                        name: arrKey[key],
                                        y: sumVl,
                                        z: 'No device: '+sumNodevice,
                                        k: 'Poor conn: '+sumPoorconn,
                                        drilldown: arrKey[key]+'-'+arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-"))
                                })
                        }
                        var color = colors[month]
                        jsArray.push({
                                name: arrMonth[month].substring(0,arrMonth[month].lastIndexOf("-")),
                                data: arrData,
                                color: color
                        })
                }
                return jsArray
        }

</script>