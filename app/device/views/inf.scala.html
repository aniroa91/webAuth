@(email: String, response: model.device.InfResponse,ids: String)
@import play.api.libs.json.Json
@import services.domain.CommonService.formatPattern
@import play.api.libs.json.Json

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <!-- Meta, title, CSS, favicons, etc. -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Dashboard Admin </title>

            <!-- Bootstrap -->
        @common.views.html.common.css("Inf")
    </head>
    @common.views.html.common.top()
        <!-- top navigation -->
    <div class="top_nav">
        <div class="nav_menu">
            <nav>
                <div class="nav toggle" style="margin-bottom: 10px">
                    <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                </div>
                <div style="margin-top: 10px" class="col-md-3 col-sm-3 col-xs-12 form-group  top_search">


                    <div class="input-group">
                        <input type="text" class="form-control autocomplete" id="search" placeholder="Search host ..." style="border-radius:0">
                        <div class="input-group-addon groupSearch" ><i class="fa fa-search"></i></div>
                    </div>
                </div>
            </nav>
            <ul class="nav navbar-nav navbar-right">
                <li class="">
                    <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <img src="../assets/images/user.default.png" alt="">@email
                        <span class=" fa fa-angle-down"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-usermenu pull-right">
                        <li><a href="/logout"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                    </ul>
                </li>
            </ul>

        </div>
    </div>
        <!-- /top navigation -->
        <!-- page content -->
    <div class="right_col" role="main">
        @if(response != null){
            <div class="row top_tiles">
                <div class="col-xs-12">
                    <div class="container">
                        <div class="panel with-nav-tabs panel-primary">
                            <div class="panel-heading">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a class="tabEvent" style="cursor: pointer">Anomaly Event</a></li>
                                    <li><a class="tabBroken" style="cursor: pointer">Broken Cable</a></li>
                                    <li><a class="tabHost" style="cursor: pointer">Host Monitor</a></li>
                                </ul>
                            </div>
                            <div class="panel-body">
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="tabEvent">
                                        <div class="row top_tiles">
                                            <div class="col-xs-12">
                                                <div class="x_panel tile " style="padding: 0px;">
                                                    <div class="x_content" id="divSf">
                                                        <input type="hidden" id="ids" value="@ids">
                                                        <input type="text" id="hiddenField" style="display: none"/>
                                                        <table class="data table table-bordered tbScroll" id="tbSf" style="width: 100%">
                                                            <thead >
                                                                <tr>
                                                                    <th>Date time <i class="fa fa-info-circle toolTipText" title="Danh sách module bị bất thường bởi lỗi thiết bị Access"></i></th>
                                                                    <th>Host</th>
                                                                    <th>Module</th>
                                                                    <th>User Down</th>
                                                                    <th>Inf Down</th>
                                                                    <th>Sf Error</th>
                                                                    <th>Lofi Error</th>
                                                                    <th>Rouge Error</th>
                                                                    <th>Lost Signal</th>
                                                                    <th style="text-align: center">Outlier</th>
                                                                </tr>
                                                            </thead>
                                                            <tfoot>
                                                                <th class="tfoot">TOTAL OUTLIER</th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th style="border-right: transparent"></th>
                                                                <th class="tfoot" style="text-align: center">@response.totalOutlier</th>
                                                            </tfoot>
                                                            <tfoot>
                                                                <th>Total</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th>@response.sfLofi.map(x=> x._7).sum</th>
                                                                <th>@response.sfLofi.map(x=> x._8).sum</th>
                                                                <th>@response.sfLofi.map(x=> x._4).sum</th>
                                                                <th>@response.sfLofi.map(x=> x._5).sum</th>
                                                                <th>@response.sfLofi.map(x=> x._9).sum</th>
                                                                <th></th>
                                                                <th></th>
                                                            </tfoot>
                                                            @for(i <- 0 until response.sfLofi.length) {
                                                                <tr>
                                                                    <th>@response.sfLofi(i)._1</th>
                                                                    <th onclick="showSigLogChart(this,@i,'sfLofi',10)" class="aTag" name="@response.sfLofi(i)._1/@response.sfLofi(i)._2/@response.sfLofi(i)._3">@response.sfLofi(i)._2</th>
                                                                    <th>@response.sfLofi(i)._3</th>
                                                                    <td>@response.sfLofi(i)._7</td>
                                                                    <td>@response.sfLofi(i)._8</td>
                                                                    <td>@response.sfLofi(i)._4</td>
                                                                    <td>@response.sfLofi(i)._5</td>
                                                                    <td>@response.sfLofi(i)._9</td>
                                                                    <td>@response.sfLofi(i)._10</td>
                                                                    <th style="text-align: center">
                                                                    @if(email == "inf" || email == "admin") {
                                                                        @if(response.sfLofi(i)._6 > 0) {
                                                                            <a onclick="rejectOutlier(this)" name="@response.sfLofi(i)._6" class="btn btn-danger btn-xs"><i class="fa fa-remove"></i></a>
                                                                        } else {
                                                                            <a onclick="confirmOutlier(this)" name="@response.sfLofi(i)._6" class="btn btn-success btn-xs"><i class="fa fa-check"></i></a>
                                                                        }
                                                                    }
                                                                    </th>
                                                                </tr>
                                                            }
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="tabBroken">
                                        <div class="row top_tiles">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                <div class="x_panel tile " style="padding: 0px;">
                                                    <div class="x_content">
                                                        <table class="data table table-bordered tbScroll" id="tbInf" style="width: 100%">
                                                            <thead >
                                                                <tr>
                                                                    <th style="width: 40%">Date time</th>
                                                                    <th>Host</th>
                                                                    <th>Module</th>
                                                                    <th>List Of Port Pon Get Down Port Inf <i class="fa fa-info-circle toolTipText" title="Danh sách module bị rớt port hạ tầng"></i></th>
                                                                </tr>
                                                            </thead>
                                                            <tfoot>
                                                                <th>Total</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th>@response.infDown.map(x=> x._4).sum</th>
                                                            </tfoot>
                                                            @if(response.infDown != null) {
                                                                <tbody >
                                                                @for(i <- 0 until response.infDown.length) {
                                                                    <tr onclick="showSigLogChart(this,@i,'infDown',4)" class="aTag" name="@response.infDown(i)._1/@response.infDown(i)._2/@response.infDown(i)._3">
                                                                        <th>@response.infDown(i)._1</th>
                                                                        <th>@response.infDown(i)._2</th>
                                                                        <th>@response.infDown(i)._3</th>
                                                                        <th>@response.infDown(i)._4</th>
                                                                    </tr>
                                                                }
                                                                </tbody>
                                                            }
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                <div class="x_panel tile " style="padding: 0px;">
                                                    <div class="x_content">
                                                        <table class="data table table-bordered tbScroll" id="tbUserDown" style="width: 100%">
                                                            <thead >
                                                                <tr>
                                                                    <th style="width: 40%">Date time</th>
                                                                    <th>Host</th>
                                                                    <th>Module</th>
                                                                    <th>List Of Port Pon Get Down <i class="fa fa-info-circle toolTipText" title="Danh sách module bị rớt port pon"></i></th>
                                                                </tr>
                                                            </thead>
                                                            <tfoot>
                                                                <th style="width: 28%">Total</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th>@response.userDown.map(x=> x._4).sum</th>
                                                            </tfoot>
                                                            @if(response.userDown != null) {
                                                                <tbody >
                                                                @for(i <- 0 until response.userDown.length) {
                                                                    <tr onclick="showSigLogChart(this,@i,'userDown',4)" class="aTag" name="@response.userDown(i)._1/@response.userDown(i)._2/@response.userDown(i)._3">
                                                                        <th>@response.userDown(i)._1</th>
                                                                        <th>@response.userDown(i)._2</th>
                                                                        <th>@response.userDown(i)._3</th>
                                                                        <td>@response.userDown(i)._4</td>
                                                                    </tr>
                                                                }
                                                                </tbody>
                                                            }
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row top_tiles">
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                <div class="x_panel tile " style="padding: 0px;">
                                                    <div class="x_content">
                                                        <table class="data table table-bordered tbScroll" id="tbSpliter" style="width: 100%">
                                                            <thead >
                                                                <tr>
                                                                    <th>Date time</th>
                                                                    <th>Host</th>
                                                                    <th>Spliter</th>
                                                                    <th>List Of Splitter Get Broken <i class="fa fa-info-circle toolTipText" title="Danh sách tập điểm bị đứt cáp"></i></th>
                                                                </tr>
                                                            </thead>
                                                            <tfoot>
                                                                <th>Total</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th>@response.spliter.map(x=> x._4).sum</th>
                                                            </tfoot>
                                                            @if(response.spliter != null) {
                                                                <tbody >
                                                                @for(i <- 0 until response.spliter.length) {
                                                                    <tr>
                                                                        <th>@response.spliter(i)._1</th>
                                                                        <th>@response.spliter(i)._2</th>
                                                                        <th>@response.spliter(i)._3</th>
                                                                        <th>@response.spliter(i)._4</th>
                                                                    </tr>
                                                                }
                                                                </tbody>
                                                            }
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                <div class="x_panel tile " style="padding: 0px;">
                                                    <div class="x_content">
                                                        <table class="data table table-bordered tbScroll" id="tbIndex" style="width: 100%">
                                                            <thead >
                                                                <tr>
                                                                    <th>Date time</th>
                                                                    <th>Host</th>
                                                                    <th>Module</th>
                                                                    <th>Index</th>
                                                                    <th>List Of Index Get Rogue Ont <i class="fa fa-info-circle toolTipText" title="Danh sách KHG gây ra lỗi rogue ONT"></i></th>
                                                                </tr>
                                                            </thead>
                                                            <tfoot>
                                                                <th>Total</th>
                                                                <th></th>
                                                                <th></th>
                                                                <th></th>
                                                                <th>@response.indexRouge.map(x=> x._5).sum</th>
                                                            </tfoot>
                                                            @for(i <- 0 until response.indexRouge.length) {
                                                                <tr onclick="showSigLogChart(this,@i,'indexRouge',5)" class="aTag" name="@response.indexRouge(i)._1/@response.indexRouge(i)._2/@response.indexRouge(i)._3">
                                                                    <th>@response.indexRouge(i)._1</th>
                                                                    <th>@response.indexRouge(i)._2</th>
                                                                    <th>@response.indexRouge(i)._3</th>
                                                                    <th>@response.indexRouge(i)._4</th>
                                                                    <th>@response.indexRouge(i)._5</th>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="5" style="padding: 0px;">
                                                                        <div class="collapse" id="indexRouge@i"></div>
                                                                    </td>
                                                                    <td style="display: none"></td>
                                                                    <td style="display: none"></td>
                                                                    <td style="display: none"></td>
                                                                    <td style="display: none"></td>
                                                                </tr>
                                                            }
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="tabHost">
                                        <input type="hidden" id="hostSearch"/>
                                        <div class="row top_tiles" id="divTotal" style="display: none">
                                            <div class="boxCss animated col-lg-3 col-md-3 col-sm-3 col-xs-12" style="width: 20%">
                                                <div class="tile-stats" style="background-color: #1ABB9C;display: inherit">
                                                    <div class="count" id="totalSignin"></div>
                                                    <div class="titLb">Total Signin</div>
                                                </div>
                                            </div>
                                            <div class="boxCss animated col-lg-2 col-md-2 col-sm-2 col-xs-12" style="width: 20%">
                                                <div class="tile-stats" style="background-color: #dc5a78;display: inherit">
                                                    <div class="count" id="totalLogoff"></div>
                                                    <div class="titLb">Total Logoff</div>
                                                </div>
                                            </div>
                                            <div class="boxCss animated col-lg-2 col-md-2 col-sm-2 col-xs-12" style="width: 20%">
                                                <div class="tile-stats" style="background-color: #73879C;display: inherit">
                                                    <div class="count" id="totalModule"></div>
                                                    <div class="titLb">Total modules</div>
                                                </div>
                                            </div>
                                            <div class="boxCss animated col-lg-2 col-md-2 col-sm-2 col-xs-12" style="width: 20%">
                                                <div class="tile-stats" style="background-color: #f1b53d;display: inherit">
                                                    <div class="count" id="totalSplitter"></div>
                                                    <div class="titLb">Total splitters</div>
                                                </div>
                                            </div>
                                            <div class="boxCss animated col-lg-3 col-md-3 col-sm-3 col-xs-12" style="width: 20%">
                                                <div class="tile-stats" style="display: inherit;background-color: #3498DB">
                                                    <div class="count" id="totalClient"></div>
                                                    <div class="titLb">Total Clients</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row top_tiles">
                                            <div class="col-xs-12">
                                                <div id="host" style="max-height: 600px;background: #fff"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal" tabindex="-1" role="dialog" id="modal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="margin-top: 145px">
                        <div class="modal-body">
                            <p id="message" class="error">System error, sorry choose again...</p>
                        </div>
                        <div class="modal-footer" style="padding:6px 10px 2px 10px;">
                            <button type="button" class="btn btn-primary" onclick="hideModal()">Close</button>
                        </div>
                    </div>
                </div>
            </div>

        }else {
            <div class="row"><h2 class="noData-title">Not enough data. sorry!</h2></div>
        }
    </div>
        <!-- /page content -->

        <!-- footer content -->
    <footer>
        <div class="pull-right">
            Dashboard Admin 21/09/2017
        </div>
        <div class="clearfix"></div>
    </footer>
        <!-- /footer content -->
    </div>
    </div>

        <!-- jQuery -->
    <script src="../assets/vendors/jquery/dist/jquery.min.js"></script>
        <!-- Bootstrap -->
    <script src="../assets/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
        <!-- Custom Theme Scripts -->
    <script src="../assets/custom/js/custom.min.js"></script>

        <!-- Counter number -->
    <script src="../assets/javascripts/jquery.counterup.min.js"></script>
    <script type="text/javascript" src="../assets/javascripts/vis.min.js"></script>
        <!-- Autocomplete -->
    <script src="../assets/javascripts/jquery-ui.js"></script>
        <!-- Hight chart -->
    <script src="../assets/javascripts/highcharts.js"></script>
    <script src="../assets/javascripts/exporting.js"></script>
    <script src="../assets/javascripts/waitMe.js"></script>
        <!-- Datatable -->
    <script src="../assets/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="../assets/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="../assets/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="../assets/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="../assets/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="../assets/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="../assets/vendors/jszip/jszip.min.js"></script>
    <script src="../assets/vendors/jszip/pdfmake.min.js"></script>
    <script src="../assets/vendors/jszip/vfs_fonts.js"></script>

    <script src="../assets/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="../assets/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="../assets/vendors/datatables.net-fixedColumn/js/dataTables.fixedColumn.min.js"></script>
    <script>
        $(document).ready(function(){
            $( "#hiddenField" ).datepicker({
                showOn: "button",
                dateFormat: "yyyy-mm-dd",
                maxDate: 0,
                buttonText: "<i class=\"fa fa-download\"></i> CSV",
                onSelect: function () {
                    var startDate = new Date($(this).datepicker('getDate'));
                    var yr = startDate.getFullYear();
                    var month = startDate.getMonth() < 10 ? ('0' + Number(startDate.getMonth()+1)) : (Number(startDate.getMonth()+1));
                    var day = startDate.getDate() < 10 ? ('0' + Number(startDate.getDate())) : (Number(startDate.getDate()));
                    var newDate = yr + '-' + month + '-'+day;
                    $.ajax({
                        url: "/inf/exportCSV?date=" + newDate,
                        cache: false,
                        beforeSend: function () {
                            $('#divSf').waitMe({
                                effect: 'roundBounce',
                                text: 'Please wait...',
                                bg: 'rgba(255,255,255,0.7)',
                                color: '#000',
                                textPos: 'vertical'
                            });
                        },
                        success: function (dta) {
                            if(dta != "Error"){
                                //console.log(dta.data)
                                exportToCsv('export-inf-'+newDate+'.csv', addHeaderToArray(dta.data))
                            }
                            else{
                                $('#modal').show()
                            }
                        },
                        complete: function () {
                            $('#divSf').waitMe("hide");
                        }
                    });
                }
            });
            // table tab Event
            var tbSf = $('#tbSf').DataTable( {
                dom: 'Bfrtip',
                "scrollY":        "650px",
                "scrollCollapse": true,
                "paging":         false,
                "info":     false,
                "searching":     true,
                "sort":     false,
                destroy: true,
                buttons: [
                    {
                        enabled: false,
                        extend:    'csvHtml5',
                        text:      '<i class="fa fa-download"> CSV</i>',
                        titleAttr: 'CSV'
                    }
                ]
            });
            // table tab Broken
            var tbIndex = $('#tbIndex').DataTable( {
                dom: 'Bfrtip',
                "scrollY":        "350px",
                "scrollCollapse": true,
                "paging":         false,
                "info":     false,
                "searching":     true,
                "sort":     false,
                destroy: true,
                buttons: [
                    {
                        extend:    'csvHtml5',
                        text:      '<i class="fa fa-download"> CSV</i>',
                        titleAttr: 'CSV'
                    }
                ]
            });
            var tbSpliter = $('#tbSpliter').DataTable( {
                dom: 'Bfrtip',
                "scrollY":        "350px",
                "scrollCollapse": true,
                "paging":         false,
                "info":     false,
                "searching":     true,
                "sort":     false,
                destroy: true,
                buttons: [
                    {
                        extend:    'csvHtml5',
                        text:      '<i class="fa fa-download"> CSV</i>',
                        titleAttr: 'CSV'
                    }
                ]
            });
            var tbUserDown = $('#tbUserDown').DataTable( {
                dom: 'Bfrtip',
                "scrollY":        "330px",
                "scrollCollapse": true,
                "paging":         false,
                "info":     false,
                "searching":     true,
                "sort":     false,
                destroy: true,
                buttons: [
                    {
                        extend:    'csvHtml5',
                        text:      '<i class="fa fa-download"> CSV</i>',
                        titleAttr: 'CSV'
                    }
                ]
            });
            var tbInf = $('#tbInf').DataTable( {
                dom: 'Bfrtip',
                "scrollY":        "330px",
                "scrollCollapse": true,
                "paging":         false,
                "info":     false,
                "searching":     true,
                "sort":     false,
                destroy: true,
                buttons: [
                    {
                        extend:    'csvHtml5',
                        text:      '<i class="fa fa-download"> CSV</i>',
                        titleAttr: 'CSV'
                    }
                ]
            });

            $('.nav-tabs li').click(function () {
                $('.nav-tabs li').removeClass('in').removeClass('active')
                var tab = $(this).find('a').attr('class')
                $('#search').val("")
                $('.'+tab).parent().addClass("in").addClass("active")
                $('.tab-pane').removeClass("in").removeClass("active")
                if(tab == "tabBroken"){
                    $("#hostSearch").val("")
                    $(".autocomplete").autocomplete({disabled: true})
                    $('#'+tab).addClass("in").addClass("active")
                    tbUserDown.search( $('#search').val() ).draw();
                    tbInf.search( $('#search').val() ).draw();
                    tbSpliter.search( $('#search').val() ).draw();
                    tbIndex.search( $('#search').val() ).draw();
                }
                else if(tab == "tabEvent"){
                    $("#hostSearch").val("")
                    $(".autocomplete").autocomplete({disabled: true})
                    $('#'+tab).addClass("in").addClass("active")
                    tbSf.search($('#search').val()).draw();
                }
                else{
                    $('#'+tab).addClass("in").addClass("active")
                    if($('#hostSearch').val() != ""){
                        $.ajax({
                            url: "/inf/getHostMonitor?host=" + $('#hostSearch').val(),
                            cache: false,
                            beforeSend: function () {
                                $('#tabHost').waitMe({
                                    effect: 'roundBounce',
                                    text: 'Please wait...',
                                    bg: 'rgba(255,255,255,0.7)',
                                    color: '#000',
                                    textPos: 'vertical'
                                });
                            },
                            success: function (dta) {
                                if (dta != "Error") {
                                    $('.boxCss').removeClass("flipInY")
                                    $('#divTotal').show()
                                    var nf = new Intl.NumberFormat()
                                    $('.boxCss').addClass("flipInY")
                                    $('#totalClient').text(nf.format(dta.totalClient))
                                    $('#totalSplitter').text(dta.totalSpliter)
                                    $('#totalModule').text(dta.totalModule)
                                    $('#totalSignin').text(dta.totalSignin)
                                    $('#totalLogoff').text(dta.totalLogoff)
                                    drawHost(dta, $('#hostSearch').val())
                                }
                            },
                            complete: function () {
                                $('#tabHost').waitMe("hide");
                            }
                        });
                    }
                    // for search tab host
                    jQuery.get('../assets/host_inf.csv', function (data) {
                        $(".autocomplete").autocomplete({
                            disabled: false,
                            source: data.split('\n'),
                            select: function (event, ui) {
                                var host = ui.item.value
                                $.ajax({
                                    url: "/inf/getHostMonitor?host=" + host,
                                    cache: false,
                                    beforeSend: function () {
                                        $('#tabHost').waitMe({
                                            effect: 'roundBounce',
                                            text: 'Please wait...',
                                            bg: 'rgba(255,255,255,0.7)',
                                            color: '#000',
                                            textPos: 'vertical'
                                        });
                                    },
                                    success: function (dta) {
                                        if (dta != "Error") {
                                            $("#hostSearch").val(host)
                                            $('.boxCss').removeClass("flipInY")
                                            $('#divTotal').show()
                                            var nf = new Intl.NumberFormat()
                                            $('.boxCss').addClass("flipInY")
                                            $('#totalClient').text(nf.format(dta.totalClient))
                                            $('#totalSplitter').text(dta.totalSpliter)
                                            $('#totalModule').text(dta.totalModule)
                                            $('#totalSignin').text(dta.totalSignin)
                                            $('#totalLogoff').text(dta.totalLogoff)
                                            drawHost(dta, host)
                                        }
                                    },
                                    complete: function () {
                                        $('#tabHost').waitMe("hide");
                                    }
                                });
                            }
                        });
                    });
                }
            })

            // for search DataTable
            $('#search').on('keyup', function () {
                var nameTab = $('.nav-tabs li.active').find('a').attr('class')
                if(nameTab == "tabBroken"){
                    tbUserDown.search( this.value ).draw();
                    tbInf.search( this.value ).draw();
                    tbSpliter.search( this.value ).draw();
                    tbIndex.search( this.value ).draw();
                }
                else if(nameTab == "tabEvent")
                  tbSf.search( this.value ).draw();
            });

            // active host module outlier
            $('#tbSf .aTag').each(function () {
                var names = $(this).attr('name').trim().substring($(this).attr('name').trim().indexOf("/")+1);
                var ids = $('#ids').val().trim()
                if(ids == names){
                    $(this).parent().addClass('aActive')
                    $('#search').val(ids.split('/')[0])
                    tbSf.search(ids.split('/')[0]).draw();
                }
            });
        })

        function hideModal() {
            $('#modal').hide()
        }

        function addHeaderToArray(dta){
            var rs = []
            rs.push(["Date Time", "Module", "Host", "User Down", "Inf Down", "Sf Error", "Lofi Error", "Rouge Error", "Lost Signal"])
            for(var i=0;i<dta.length;i++){
                var arr = []
                arr[0]= dta[i][0]
                arr[1]=dta[i][1]
                arr[2]=dta[i][2]
                arr[3]=dta[i][3]
                arr[4]=dta[i][4]
                arr[5]=dta[i][5]
                arr[6]=dta[i][6]
                arr[7]=dta[i][7]
                arr[8]=dta[i][8]
                rs.push(arr)
            }
            return rs
        }


        function exportToCsv(filename, rows) {
            var processRow = function (row) {
                var finalVal = '';
                for (var j = 0; j < row.length; j++) {
                    var innerValue = row[j] === null ? '' : row[j].toString();
                    if (row[j] instanceof Date) {
                        innerValue = row[j].toLocaleString();
                    };
                    var result = innerValue.replace(/"/g, '""');
                    if (result.search(/("|,|\n)/g) >= 0)
                        result = '"' + result + '"';
                    if (j > 0)
                        finalVal += ',';
                    finalVal += result;
                }
                return finalVal + '\n';
            };

            var csvFile = '';
            for (var i = 0; i < rows.length; i++) {
                csvFile += processRow(rows[i]);
            }

            var blob = new Blob([csvFile], { type: 'text/csv;charset=utf-8;' });
            if (navigator.msSaveBlob) { // IE 10+
                navigator.msSaveBlob(blob, filename);
            } else {
                var link = document.createElement("a");
                if (link.download !== undefined) { // feature detection
                    // Browsers that support HTML5 download attribute
                    var url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }

        function getEdgeHost(dta){
            var jsonArr = [];
            for (var i = 0; i < dta.length; i++) {
                jsonArr.push({
                    from: 0,
                    to: dta[i]
                });
            }
            return jsonArr
        }

        function getNodeHost(dta,idhost){
            var jsonArr = [];
            jsonArr.push({
                id: 0,
                label: "Host "+idhost,
                color: "#f1b53d"
            });
            for (var i = 0; i < dta.length; i++) {
                jsonArr.push({
                    id: dta[i],
                    label:"Module "+dta[i],
                    color: "#9B59B6"
                });
            }
            return jsonArr
        }

        function drawHost(data,idHost){
            //console.log(Object.keys(data).length)
            if(data.host.length == 0 )
                $('#host').attr('style','height:70px;background: #fff');
            else
                $('#host').attr('style','height: 600px;background: #fff');
            // Nodes HOST
            /*var nodeHost1 = new vis.DataSet([
                {id: 0, label: 'Root',color:'#9B59B6'},
                {id: 1, label: 'Host1',color:'#1ABB9C'},
                {id: 2, label: 'Host2',color:'#1ABB9C'},
                {id: 11,label: 'Module1'},
                {id: 12,label: 'Module2'},
                {id: 111,label: 'Splitter1'},
                {id: 112,label: 'Splitter2'}
            ]);*/
            // console.log(getNodeHost(data,idBras))
            var nodeHost = new vis.DataSet(getNodeHost(data.module,idHost))
            //console.log(nodeHost)
            // create an array with edges to represent the network
            /*var edgeHost1 = new vis.DataSet([
                {from: 0, to: 1},
                {from: 0, to: 2},
                {from: 1, to: 11},
                {from: 1, to: 12},
                {from: 11, to: 111},
                {from: 11, to: 112}
            ]);*/
            var edgeHost = new vis.DataSet(getEdgeHost(data.module))
            //console.log(edgeHost)
            // Find contained in document
            var divHost = document.getElementById('host');
            //Define data object and the options of the network
            var arrHost = {
                nodes: nodeHost,
                edges: edgeHost
            };
            var optionsHost = {
                autoResize: true,
                height: '100%',
                width: '100%'
            };
            //Define the network object to be rendered.
            var host = new vis.Network(divHost, arrHost, optionsHost);
            host.on("click", function (params) {
                var id = params['nodes']['0'];
                var numConnects = host.getConnectedEdges(id).length
                // click host
                if(id!= undefined && id==0) {
                    $('#host').attr('style','height: 600px;background: #fff');
                    drawHost(data,idHost)
                }
                // click module
                else if(id!= undefined && id.indexOf('/')< 0 && id !=0){
                    $('#host').attr('style', 'height: 800px;background: #fff')
                    if(numConnects <=1) {
                        addNodeEdgesLevel1(id, data, nodeHost, edgeHost)
                    }
                    else{
                        removeNodeEdgeLevel12(id, data, nodeHost, edgeHost,host)
                    }
                }
                // click splitter
                else if(id!= undefined && id.indexOf('/')>= 0){
                    $('#host').attr('style','height: 800px;background: #fff');
                    if(numConnects <= 1) {
                        addNodeEdgesLevel2(id, data, nodeHost, edgeHost)
                    }
                    else{
                        removeNodeEdgeLevel2(id, data, nodeHost, edgeHost)
                    }
                }
            });
        }

        /* add node edge vis js */
        function addNodeEdgesLevel2(id, data,nodeHost,edgeHost){
            var idModule = id.substring(0,id.indexOf("/"))
            var idSpliter = id.substring(id.indexOf("/")+1,id.length)
            // add node Index
            var arrIndex = new Array()
            for(var i=0;i<data.host.length;i++){
                if(data.host[i][0] == idModule && data.host[i][1] == idSpliter){
                    arrIndex.push(data.host[i][2]+"/"+data.host[i][3])
                }
            }
            var indexs = [];
            $.each(arrIndex, function(i, el){
                if($.inArray(el, indexs) === -1) indexs.push(el);
            });

            for(var j=0;j<indexs.length;j++){
                var contracts = indexs[j].split("/")[0]
                var status = indexs[j].split("/")[1]
                var color = "#73879C"
                if(status == "SignIn"){
                    color = "#1ABB9C"
                }
                else if(status == "LogOff"){
                    color =  "red"
                }
                nodeHost.add({
                    id: id+'/'+contracts,
                    label: contracts,
                    title: "Status: "+status,
                    color: color
                });
                // update edge
                edgeHost.add([{
                    id: 'idx'+id+'/'+contracts,
                    from: id,
                    to: id+'/'+contracts
                }]);
            }
        }

        function addNodeEdgesLevel1(idModule, data,nodeHost,edgeHost){
            // add node splitter
            var arrSpliter = new Array()
            for(var i=0;i<data.host.length;i++){
                if(data.host[i][0] == idModule){
                    arrSpliter.push(data.host[i][1])
                }
            }
            var spliters = [];
            $.each(arrSpliter, function(i, el){
                if($.inArray(el, spliters) === -1) spliters.push(el);
            });

            for(var j=0;j<spliters.length;j++){
                nodeHost.add({
                    id: idModule+'/'+spliters[j],
                    label: spliters[j],
                    color: '#f60'
                });
                // update edge
                edgeHost.add([{
                    id: 'spl-'+idModule+'/'+spliters[j],
                    from: idModule,
                    to: idModule+'/'+spliters[j]
                }]);
            }
        }

        /* remove node edge vis js*/
        function removeNodeEdgeLevel2(id, data,nodeHost,edgeHost){
            var idModule = id.substring(0,id.indexOf("/"))
            var idSpliter = id.substring(id.indexOf("/")+1,id.length)
            // remove node Index
            var arrIndex = new Array()
            for(var i=0;i<data.host.length;i++){
                if(data.host[i][0] == idModule && data.host[i][1] == idSpliter){
                    arrIndex.push(data.host[i][2])
                }
            }
            var indexs = [];
            $.each(arrIndex, function(i, el){
                if($.inArray(el, indexs) === -1) indexs.push(el);
            });

            for(var j=0;j<indexs.length;j++){
                // remove node
                nodeHost.remove(id+'/'+indexs[j]);
                // remove edge
                edgeHost.remove('idx'+id+'/'+indexs[j]);
            }
        }

        function removeNodeEdgeLevel12(idModule, data,nodeHost,edgeHost,host){
            // remove node Splitter
            var arrSpliter = new Array()
            for(var i=0;i<data.host.length;i++){
                if(data.host[i][0] == idModule){
                    arrSpliter.push(data.host[i][1])
                }
            }
            var spliters = [];
            $.each(arrSpliter, function(i, el){
                if($.inArray(el, spliters) === -1) spliters.push(el);
            });

            for(var j=0;j<spliters.length;j++){
                // remove node Index if exists
                var numConnects = host.getConnectedEdges(idModule+'/'+spliters[j]).length
                if(numConnects >1){
                    removeNodeEdgeLevel2(idModule+'/'+spliters[j],data,nodeHost,edgeHost)
                }
                // remove node
                nodeHost.remove(idModule+'/'+spliters[j]);
                // remove edge
                edgeHost.remove('spl-'+idModule+'/'+spliters[j]);
            }
        }

        function showSigLogChart(el,_index,_type,totalCol){
            var containerSiglog = 'siglog_'+_type+'' + _index
            var containerError = 'error_'+_type+'' + _index
            var id = $(el).attr('name')
            if($('#'+_type+''+_index).hasClass('in')){
                $('#hostSearch').val("")
                $('.aActive').removeClass('aActive')
                $('#'+_type+''+_index).collapse('hide');
            }
            else {
                $('#hostSearch').val(id.substring(id.indexOf("/")+1,id.lastIndexOf("/")))
                var rows = ''
                for(var i=0;i<totalCol-1;i++){
                    rows+= '<td style="display: none"></td>'
                }
                var html = '<tr class="chartTr">' +
                        '<td colspan="'+totalCol+'" style="padding: 0px;">' +
                        '<div class="col-lg-12 collapse" id="'+_type+''+_index+'">  <div class="col-lg-6" id="'+containerSiglog+'"></div> <div class="col-lg-6" id="'+containerError+'"></div> </div>' +
                        '</td>' + rows +
                        '</tr>'
                $('.chartTr').remove();
                $('.aActive').removeClass('aActive')
                if(_type == "sfLofi"){
                    $(el).parent().after(html)
                    $(el).parent().addClass('aActive')
                } else{
                    $(el).after(html)
                    $(el).addClass('aActive')
                }
                $('#'+_type+'' + _index).collapse('show');
                $.ajax({
                    url: "/inf-json?id=" + id,
                    cache: false,
                    success: function (dta) {
                        if(dta != "Error"){
                            // Chart line history host module
                            if(dta.jsError.time.length >0){
                                $('#'+containerSiglog).removeClass('col-lg-12').addClass('col-lg-6')
                                Highcharts.chart(containerError, {
                                    chart: {
                                        height: 200,
                                        zoomType: 'xy'
                                    },
                                    title: {
                                        text: ''
                                    },
                                    xAxis: [{
                                        categories: dta.jsError.time
                                    }],
                                    yAxis: [{ // Secondary yAxis
                                        gridLineWidth: 0,
                                        title: {
                                            text: 'Number of errors',
                                            style: {
                                                color: "#832d1d"
                                            }
                                        }
                                    }],
                                    tooltip: {
                                        shared: true
                                    },
                                    labels: {
                                        items: [{
                                            html: '',
                                            style: {
                                                left: '50px',
                                                top: '18px',
                                                color: (Highcharts.theme && Highcharts.theme.textColor) || 'black'
                                            }
                                        }]
                                    },

                                    series: [{
                                        type: 'spline',
                                        name: 'Errors',
                                        color: "#832d1d",
                                        data: dta.jsError.error
                                    }]
                                });
                            }
                            else
                                $('#'+containerSiglog).removeClass('col-lg-6').addClass('col-lg-12')
                            // Build the chart line day of month vector
                            var category = dta.jsSiglog.time;
                            var logoff = dta.jsSiglog.logoff;
                            var signin = dta.jsSiglog.signin;
                            //console.log(category)
                            Highcharts.chart(containerSiglog, {
                                chart: {
                                    height: 200,
                                    zoomType: 'xy'
                                },
                                title: {
                                    text: ''
                                },
                                xAxis: [{
                                    categories: category
                                }],
                                yAxis: [{ // Secondary yAxis
                                    gridLineWidth: 0,
                                    title: {
                                        text: 'Number of users',
                                    }
                                }],
                                tooltip: {
                                    shared: true
                                },
                                labels: {
                                    items: [{
                                        html: '',
                                        style: {
                                            left: '50px',
                                            top: '18px',
                                            color: (Highcharts.theme && Highcharts.theme.textColor) || 'black'
                                        }
                                    }]
                                },

                                series: [{
                                    type: 'spline',
                                    name: 'Sign In',
                                    color: "#1ABB9C",
                                    data: signin
                                }, {
                                    type: 'spline',
                                    name: 'Log Off',
                                    color: "#d9534f",
                                    data: logoff
                                }]
                            });
                        }
                    },
                });
            }
        }

        function rejectOutlier(element){
            var time = $(element).parent().parent().find("th:eq(0)").text().trim()
            var host = $(element).parent().parent().find("th:eq(1)").text().trim()
            var module = $(element).parent().parent().find("th:eq(2)").text().trim()
            var bras = $(element).parent().parent().find("th:last .brasHide").text().trim()
            $.ajax({
                url: "/inf/rejectLabel?host="+host+'&module='+module+'&time='+time+'&bras='+bras,
                success: function (data) {
                    if(data!= "Error"){
                        $(element).attr('disabled','disabled');
                        $(element).prop('onclick', null);
                    }
                }
            });
        }

        function confirmOutlier(element){
            var time = $(element).parent().parent().find("th:eq(0)").text().trim()
            var host = $(element).parent().parent().find("th:eq(1)").text().trim()
            var module = $(element).parent().parent().find("th:eq(2)").text().trim()
            $.ajax({
                url: "/inf/confirmLabel?host="+host+'&module='+module+'&time='+time,
                success: function (data) {
                    if(data!= "Error"){
                        $(element).attr('disabled','disabled');
                        $(element).prop('onclick', null);
                    }
                }
            });
        }
    </script>
    </body>
</html>