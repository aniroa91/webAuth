@(response: model.device.DailyResponse, day: String, email: String, province: String)(implicit request: RequestHeader)
@import play.api.libs.json.Json
@import services.domain.CommonService.formatPattern
@import play.api.libs.json.Json
@import services.domain.CommonService.getEndDate
@import services.domain.CommonService.getStartDate
@import device.utils.CommonUtils

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <!-- Meta, title, CSS, favicons, etc. -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Dashboard Admin </title>

            <!-- Bootstrap -->
        @common.views.html.common.css("Daily")
    </head>
    @common.views.html.common.top()
        <!-- top navigation -->
    <div class="top_nav">
        <div class="nav_menu">
            <nav>
                <div class="nav toggle" style="margin-bottom: 10px">
                    <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                </div>
            </nav>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="javascript:;" class="user-profile" data-toggle="dropdown" aria-expanded="false">
                        <img src="../assets/images/user.default.png" alt="">@email
                        <span class=" fa fa-angle-down"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-usermenu pull-right" style="top: auto!important;">
                        <li><a style="font-size: 20px" href="/logout"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                    </ul>
                </li>
                <li class="form-group pull-right" style="padding-top: 10px;right: 10px">
                    <div class="input-group date" id="monthPicker" style="margin-bottom: 5px;width: 200px">
                        <form action="/daily" method="POST" id="ctSearch">
                            <div class="input-group">
                                @helper.CSRF.formField
                                <input type="text" id="day" name="day" class="form-control" value="@day" readonly="true" style="cursor: pointer;background-color: white" >
                                <span class="input-group-addon" style="background-color: #5A738E!important;"><i class="fa fa-calendar" aria-hidden="true" style="color:white"></i>
                                </span>
                            </div>
                        </form>
                    </div>
                </li>
            </ul>

        </div>
    </div>
        <!-- /top navigation -->
        <!-- page content -->
    <div class="right_col" role="main">
        @if(response != null){
            <input type="hidden" id="provinceRole" value="@province">
            <input type="hidden" id="bras" value="*">
            @if(province == ""){
                <div class="row top_tiles">
                    <div class="col-md-6 col-sm-6 col-xs-12 col-lg-6" id="div1">
                    @if(response.ticketIssue._1.length >0) {
                        <div class="x_panel tile">
                            <div class="x_title">
                                <span class="elipse"> Ticket at Core Group</span>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê số ticket tại hệ thống core theo ngày, vị trí địa lý và loại sự cố"></i>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                <div id="col-core" style="height: 350px;"></div>
                            </div>
                        </div>
                    }
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-12 col-lg-6" id="div2">
                    @if(response.ticketIssue._2.length >0) {
                        <div class="x_panel tile">
                            <div class="x_title">
                                <span class="elipse"> Ticket at Access Group</span>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê số ticket tại hệ thống access và ngoại vị theo ngày, vị trí địa lý và loại sự cố"></i>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                <div id="col-noneCore" style="height: 350px;"></div>
                            </div>
                        </div>
                    }
                    </div>

                </div>
                <div class="row top_tiles" id="sectionLast">
                    <div class="col-md-6 col-sm-6 col-xs-12 col-lg-3" id="div3">
                        <div class="x_panel tile">
                            <div class="x_title">
                                <span class="elipse"> Total Outliers Bras Device</span>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê số lượng bất thường nhận diện được từ hoạt động kết nối của KHG trên BRAS theo ngày và vị trí địa lý"></i>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                <input type="hidden" id="textBrasOutlier">
                                <input type="hidden" id="isRegionBrasOutlier">
                                <input type="hidden" id="isProvinceBrasOutlier">
                            @if(response.brasOutlier.length >0) {
                                <div id="bras-outlier" style="height: 375px;"></div>
                            }else{
                                <span style="font-size: 13px">Not find data on @day</span>
                            }
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-12 col-lg-6" id="div4">
                        <div class="x_panel tile">
                            <input type="hidden" id="regionSigLog">
                            <input type="hidden" id="isRegionSigLog">
                            <input type="hidden" id="isProvinceSigLog">
                            <div class="x_title">
                                <span class="elipse"> Total SignIn & LogOff Daily</span>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê thông tin số lần ra/vào mạng của người dùng, đi kèm là số lượng người dùng tương ứng, theo ngày và vị trí địa lý"></i>
                                <a class="btn btn-success" id="backSigLog" style="display: none;float: right"></a>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                @if(response.siglogRegion._1.length >0 || response.siglogRegion._2.length >0) {
                                    <div id="region-siglog-bar" style="height: 375px;"></div>
                                }else{
                                    <span style="font-size: 13px">Not find data on @day</span>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-lg-3" id="div5">
                        <div class="x_panel tile">
                            <input type="hidden" id="regionDeviceErr">
                            <input type="hidden" id="isRegionDeviceErr">
                            <input type="hidden" id="isProvinceDeviceErr">
                            <div class="x_title">
                                <span class="elipse"> Device Errors By Location</span>
                                <a class="btn btn-success" id="backDeviceErr" style="display: none;float: right"></a>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê thông tin số lần phát sinh lỗi trên thiết bị BRAS theo ngày và vị trí địa lý"></i>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                @if(response.errorsDevice.length >0){
                                    <div id="tree-map" style="height: 350px;"></div>
                                    <form id="frmDeviceErr" style="text-align: center;font-size: 11px">
                                        <input type="hidden" id="typeDeviceErr" value="*">
                                        <label class="radio-inline radioText">
                                            <input type="radio" value="*" name="optradio" checked>All
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="alert" name="optradio">AlertCount
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="crit" name="optradio">CritCount
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="warning" name="optradio">WarningCount
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="notice" name="optradio">NoticeCount
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="err" name="optradio">ErrCount
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" value="emerg" name="optradio">EmergCount
                                        </label>
                                    </form>
                                }else{
                                    <span style="font-size: 13px">Not find data on @day</span>
                                }
                            </div>
                         </div>
                    </div>
                </div>
            }
            <div class="row top_tiles">
                @if(province != ""){
                    @if(response.ticketIssue._2.length >0) {
                        <div class="col-md-6 col-sm-6 col-xs-12 col-lg-4">
                            <div class="x_panel tile">
                                <div class="x_title">
                                    <span class="elipse"> Ticket at Access Group</span>
                                    <i class="fa fa-info-circle toolTipText" title="Thống kê số ticket tại hệ thống access và ngoại vị theo ngày, vị trí địa lý và loại sự cố"></i>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content" style="text-align: center">
                                    <div id="col-noneCore" style="height: 350px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12 col-lg-4">
                    } else {
                        <div class="col-md-6 col-sm-6 col-xs-12 col-lg-6">
                    }

                } else{
                <div class="col-md-6 col-sm-6 col-xs-12 col-lg-4"id="div6" style="display: none">
                }
                    <div class="x_panel tile">
                        <div class="x_title">
                            <span class="elipse"> Total Outliers Access Device</span>
                            <i class="fa fa-info-circle toolTipText" title="Thống kê số lượng bất thường nhận diện được từ lỗi thiết bị Access theo ngày và vị trí địa lý"></i>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content" style="text-align: center">
                            <input type="hidden" id="textInfOutlier">
                            <input type="hidden" id="isRegionInfOutlier">
                            <input type="hidden" id="isProvinceInfOutlier">
                            <div id="inf-outlier" style="height: 375px;"></div>
                        </div>
                    </div>
                </div>
                @if(province == ""){
                <div class="col-md-6 col-sm-6 col-xs-12 col-lg-4" id="div7" style="display: none">
                    <div class="x_panel tile">
                        <input type="hidden" id="regionServiceNotice">
                        <input type="hidden" id="isRegionServiceNotice">
                        <input type="hidden" id="isProvinceServiceNotice">
                        <div class="x_title">
                            <span class="elipse"> Service Monitor Notices</span>
                            <i class="fa fa-info-circle toolTipText" title="Thống kê thông tin số lần thay đổi trạng thái của các service quản lý thiết bị BRAS (hệ thống Opsview) theo ngày và vị trí địa lý"></i>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content" style="text-align: center">
                            <div id="bar-service" style="height: 350px;"></div>
                            <form id="frmServNotice" style="text-align: center">
                                <label class="radio-inline radioText">
                                    <input type="radio" value="*" name="optradio" checked>All
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="warn" name="optradio">Warning
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="unknown" name="optradio">Unknown
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="ok" name="optradio">Ok
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="crit" name="optradio">Crit
                                </label>
                            </form>
                        </div>
                    </div>
                </div>
                    <div class="col-xs-12 col-lg-4" id="div8" style="display: none">
                } else{
                    @if(response.ticketIssue._2.length >0) {
                       <div class="col-xs-12 col-lg-4">
                    } else {
                        <div class="col-xs-12 col-lg-6">
                    }
                }
                    <div class="x_panel tile">
                        <input type="hidden" id="regionInfErr">
                        <input type="hidden" id="isRegionInfErr">
                        <input type="hidden" id="isProvinceInfErr">
                        <div class="x_title">
                            <span class="elipse"> Inf Errors By Location</span>
                            <i class="fa fa-info-circle toolTipText" title="Thống kê thông tin số lần phát sinh lỗi tại thiết bị Access theo ngày và vị trí địa lý"></i>
                            <a class="btn btn-success" id="backInfErr" style="display: none;float: right"></a>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content" style="text-align: center">
                            <div id="region-inf" style="height: 350px;"></div>
                            <form id="frmInfErrordaily" style="text-align: center;font-size: 12px">
                                <input type="hidden" id="typeInfErr" value="*">
                                <label class="radio-inline radioText">
                                    <input type="radio" value="*" name="optradio" checked>All
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="user_down" name="optradio">PortPON Down
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="inf_down" name="optradio">PortInf Down
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="sf_error" name="optradio">SF Error
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="lofi_error" name="optradio">LOFI Error
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="rouge_error" name="optradio">Rogue ONT
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="lost_signal" name="optradio">Broken Lv2 Cable
                                </label>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
                <div class="row top_tiles">
                    <div class="col-xs-12" id="div12" style="display: none;margin-bottom: 10px">
                    @if(response.lstProBras.length > 0) {
                        <span class="hvr-pulse titDropdown">Bras:</span>
                        <ul class="slBras">
                            <li>All</li>
                            @for(region <- response.lstProBras.map(x => x._1).distinct.sorted) {
                                <li data-dropdown-text="@region">
                                    <ul>
                                    @for(province <- response.lstProBras.filter(x => x._1 == region).map(x => x._2).distinct.sorted) {
                                        <li data-dropdown-text="@province">
                                            <ul>
                                            @for(bras <- response.lstProBras.filter(x => x._1 == region && x._2 == province).map(x => x._3)) {
                                                <li>@bras</li>
                                            }
                                            </ul>
                                        </li>
                                    }
                                    </ul>
                                </li>
                            }
                        </ul>
                    }
                    </div>
                </div>
            @if(province == "") {
                <div class="row top_tiles">
                    <div class="col-md-12 col-sm-12 col-xs-12" id="div9" style="display: none">
                        <div class="x_panel tile">
                            <div class="x_title">
                                <span class="elipse">  Signin & Logoff By Time</span>
                                <i class="fa fa-info-circle toolTipText" title="Thống kê hoạt động kết nối ra vào mạng của KHG theo từng BRAS, ngày và vị trí địa lý"></i>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content" style="text-align: center">
                                <div id="col-lineSigLog" style="height: 250px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <div class="row top_tiles">
                <div class="col-xs-12" id="div10" style="display: none">
                    <div class="x_panel tile">
                        <div class="x_title">
                            <span class="elipse"> Total Error By Time</span>
                            <i class="fa fa-info-circle toolTipText" title="Thống kê số lần lỗi thiết bị Access trên từng BRAS theo ngày giờ hoặc theo khung giờ trong ngày"></i>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content" style="text-align: center">
                            <div class="container row">
                                <ul class="nav nav-pills nav-stacked col-md-2 col-xs-12" id="frameTime" style="margin-top: 10px">
                                    <li name="0" style="cursor: pointer" class="active"><a data-toggle="pill" style="width: 115px">HOURLY</a></li>
                                    <li name="1" style="cursor: pointer"><a data-toggle="pill" style="width: 115px">FRAME TIME</a></li>
                                </ul>
                                <div class="tab-content col-md-10 col-xs-12">
                                    <div id="heat_mapInfTab" style="height: 250px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                @if(province == "") {
                    <div class="row top_tiles">
                        <div class="col-xs-12" id="div11" style="display: none">
                            <div class="x_panel tile">
                                <div class="x_title">
                                    <span class="elipse"> Nerror (kibana & opview) By Time</span>
                                    <i class="fa fa-info-circle toolTipText" title="Thống kê số lần lỗi thiết bị BRAS (kibana) và số lần thay đổi trạng thái của các service quản lý (opsview) trên từng BRAS theo ngày giờ"></i>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content" style="text-align: center">
                                    <div id="int-col-hourly" style="height: 250px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
        }else{
            <div class="row"><h2 class="noData-title">Not enough data. Please enter on text search.</h2></div>
        }
    </div>
        <!-- /page content -->

        <!-- footer content -->
    <footer>
        <div class="pull-right">
            Dashboard Monitor 2018
        </div>
        <div class="clearfix"></div>
    </footer>
        <!-- /footer content -->
    </div>
    </div>

        <!-- jQuery -->
    <script src="../assets/vendors/jquery/dist/jquery.min.js"></script>
        <!-- Bootstrap -->
    <script src="../assets/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
        <!-- Custom Theme Scripts -->
    <script src="../assets/custom/js/custom.min.js"></script>

        <!-- Counter number -->
    <script src="../assets/javascripts/jquery.counterup.min.js"></script>
    <script type="text/javascript" src="../assets/javascripts/vis.min.js"></script>
        <!-- Autocomplete -->
    <script src="../assets/javascripts/jquery-ui.js"></script>
    <script src="../assets/javascripts/waitMe.js"></script>
    <script src="../assets/javascripts/jquery.dropdown.js"></script>
        <!-- Hight chart -->
    <script src="../assets/javascripts/highcharts.js"></script>
    <script src="../assets/javascripts/exporting.js"></script>
    <script src="../assets/javascripts/heatmap.js"></script>
    <script src="../assets/javascripts/treemap.js"></script>
    <script src="../assets/javascripts/funnel.js"></script>
    <script src="../assets/javascripts/drilldown.js"></script>
    <script src="../assets/javascripts/common.js"></script>
        <!--  Datepicker -->
    <script src="../assets/datepicker/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript">
            $(document).ready(function () {
                //  Total Error By Time
                var heat_mapInfTab = Highcharts.chart('heat_mapInfTab', {
                    chart: {
                        type: 'heatmap',
                        marginTop: 10,
                        marginBottom: 80,
                        plotBorderWidth: 1
                    },

                    title: {
                        text: ''
                    },
                    xAxis: {
                        categories: ["0h", "1h", "2h", "3h", "4h", "5h", "6h", "7h", "8h", "9h", "10h", "11h", "12h", "13h", "14h", "15h", "16h", "17h", "18h", "19h", "20h", "21h", "22h", "23h"]
                    },

                    yAxis: {
                        categories: ['Port PON down','Port INF down','SF Error','LOFI Error','Rogue ONT','Broken Lv2 Cable','SF Module'],
                        title: null
                    },

                    legend: {
                        align: 'center',
                        verticalAlign: 'bottom',
                        y: 10,
                        x:40
                    },

                    colorAxis: {
                        min: 0,
                        minColor: '#FFFFFF',
                        maxColor: '#d9534f'
                    },

                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.xAxis.categories[this.point.x] + '</b> <br> has <b>' +
                                    this.point.value + ' <b>' + this.series.yAxis.categories[this.point.y] + '</b>';
                        }
                    },

                    series: [{
                        name: 'Errors',
                        borderWidth: 1,
                        data: [],
                        dataLabels: {
                            enabled: true,
                            color: '#000000'
                        }
                    }]

                });
                @if(province == "") {
                    // Nerror (kibana & opview) By Time
                    var kiba_opsv_hourly = Highcharts.chart('int-col-hourly', {
                        chart: {
                            zoomType: 'xy'
                        },
                        title: {
                            text: ''
                        },
                        subtitle: {
                            text: ''
                        },
                        xAxis: [{
                            categories: ["0h", "1h", "2h", "3h", "4h", "5h", "6h", "7h", "8h", "9h", "10h", "11h", "12h", "13h", "14h", "15h", "16h", "17h", "18h", "19h", "20h", "21h", "22h", "23h"],
                            crosshair: true,
                            title: {
                                text: '',
                            }
                        }],
                        yAxis: [{ // Primary yAxis
                            labels: {
                                format: '{value}',
                                style: {
                                    color: "#5A738E"
                                }
                            },
                            title: {
                                text: 'Kibana (errors)',
                                style: {
                                    color: "#5A738E"
                                }
                            }
                        }, { // Secondary yAxis
                            title: {
                                text: 'Opview (errors)',
                                style: {
                                    color: "#d9534f"
                                }
                            },
                            labels: {
                                format: '{value}',
                                style: {
                                    color: "#d9534f"
                                }
                            },
                            opposite: true
                        }],
                        tooltip: {
                            shared: true
                        },

                        series: [
                            {
                                type: 'column',
                                name: 'Nerror',
                                yAxis: 0,
                                color: "#5A738E",
                                data: []
                            }, {
                                name: 'Ntime',
                                type: 'spline',
                                yAxis: 1,
                                color: "#d9534f",
                                data: []

                            }]
                    });
                    // Signin & Logoff By Time
                    var line_siglog = Highcharts.chart('col-lineSigLog', {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: ''
                    },
                    subtitle: {
                        text: ''
                    },
                    plotOptions: {
                        column: {
                            colorByPoint: true
                        }
                    },
                    colors: [
                        '#09006d', '#d9534f','#9B59B6','#f1b53d'
                    ],
                    xAxis: {
                        categories: ["0h", "1h", "2h", "3h", "4h", "5h", "6h", "7h", "8h", "9h", "10h", "11h", "12h", "13h", "14h", "15h", "16h", "17h", "18h", "19h", "20h", "21h", "22h", "23h"]
                    },
                    yAxis: {
                        title: {
                            text: "Values"
                        }

                    },
                    tooltip: {
                        crosshairs: true,
                        shared: true
                    },
                    plotOptions: {
                        spline: {
                            marker: {
                                radius: 4,
                                lineColor: '#666666',
                                lineWidth: 1
                            }
                        }
                    },
                    series: [{
                        type: 'spline',
                        name: 'Signin',
                        data: []
                    },
                        {
                            type: 'spline',
                            name: 'Logoff',
                            data: []
                        },
                        {
                            type: 'column',
                            name: 'Signin Clients',
                            data: []
                        },
                        {
                            type: 'column',
                            name: 'Logoff Clients',
                            data: []
                        }
                    ]
                });
                }
                // Inf Errors By Location
                var errors_inf = Highcharts.chart('region-inf', {
                    chart: {
                        type: 'funnel'
                    },
                    title: {
                        text: ''
                    },
                    colors: [
                        '#9B59B6', '#f1b53d', '#E74C3C', '#73879C', '#1ABB9C', '#832d1d', '#0000cc', '#dc5a78', '#f2ccff', '#09006d', '#cccccc',
                        '#669999', '#e6e600', '#132639', '#99cc00', '#466d6d', '#ffc6b3', '#666633', '#ffff00', '#3498DB'],
                    plotOptions: {
                        series: {
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b> ({point.y:,.0f})',
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
                                softConnector: true
                            },
                            center: ['40%', '50%'],
                            neckWidth: '30%',
                            neckHeight: '25%',
                            width: '80%',
                            cursor: 'pointer',
                            events: {
                                click: function (event) {
                                    callDrillDownInfErrors(event.point.name, 'drilldown')
                                }
                            }
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    series: [{
                        name: 'Errors',
                        data: []
                    }]
                });

                    /* AUTHORIZATION */
                    @if(!province.equals("")){
                    $.ajax({
                        type: "GET",
                        url: "/daily/loadDaily?day="+$('#day').val(),
                        cache: false,
                        success: function (dta) {
                            if (dta != "Error") {
                                    $('#div10').show()
                                    $('#div12').show()
                                // Total Outliers Access Device
                                Highcharts.chart('inf-outlier', {
                                    chart: {
                                        type: 'heatmap',
                                        marginTop: 10,
                                        marginBottom: 60,
                                        plotBorderWidth: 1
                                    },

                                    title: {
                                        text: ''
                                    },
                                    xAxis: {
                                        categories: ["Outliers"]
                                    },

                                    yAxis: {
                                        categories: dta.infOutlier.cate,
                                        title: null,
                                        labels: {
                                            style: {
                                                'min-width': ($(window).width() <= 1280)?'20px':'125px'
                                            },
                                            useHTML : true
                                        }
                                    },

                                    legend: {
                                        align: 'center',
                                        verticalAlign: 'bottom',
                                        y: 20,
                                        x: 50
                                    },

                                    colorAxis: {
                                        min: 0,
                                        minColor: '#FFFFFF',
                                        maxColor: '#d9534f'
                                    },

                                    tooltip: {
                                        formatter: function () {
                                            return '<b>'+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                    this.point.value + ' outliers</b> ';
                                        }
                                    },
                                    plotOptions: {
                                        series: {
                                            events: {
                                                click: function (event) {
                                                    callDrilldownInfOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown')
                                                }
                                            },
                                            dataLabels:{
                                                formatter:function(){
                                                    var nf = new Intl.NumberFormat();
                                                    return nf.format(this.point.value);
                                                }
                                            },
                                            cursor: 'pointer'
                                        }
                                    },
                                    series: [{
                                        name: 'Outliers',
                                        borderWidth: 1,
                                        data: getHeatmapBrasOutlier(dta.infOutlier.data,dta.infOutlier.cate),
                                        dataLabels: {
                                            enabled: true,
                                            color: '#000000'
                                        }
                                    }]

                                });
                                // Inf Errors By Location
                                errors_inf.series[0].setData(dta.objErrorInf)
                                // Total Error By Time
                                heat_mapInfTab.series[0].setData(getErrorHourlyHeatmap(dta.errHostByTime), true,true,false)
                            }
                            else {
                                alert("Error when execute query. Please check again your system!")
                            }
                        }
                    });
                }
                // auto scroll loading data
                $(window).scroll(function () {
                    if ($(window).scrollTop() == $(document).height() - $(window).height()) {
                        var itemId = $('div[id^=div]:visible:last').attr('id')
                        if(itemId == "div5") {
                            $.ajax({
                                type: "GET",
                                url: "/daily/loadDaily?day="+$('#day').val(),
                                cache: false,
                                beforeSend: function () {
                                    $('#sectionLast').waitMe({
                                        effect: 'facebook',
                                        text: '',
                                        bg: 'rgba(255,255,255,0.7)',
                                        color: '#2A3F54',
                                        textPos: 'vertical'
                                    });
                                },
                                success: function (dta) {
                                    if (dta != "Error") {
                                        $('div[id^=div]').show()
                                        // Total Outliers Access Device
                                        Highcharts.chart('inf-outlier', {
                                            chart: {
                                                type: 'heatmap',
                                                marginTop: 10,
                                                marginBottom: 60,
                                                plotBorderWidth: 1
                                            },

                                            title: {
                                                text: ''
                                            },
                                            xAxis: {
                                                categories: ["Outliers"]
                                            },

                                            yAxis: {
                                                categories: dta.infOutlier.cate,
                                                title: null,
                                                labels: {
                                                    style: {
                                                        'min-width': ($(window).width() <= 1280)?'20px':'125px'
                                                    },
                                                    useHTML : true
                                                }
                                            },

                                            legend: {
                                                align: 'center',
                                                verticalAlign: 'bottom',
                                                y: 20,
                                                x: 50
                                            },

                                            colorAxis: {
                                                min: 0,
                                                minColor: '#FFFFFF',
                                                maxColor: '#d9534f'
                                            },

                                            tooltip: {
                                                formatter: function () {
                                                    return '<b>'+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                            this.point.value + ' outliers</b> ';
                                                }
                                            },
                                            plotOptions: {
                                                series: {
                                                    events: {
                                                        click: function (event) {
                                                            callDrilldownInfOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown')
                                                        }
                                                    },
                                                    dataLabels:{
                                                        formatter:function(){
                                                            var nf = new Intl.NumberFormat();
                                                            return nf.format(this.point.value);
                                                        }
                                                    },
                                                    cursor: 'pointer'
                                                }
                                            },
                                            series: [{
                                                name: 'Outliers',
                                                borderWidth: 1,
                                                data: getHeatmapBrasOutlier(dta.infOutlier.data,dta.infOutlier.cate),
                                                dataLabels: {
                                                    enabled: true,
                                                    color: '#000000'
                                                }
                                            }]

                                        });
                                        //  Service Monitor Notices
                                        fntRightClick()
                                        Highcharts.chart('bar-service', {
                                            chart: {
                                                type: 'bar'
                                            },
                                            title: {
                                                text: ''
                                            },
                                            xAxis: {
                                                type:'category'
                                            },
                                            yAxis: {
                                                min: 0,
                                                title: {
                                                    text: ''
                                                }
                                            },
                                            colors: ['#1ABB9C'],
                                            legend: {
                                                reversed: true
                                            },
                                            plotOptions: {
                                                series: {
                                                    stacking: 'normal',
                                                    point:{
                                                        events: {
                                                            contextmenu: function (e) {
                                                                if(e.target.point.name.indexOf('-') >=0)
                                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            series: getDrildownStackBar(dta.objNotice.data,dta.objNotice.cate),
                                            drilldown: {
                                                drillUpButton: {
                                                    relativeTo: 'spacingBox',
                                                    position: {
                                                        align: "right",
                                                        verticalAlign: "top",
                                                        x: 10,
                                                        y: -10
                                                    }
                                                },
                                                series: getDrillDown2Level(dta.objNotice.data,dta.objNotice.cate)
                                            }
                                        });
                                        // Inf Errors By Location
                                        errors_inf.series[0].setData(dta.objErrorInf)
                                        // Signin & Logoff By Time
                                        line_siglog.series[0].setData(dta.objSigLogTime.signin)
                                        line_siglog.series[1].setData(dta.objSigLogTime.logoff)
                                        line_siglog.series[2].setData(dta.objSigLogTime.signinCli)
                                        line_siglog.series[3].setData(dta.objSigLogTime.logoffCli)
                                        // Total Error By Time
                                        heat_mapInfTab.series[0].setData(getErrorHourlyHeatmap(dta.errHostByTime), true,true,false)
                                        // Nerror (kibana & opview) By Time
                                        kiba_opsv_hourly.series[0].setData(dta.nErrorTime.kibana)
                                        kiba_opsv_hourly.series[1].setData(dta.nErrorTime.opsview)
                                    }
                                    else {
                                        alert("Error when execute query. Please check again your system!")
                                    }
                                },
                                complete: function () {
                                    $('#sectionLast').waitMe("hide");
                                }
                            });
                        }
                    }
                });
                $('.slBras').dropdown();
                $('#day').datepicker({
                    autoclose: true,
                    minViewMode: 0,
                    endDate: '+0d',
                    format: 'yyyy-mm-dd'
                }).on('changeDate', function () {
                    $('#ctSearch').submit()
                });
                @if(response != null){

                    @if(response.brasOutlier.length >0){
                        var heat_bras_outlier = Highcharts.chart('bras-outlier', {
                            chart: {
                                type: 'heatmap',
                                marginTop: 10,
                                marginBottom: 60,
                                plotBorderWidth: 1
                            },

                            title: {
                                text: ''
                            },
                            xAxis: {
                                categories: ["Outliers"]
                            },

                            yAxis: {
                                categories: @Html(Json.stringify(Json.toJson(response.brasOutlier.map(x=> x._1).distinct.sorted))),
                                title: null,
                                labels: {
                                    style: {
                                        'min-width': ($(window).width() <= 1280)?'2880px':'155px'
                                    },
                                    useHTML : true
                                }
                            },

                            legend: {
                                align: 'center',
                                verticalAlign: 'bottom',
                                y: 20,
                                x: 50
                            },

                            colorAxis: {
                                min: 0,
                                minColor: '#FFFFFF',
                                maxColor: '#d9534f'
                            },

                            tooltip: {
                                formatter: function () {
                                    return '<b>'+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                            this.point.value + ' outliers</b> ';
                                }
                            },
                            plotOptions: {
                                series: {
                                    events: {
                                        click: function (event) {
                                            callDrilldownBrasOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown')
                                        }
                                    },
                                    dataLabels:{
                                        formatter:function(){
                                            var nf = new Intl.NumberFormat();
                                            return nf.format(this.point.value);
                                        }
                                    },
                                    cursor: 'pointer'
                                }
                            },
                            series: [{
                                name: 'Outliers',
                                borderWidth: 1,
                                data: getHeatmapBrasOutlier(@Html(Json.stringify(Json.toJson(response.brasOutlier))), @Html(Json.stringify(Json.toJson(response.brasOutlier.map(x=> x._1).distinct.sorted)))),
                                dataLabels: {
                                    enabled: true,
                                    color: '#000000'
                                }
                            }]

                        });
                    }

                        // click group time tab
                        $('.nav-pills li').click( function () {
                            // _type: 0 hourly time
                            // _type: 1 frame time
                            $.ajax({
                                url: "/daily/getInfErrHourly?_type=0&id=" + $(this).attr('name')+"&day="+$('#day').val()+"&bras="+$('#bras').val()+"&province="+$('#provinceRole').val(),
                                cache: false,
                                success: function (dta) {
                                    if(dta != "Error"){
                                        // update chart Heatmap
                                        heat_mapInfTab.xAxis[0].update({categories: dta.cates})
                                        heat_mapInfTab.series[0].setData(getErrorHourlyHeatmap(dta.data), true,true,false)
                                    }
                                    else{
                                        alert("Error when execute query. Please check again your system!")
                                    }
                                }
                            })
                        })

                    @if(response.siglogRegion._1.length >0 || response.siglogRegion._2.length >0){
                        // Bar Logoff and Signin
                        var categoriesSigLog = @Html(Json.stringify(Json.toJson(response.siglogRegion._1.map(x=> x._1))))
                        var chartSigLogDaily = Highcharts.chart('region-siglog-bar', {
                            chart: {
                                type: 'bar'
                            },
                            title: {
                                text: ''
                            },
                            subtitle: {
                                text: ''
                            },
                            xAxis: [{
                                categories: categoriesSigLog,
                                reversed: false,
                            }, { // mirror axis on right side
                                opposite: true,
                                reversed: false,
                                categories: categoriesSigLog,
                                linkedTo: 0,
                            }],
                            yAxis: {
                                title: {
                                    text: null
                                },
                                labels: {
                                    formatter: function () {
                                        return Math.abs(this.value);
                                    }
                                },
                            },

                            plotOptions: {
                                series: {
                                    events: {
                                        click: function (event) {
                                            callDrilldownSigLog(event.point.category,'drilldown')
                                        }
                                    },
                                    cursor: 'pointer',
                                    stacking: 'normal'
                                }
                            },

                            tooltip: {
                                formatter: function () {
                                    return '<b>' + this.series.name + '</b><br/><b>' + this.point.category + '</b><br/>'
                                            + '<b>Total: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b><br/>Total clients: ' + Highcharts.numberFormat(Math.abs(this.point.k), 0);
                                }
                            },

                            series: [{
                                name: 'Signin',
                                color: '#669999',
                                data:  addParamClients(@Html(Json.stringify(Json.toJson(response.siglogRegion._2))))
                            }, {
                                name: 'Logoff',
                                color: '#832d1d',
                                data: addParamClients(@Html(Json.stringify(Json.toJson(response.siglogRegion._1))))
                            }]
                        });
                   }
                    @if(response.errorsDevice.length >0){
                        var treemapError = Highcharts.chart('tree-map', {
                            colorAxis: {
                                minColor: '#FFFFFF',
                                maxColor: Highcharts.getOptions().colors[8]
                            },
                            plotOptions: {
                                series: {
                                    events: {
                                        click: function (event) {
                                            if (event.point.node.childrenTotal == 0) {
                                                callDrilldownErrorDevice(event.point.name, 'drilldown')
                                            }
                                        }
                                    },
                                    cursor: 'pointer'
                                }
                            },
                            series: [{
                                type: "treemap",
                                layoutAlgorithm: 'strip',
                                color: "#f1b53d",
                                data: getJsonTreemap(@Html(Json.stringify(Json.toJson(response.errorsDevice))))
                            }],
                            title: {
                                text: ''
                            }
                        });
                    }

                    @if(response.ticketIssue._1.length > 0){
                        Highcharts.chart('col-core', {
                            chart: {
                                type: 'column'
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                type:'category'
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: ''
                                }
                            },
                            colors: ['#3498DB'],
                            legend: {
                                reversed: true
                            },
                            plotOptions: {
                                series: {
                                    stacking: 'normal',
                                    point:{
                                        events: {
                                            contextmenu: function (e) {
                                                if(e.target.point.name.indexOf('-') >=0)
                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                            }
                                        }
                                    }
                                }
                            },
                            series: getDrildownStackBar(@Html(Json.stringify(Json.toJson(response.ticketIssue._1))),@Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._1).toSeq.distinct.sorted)))),
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        align: "right",
                                        verticalAlign: "top",
                                        x: 10,
                                        y: -10
                                    }
                                },
                                series: getDrillDown2Level(@Html(Json.stringify(Json.toJson(response.ticketIssue._1))),@Html(Json.stringify(Json.toJson(response.ticketIssue._1.map(x=> x._1).toSeq.distinct.sorted))))
                            }
                        });
                    }
                    @if(response.ticketIssue._2.length > 0){
                        Highcharts.chart('col-noneCore', {
                            chart: {
                                type: 'column'
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                type:'category'
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: ''
                                }
                            },
                            colors: ['#dc5a78'],
                            legend: {
                                reversed: true
                            },
                            plotOptions: {
                                series: {
                                    stacking: 'normal',
                                    point:{
                                        events: {
                                            contextmenu: function (e) {
                                                if(e.target.point.name.indexOf('-') >=0)
                                                    window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                            }
                                        }
                                    }
                                }
                            },
                            series: getDrildownStackBar(@Html(Json.stringify(Json.toJson(response.ticketIssue._2))),@Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._1).toSeq.distinct.sorted)))),
                            drilldown: {
                                drillUpButton: {
                                    relativeTo: 'spacingBox',
                                    position: {
                                        align: "right",
                                        verticalAlign: "top",
                                        x: 10,
                                        y: -10
                                    }
                                },
                                series: getDrillDown2Level(@Html(Json.stringify(Json.toJson(response.ticketIssue._2))),@Html(Json.stringify(Json.toJson(response.ticketIssue._2.map(x=> x._1).toSeq.distinct.sorted))))
                            }
                        });
                    }

                    function getJsonTreemap(dta){
                        var jsonArr = [];
                        for (var i = 0; i < dta.length; i++) {
                            jsonArr.push({
                                name: dta[i][0],
                                value: Number(dta[i][1]),
                                colorValue: Number(dta[i][1]),
                            });
                        }
                        return jsonArr
                    }

                    // Select box Bras Location
                    $('.dropdown-child').click(function () {
                        var brasId = $(this).find('.dropdown-text').text()
                        $('#bras').val((brasId == "All") ? "*" : brasId)
                        $.ajax({
                            url: "/daily/getDailyBrasLocation?id=" + brasId+"&day="+$('#day').val()+ "&province="+$('#provinceRole').val()+"&_type="+$('#frameTime').find('.active').attr("name"),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error"){
                                    // for author role
                                    if($('#provinceRole').val() == ""){
                                        line_siglog.series[0].setData(dta.sigLogBytime.signin)
                                        line_siglog.series[1].setData(dta.sigLogBytime.logoff)
                                        line_siglog.series[2].setData(dta.sigLogBytime.signin_clients)
                                        line_siglog.series[3].setData(dta.sigLogBytime.logoff_clients)
                                        kiba_opsv_hourly.series[0].setData(dta.kibanaOpsview.kibana)
                                        kiba_opsv_hourly.series[1].setData(dta.kibanaOpsview.opsview)
                                    }
                                    heat_mapInfTab.xAxis[0].update({categories: dta.errorHourly.cates})
                                    heat_mapInfTab.series[0].setData(getErrorHourlyHeatmap(dta.errorHourly.data), true,true,false)
                                }
                            }
                        })
                    })

                    // for Device Errors By Location
                    function callDrilldownErrorDevice(cates, _type) {
                        $.ajax({
                            url: "/daily/ddErrorDevice?id=" + cates+"&day="+$('#day').val()+"&err="+$('#typeDeviceErr').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error"){
                                    // Apply for button back
                                    if(_type == 'drilldown') {
                                        $('#regionSigLogDeviceErr').val(cates)
                                        if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                            $('#backDeviceErr').text("Back to region")
                                            $('#isRegionDeviceErr').val(cates)
                                        }
                                        else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                            $('#backDeviceErr').text("Back to province")
                                            $('#isProvinceDeviceErr').val(cates)
                                        }
                                        $('#backDeviceErr').show()
                                    }
                                    else{
                                        if($('#backDeviceErr').text() == "Back to province"){
                                            $('#backDeviceErr').show()
                                            $('#backDeviceErr').text('Back to region')
                                        }
                                        else {
                                            $('#backDeviceErr').hide()
                                        }
                                    }
                                    treemapError.series[0].setData(getJsonTreemap(dta.data))
                                    // right click yAxis
                                    $('#tree-map .highcharts-level-group-1 rect').mousedown(function(e) {
                                        if(e.which == 3 && e.target.point.name.indexOf('-') >=0){
                                            window.open("/fwdRequest?bras=" + e.target.point.name, "_blank")
                                        }
                                        return false;
                                    });
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    }
                    $('#backDeviceErr').click(function () {
                        var id = "*"
                        if($('#backDeviceErr').text() == "Back to bras"){
                            id = $('#isProvinceDeviceErr').val()
                        }
                        else if($('#backDeviceErr').text() == "Back to province"){
                            id = $('#isRegionDeviceErr').val()
                        }
                        callDrilldownErrorDevice(id,'back')
                    })
                    // Click radio button choose Device Errors
                    $('#frmDeviceErr input:radio').change(function(){
                        $('#frmDeviceErr .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        var id =$(this).val()
                        $('#typeDeviceErr').val(id)
                        callDrilldownErrorDevice('*','back')
                    })
                    // Click radio button choose Service notices
                    $('#frmServNotice input:radio').change(function(){
                        $('#frmServNotice .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        $.ajax({
                            url: "/daily/getServNoticeByType?noti=" + $(this).val()+"&day="+$('#day').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error"){
                                    Highcharts.chart('bar-service', {
                                        chart: {
                                            type: 'bar'
                                        },
                                        title: {
                                            text: ''
                                        },
                                        xAxis: {
                                            type:'category'
                                        },
                                        yAxis: {
                                            min: 0,
                                            title: {
                                                text: ''
                                            }
                                        },
                                        colors: ['#1ABB9C'],
                                        legend: {
                                            reversed: true
                                        },
                                        plotOptions: {
                                            series: {
                                                stacking: 'normal'
                                            }
                                        },
                                        series: getDrildownStackBar(dta.data, dta.cates),
                                        drilldown: {
                                            drillUpButton: {
                                                relativeTo: 'spacingBox',
                                                position: {
                                                    align: "right",
                                                    verticalAlign: "top",
                                                    x: 10,
                                                    y: -10
                                                }
                                            },
                                            series: getDrillDown2Level(dta.data, dta.cates)
                                        }
                                    });
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    })
                    // Click radio button choose Service notices
                    $('#frmInfErrordaily input:radio').change(function(){
                        $('#frmInfErrordaily .radio-inline').removeClass('radioText')
                        $(this).parent().addClass('radioText')
                        $('#typeInfErr').val($(this).val())
                        $('#backInfErr').text("")
                        callDrillDownInfErrors('*', 'back')
                    })
                    //for Total SignIn & LogOff Daily
                    function callDrilldownSigLog(cates, _type){
                        $.ajax({
                            url: "/daily/ddSigLogDaily?id=" + cates+"&day="+$('#day').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error"){
                                    // Apply for button back
                                    if(_type == 'drilldown') {
                                        $('#regionSigLog').val(cates)
                                        if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                            $('#backSigLog').text("Back to region")
                                            $('#isRegionSigLog').val(cates)
                                        }
                                        else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                            $('#backSigLog').text("Back to province")
                                            $('#isProvinceSigLog').val(cates)
                                        }
                                        else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                            $('#backSigLog').text("Back to bras")
                                        }
                                        $('#backSigLog').show()
                                    }
                                    else{
                                        if($('#backSigLog').text() == "Back to bras"){
                                            $('#backSigLog').show()
                                            $('#backSigLog').text('Back to province')
                                        }
                                        else if($('#backSigLog').text() == "Back to province"){
                                            $('#backSigLog').show()
                                            $('#backSigLog').text('Back to region')
                                        }
                                        else {
                                            $('#backSigLog').hide()
                                        }
                                    }
                                    chartSigLogDaily.xAxis[0].update({categories: dta.cates});
                                    chartSigLogDaily.xAxis[1].update({categories: dta.cates});
                                    chartSigLogDaily.series[0].setData(addParamClients(dta.signin))
                                    chartSigLogDaily.series[1].setData(addParamClients(dta.logoff))
                                    // right click yAxis
                                    $('#region-siglog-bar .highcharts-xaxis-labels text').mousedown(function(e) {
                                        if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                            window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                        }
                                        return false;
                                    });
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    }
                    $('#backSigLog').click(function () {
                        var id = "*"
                        if($('#backSigLog').text() == "Back to bras"){
                            id = $('#isProvinceSigLog').val()
                        }
                        else if($('#backSigLog').text() == "Back to province"){
                            id = $('#isRegionSigLog').val()
                        }
                        callDrilldownSigLog(id,'back')
                    })
                    // for inf errors funnel charts
                    function callDrillDownInfErrors(cates, _type) {
                        $.ajax({
                            url: "/daily/ddInferrorDaily?id=" + cates+"&day="+$('#day').val()+"&err="+$('#typeInfErr').val()+"&province="+$('#provinceRole').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error" && dta.data.length >0){
                                    // Apply for button back
                                    if(_type == 'drilldown') {
                                        $('#regionInfErr').val(cates)
                                        if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                            $('#backInfErr').text("Back to region")
                                            $('#isRegionInfErr').val(cates)
                                        }
                                        else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                            $('#backInfErr').text("Back to province")
                                            $('#isProvinceInfErr').val(cates)
                                        }
                                        else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                            $('#backInfErr').text("Back to bras")
                                        }
                                        $('#backInfErr').show()
                                    }
                                    else{
                                        if($('#backInfErr').text() == "Back to bras"){
                                            $('#backInfErr').show()
                                            $('#backInfErr').text('Back to province')
                                        }
                                        else if($('#backInfErr').text() == "Back to province"){
                                            $('#backInfErr').show()
                                            $('#backInfErr').text('Back to region')
                                        }
                                        else {
                                            $('#backInfErr').hide()
                                        }
                                    }
                                    errors_inf.series[0].setData(dta.data)
                                    // right click yAxis
                                    $('#region-inf .highcharts-data-label tspan').contextmenu(function(e) {
                                        if(e.target.textContent.indexOf('-') >=0){
                                            window.open("/fwdRequest?bras=" + e.target.textContent)
                                        }
                                        return false;
                                    });
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    }
                    $('#backInfErr').click(function () {
                        var id = "*"
                        if($('#backInfErr').text() == "Back to bras"){
                            id = $('#isProvinceInfErr').val()
                        }
                        else if($('#backInfErr').text() == "Back to province"){
                            id = $('#isRegionInfErr').val()
                        }
                        callDrillDownInfErrors(id,'back')
                    })
                    // drilldown heat map Bras Outliers
                    function callDrilldownBrasOutlier(cates, _type){
                        $.ajax({
                            url: "/daily/ddBrasOutlier?id=" + cates+"&day="+$('#day').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error"){
                                    var vlMarTop = 40
                                    if(cates == "*") vlMarTop = 10
                                    Highcharts.chart('bras-outlier', {
                                        chart: {
                                            type: 'heatmap',
                                            marginTop: vlMarTop,
                                            marginBottom: 60,
                                            plotBorderWidth: 1
                                        },

                                        title: {
                                            text: ''
                                        },
                                        xAxis: {
                                            categories: ["Outliers"]
                                        },

                                        yAxis: {
                                            categories: dta.key,
                                            title: null,
                                            labels: {
                                                style: {
                                                    'min-width': ($(window).width() <= 1280)?'20px':'125px'
                                                },
                                                useHTML : true
                                            }
                                        },

                                        legend: {
                                            align: 'center',
                                            verticalAlign: 'bottom',
                                            y: 20,
                                            x: 40
                                        },

                                        colorAxis: {
                                            min: 0,
                                            minColor: '#FFFFFF',
                                            maxColor: '#d9534f'
                                        },

                                        tooltip: {
                                            formatter: function () {
                                                return '<b>'+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                        this.point.value + ' outliers</b> ';
                                            }
                                        },
                                        plotOptions: {
                                            series: {
                                                events: {
                                                    click: function (event) {
                                                        callDrilldownBrasOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown')
                                                    }
                                                },
                                                dataLabels:{
                                                    formatter:function(){
                                                        var nf = new Intl.NumberFormat();
                                                        return nf.format(this.point.value);
                                                    }
                                                },
                                                cursor: 'pointer'
                                            }
                                        },
                                        exporting: {
                                            buttons: [{
                                                text: 'Back to '+dta.location,
                                                onclick: function (e) {
                                                    var id = "*"
                                                    var tit = "back"
                                                    if($('#textBrasOutlier').val() == "Back to province"){
                                                        tit = "drilldown"
                                                        id = $('#isRegionBrasOutlier').val()
                                                        $('#textBrasOutlier').val('Back to region')
                                                    }
                                                    if($('#textBrasOutlier').val() == "Back to bras") {
                                                        tit = "drilldown"
                                                        id = $('#isProvinceBrasOutlier').val()
                                                        $('#textBrasOutlier').val('Back to province')
                                                    }
                                                    callDrilldownBrasOutlier(id, tit)
                                                },
                                                theme: {
                                                    fill: '#1ABB9C',
                                                    'stroke-width': 1,
                                                    stroke: '#169F85',
                                                    color:'#fff',
                                                    states: {
                                                        hover: {
                                                            fill: '#1ABB9C'
                                                        }
                                                    }
                                                }
                                            }]
                                        },
                                        series: [{
                                            name: 'Outliers',
                                            borderWidth: 1,
                                            data: getHeatmapBrasOutlier(dta.data, dta.key),
                                            dataLabels: {
                                                enabled: true,
                                                color: '#000000'
                                            }
                                        }]

                                    });
                                    if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                        $('#isRegionBrasOutlier').val(cates)
                                        $('#textBrasOutlier').val("Back to region")
                                    }
                                    if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                        $('#isProvinceBrasOutlier').val(cates)
                                        $('#textBrasOutlier').val("Back to province")
                                    }
                                    else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                        $('#textBrasOutlier').val("Back to bras")
                                    }
                                    // Apply for button back
                                    if(_type == 'drilldown') {
                                        $('#bras-outlier .highcharts-button').show()
                                        $('.highcharts-contextbutton').hide()
                                    }
                                    else{
                                        $('#bras-outlier .highcharts-button').hide()
                                    }
                                    // right click yAxis
                                    $('#bras-outlier .highcharts-yaxis-labels span').mousedown(function(e) {
                                        if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                            window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                        }
                                        return false;
                                    });
                                    //heat_bras_outlier.yAxis[0].update({categories: dta.key})
                                    //heat_bras_outlier.series[0].setData(getHeatmapBrasOutlier(dta.data, dta.key))
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    }
                    //drilldown heat map Inf Outliers
                    function callDrilldownInfOutlier(cates, _type){
                        $.ajax({
                            url: "/daily/ddInfOutlier?id=" + cates+"&day="+$('#day').val()+"&province="+$('#provinceRole').val(),
                            cache: false,
                            success: function (dta) {
                                if(dta != "Error" && dta.data.length >0){
                                    var vlMarTop = 40
                                    if(cates == "*") vlMarTop = 10
                                    Highcharts.chart('inf-outlier', {
                                        chart: {
                                            type: 'heatmap',
                                            marginTop: vlMarTop,
                                            marginBottom: 60,
                                            plotBorderWidth: 1
                                        },

                                        title: {
                                            text: ''
                                        },
                                        xAxis: {
                                            categories: ["Outliers"]
                                        },

                                        yAxis: {
                                            categories: dta.key,
                                            title: null,
                                            labels: {
                                                style: {
                                                    'min-width': ($(window).width() <= 1280)?'20px':'125px'
                                                },
                                                useHTML : true
                                            }
                                        },

                                        legend: {
                                            align: 'center',
                                            verticalAlign: 'bottom',
                                            y: 20,
                                            x: 40
                                        },

                                        colorAxis: {
                                            min: 0,
                                            minColor: '#FFFFFF',
                                            maxColor: '#d9534f'
                                        },

                                        tooltip: {
                                            formatter: function () {
                                                return '<b>'+ this.series.yAxis.categories[this.point.y] + '</b> has <br><b>' +
                                                        this.point.value + ' outliers</b> ';
                                            }
                                        },
                                        plotOptions: {
                                            series: {
                                                events: {
                                                    click: function (event) {
                                                        callDrilldownInfOutlier(event.point.series.yAxis.categories[event.point.y], 'drilldown')
                                                    }
                                                },
                                                dataLabels:{
                                                    formatter:function(){
                                                        var nf = new Intl.NumberFormat();
                                                        return nf.format(this.point.value);
                                                    }
                                                },
                                                cursor: 'pointer'
                                            }
                                        },
                                        exporting: {
                                            buttons: [{
                                                text: 'Back to '+dta.location,
                                                onclick: function (e) {
                                                    var id = "*"
                                                    var tit = "back"
                                                    if($('#textInfOutlier').val() == "Back to province"){
                                                        tit = "drilldown"
                                                        id = $('#isRegionInfOutlier').val()
                                                        $('#textInfOutlier').val('Back to region')
                                                    }
                                                    if($('#textInfOutlier').val() == "Back to bras") {
                                                        tit = "drilldown"
                                                        id = $('#isProvinceInfOutlier').val()
                                                        $('#textInfOutlier').val('Back to province')
                                                    }
                                                    callDrilldownInfOutlier(id, tit)
                                                },
                                                theme: {
                                                    fill: '#1ABB9C',
                                                    'stroke-width': 1,
                                                    stroke: '#169F85',
                                                    color:'#fff',
                                                    states: {
                                                        hover: {
                                                            fill: '#1ABB9C'
                                                        }
                                                    }
                                                }
                                            }]
                                        },
                                        series: [{
                                            name: 'Outliers',
                                            borderWidth: 1,
                                            data: getHeatmapBrasOutlier(dta.data, dta.key),
                                            dataLabels: {
                                                enabled: true,
                                                color: '#000000'
                                            }
                                        }]

                                    });
                                    if (!isNaN(cates.substring(cates.indexOf(" ") + 1))) {
                                        $('#isRegionInfOutlier').val(cates)
                                        $('#textInfOutlier').val("Back to region")
                                    }
                                    if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") < 0) {
                                        $('#isProvinceInfOutlier').val(cates)
                                        $('#textInfOutlier').val("Back to province")
                                    }
                                    else if (isNaN(cates.substring(cates.indexOf(" ") + 1)) && cates.indexOf("-") >= 0) {
                                        $('#textInfOutlier').val("Back to bras")
                                    }
                                    // Apply for button back
                                    if(_type == 'drilldown') {
                                        $('#inf-outlier .highcharts-button').show()
                                        $('.highcharts-contextbutton').hide()
                                    }
                                    else{
                                        $('#inf-outlier .highcharts-button').hide()
                                    }
                                    // right click yAxis
                                    $('#inf-outlier .highcharts-yaxis-labels span').mousedown(function(e) {
                                        if(e.which == 3 && e.target.innerHTML.indexOf('-') >=0){
                                            window.open("/fwdRequest?bras=" + e.target.innerHTML, "_blank")
                                        }
                                        return false;
                                    });
                                }
                                else{
                                    alert("Error when execute query. Please check again your system!")
                                }
                            }
                        })
                    }
                }
            });

            function getDrillDown2Level(dta, arrRegion) {
                var jsArray = []
                for(var region=0;region< arrRegion.length;region++ ){
                    // get array provinces and bras by month&region
                    var arrProvinceBras = [], dtaRegion = []
                    for(var i=0;i< dta.length;i++){
                        if (arrRegion[region] == dta[i][0]){
                            arrProvinceBras.push({
                                province:dta[i][1],
                                bras: dta[i][2],
                                value:dta[i][3]
                            })
                        }
                    }
                    // set array data by province
                    var nameOld = arrProvinceBras[0].province, sumOld= 0,
                            isMoreProv =0,dtaProvince = [],sumPoorconn =0,
                            sumNodevice =0
                    for(var k=0;k<arrProvinceBras.length;k++){
                        if(k==(arrProvinceBras.length -1) || nameOld != arrProvinceBras[k].province){
                            if(k==(arrProvinceBras.length -1)) sumOld += arrProvinceBras[k].value
                            dtaRegion.push({
                                name: nameOld,
                                y: sumOld,
                                drilldown:nameOld
                            })
                            // set series province& bras
                            //console.log(sortObjectsArray(dtaProvince,'y').slice(0,10))
                            var top10Prov = sortObjectsArray(dtaProvince,'name').slice(0,10)
                            jsArray.push({
                                id: nameOld,
                                name: nameOld,
                                data: top10Prov
                            })
                            dtaProvince = []
                            nameOld = arrProvinceBras[k].province
                            sumOld = arrProvinceBras[k].value
                            sumNodevice = 0
                            sumPoorconn = 0
                            isMoreProv =1
                        }
                        else{
                            sumOld += Number(arrProvinceBras[k].value)
                            sumNodevice += Number(arrProvinceBras[k].noDevice)
                            sumPoorconn += Number(arrProvinceBras[k].poorconn)
                        }
                        dtaProvince.push({
                            name: arrProvinceBras[k].bras,
                            y:Number(arrProvinceBras[k].value),
                            z:'No device: '+Number(arrProvinceBras[k].noDevice),
                            k:'Poor conn: '+Number(arrProvinceBras[k].poorconn)
                        })
                        if(arrProvinceBras.length == 1){
                            jsArray.push({
                                id: nameOld,
                                name: nameOld,
                                data: dtaProvince
                            })
                        }
                    }
                    if(isMoreProv ==0){
                        dtaRegion.push({
                            name: nameOld,
                            y: Number(sumOld),
                            drilldown:nameOld
                        })
                        // set series province& bras
                        jsArray.push({
                            id: nameOld,
                            name: nameOld,
                            data: sortObjectsArray(dtaProvince,'name').slice(0,9)
                        })
                    }

                    // set series regions& province
                    jsArray.push({
                        id: arrRegion[region],
                        name: arrRegion[region],
                        data: dtaRegion
                    })
                }
                return jsArray
            }

            function getDrildownStackBar(dta,arrKey){
                var jsArray = [], data= []
                for(var key=0;key<arrKey.length;key++ ) {
                    var sumVl = 0
                    for (var i = 0; i < dta.length; i++) {
                        if (arrKey[key] == dta[i][0]){
                            sumVl += dta[i][3]
                        }
                    }
                    data.push({
                        name: arrKey[key],
                        y: sumVl,
                        drilldown: arrKey[key]
                    })
                }
                jsArray.push({
                    name: 'Region',
                    data: data
                })
                return jsArray
            }

            function addParamClients(dta) {
                var rs = []
                for(var i=0; i< dta.length; i++){
                    rs.push({
                        y: dta[i][1],
                        k: dta[i][2]
                    })
                }
                return rs
            }

            function getHeatmapBrasOutlier(data, key){
                var rs = []
                for(var i=0;i<key.length;i++){
                    var sumVl = 0
                    for(var k=0;k<data.length;k++){
                        if(data[k][0] == key[i]){
                            sumVl += data[k][1]
                        }
                    }
                    rs.push([0, i, sumVl])
                }
                return rs
            }

            // order by array objects
            function sortObjectsArray(objectsArray, sortKey)
            {
                // Quick Sort:
                var retVal;

                if (1 < objectsArray.length)
                {
                    var pivotIndex = Math.floor((objectsArray.length - 1) / 2);  // middle index
                    var pivotItem = objectsArray[pivotIndex];                    // value in the middle index
                    var less = [], more = [];

                    objectsArray.splice(pivotIndex, 1);                          // remove the item in the pivot position
                    objectsArray.forEach(function(value, index, array)
                    {
                        value[sortKey] >= pivotItem[sortKey] ?                   // compare the 'sortKey' proiperty
                                less.push(value) :
                                more.push(value) ;
                    });

                    retVal = sortObjectsArray(less, sortKey).concat([pivotItem], sortObjectsArray(more, sortKey));
                }
                else
                {
                    retVal = objectsArray;
                }

                return retVal;
            }
    </script>
    </body>
</html>